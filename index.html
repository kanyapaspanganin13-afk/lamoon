<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BarberNote">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro 02</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
// р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Ир╕▓р╕Б $ р╣Ар╕Ыр╣Зр╕Щ getEl р╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕зр╕▓р╕бр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в
const getEl = id => document.getElementById(id);
async function openComparisonSelector() {
    if (typeof Swal === 'undefined') {
        alert("р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕гр╕░р╕Ър╕Ър╣Вр╕лр╕ер╕Фр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И р╕лр╕гр╕╖р╕нр╣Ар╕Кр╣Зр╕Др╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕нр╕┤р╕Щр╣Ар╕Чр╕нр╕гр╣Мр╣Ар╕Щр╣Зр╕Х");
        return;
    }
    const { value: v } = await Swal.fire({
        title: 'ЁЯУК р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е',
        confirmButtonText: 'р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Вр╣Йр╕нр╕бр╕╣р╕е',
        confirmButtonColor: '#38bdf8',
        html: `
            <div style="text-align: left; font-family: 'Kanit', sans-serif; font-size: 14px; color: #1e293b;">
                <p style="margin: 0 0 5px 0; color: #64748b;">ЁЯУЕ р╕Кр╣Ир╕зр╕Зр╕Чр╕╡р╣И 1 </p>
                <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                    <input id="s1" type="date" class="swal2-input" style="flex:1; margin:0; height:45px; font-size:14px; border-radius:12px; border: 1px solid #cbd5e1;">
                    <input id="e1" type="date" class="swal2-input" style="flex:1; margin:0; height:45px; font-size:14px; border-radius:12px; border: 1px solid #cbd5e1;">
                </div>
                <p style="margin: 0 0 5px 0; color: #64748b;">ЁЯУЕ р╕Кр╣Ир╕зр╕Зр╕Чр╕╡р╣И 2 </p>
                <div style="display: flex; gap: 8px;">
                    <input id="s2" type="date" class="swal2-input" style="flex:1; margin:0; height:45px; font-size:14px; border-radius:12px; border: 1px solid #cbd5e1;">
                    <input id="e2" type="date" class="swal2-input" style="flex:1; margin:0; height:45px; font-size:14px; border-radius:12px; border: 1px solid #cbd5e1;">
                </div>
            </div>
        `,
        preConfirm: () => ({ 
            s1: getEl('s1').value, e1: getEl('e1').value, 
            s2: getEl('s2').value, e2: getEl('e2').value 
        })
    });

    if (v && v.s1 && v.e1 && v.s2 && v.e2) renderComparisonReport(v);
}
function renderComparisonReport(v) {
    const formatThaiDate = (dateStr) => {
        const days = ['р╕нр╕▓.', 'р╕И.', 'р╕н.', 'р╕Ю.', 'р╕Юр╕д.', 'р╕и.', 'р╕к.'];
        const dt = new Date(dateStr);
        const dayName = days[dt.getDay()];
        const [y, m, d] = dateStr.split('-');
        return `${dayName} ${d}/${m}/${(parseInt(y) + 543).toString().slice(-2)}`;
    };

    const fetchStats = (start, end) => {
        let list = [];
        let currentDate = new Date(start);
        const stopDate = new Date(end);

        while (currentDate <= stopDate) {
            const dateStr = currentDate.toISOString().split('T')[0];
            if (typeof archives !== 'undefined') {
                const dayData = archives.find(a => a.date === dateStr);
               if (dayData) {
                    let realCustomerCount = 0;
                    
                    if (dayData.details && Array.isArray(dayData.details)) {
                        realCustomerCount = dayData.details.filter(d => {
                            // 1. р╕Фр╕╢р╕Зр╕Кр╕╖р╣Ир╕нр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕нр╕нр╕Бр╕бр╕▓ (р╣Ар╕Кр╣Ир╕Щ "ЁЯЫбя╕П р╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕гр╕▓р╕вр╕зр╕▒р╕Щ")
                            const itemName = Array.isArray(d.svcs) ? d.svcs.join("") : String(d.svcs || "");
                            // 2. р╣Ар╕Кр╣Зр╕Др╕зр╣Ир╕▓р╕бр╕╡р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╣Ар╕Ыр╣Зр╕Щ GUARANTEE_CLAIM р╕лр╕гр╕╖р╕нр╕бр╕╡р╕Др╕│р╕зр╣Ир╕▓ "р╕Ыр╕гр╕░р╕Бр╕▒р╕Щ" р╣Др╕лр╕б
                            // р╕Цр╣Йр╕▓р╣Ар╕Ыр╣Зр╕Щр╕Ыр╕гр╕░р╕Бр╕▒р╕Щ р╣Гр╕лр╣Йр╕Др╕╖р╕Щр╕Др╣Ир╕▓ false р╣Ар╕Юр╕╖р╣Ир╕н "р╣Др╕бр╣Ир╕Щр╕▒р╕Ъ" р╣Ар╕Ыр╣Зр╕Щр╕ер╕╣р╕Бр╕Др╣Йр╕▓
                            const isInsurance = d.type === "GUARANTEE_CLAIM" || itemName.includes("р╕Ыр╕гр╕░р╕Бр╕▒р╕Щ");
                            
                            return !isInsurance; 
                        }).length;
                    }

                    list.push({
                        date: formatThaiDate(dateStr),
                        count: realCustomerCount,
                        barber: dayData.barber || 0
                    });
                }
            }
            currentDate.setDate(currentDate.getDate() + 1);
        }
        const sumC = list.reduce((a, b) => a + Number(b.count || 0), 0);
        const sumE = list.reduce((a, b) => a + Number(b.barber || 0), 0);
        
        const rowList = list.length > 0 ? list.map(d => `
            <div style="display:flex; justify-content:space-between; padding:10px 8px; border-bottom:1px solid rgba(0,0,0,0.05); font-size:13px; color:#334155;">
                <span style="flex:1.5; font-weight:500;">${d.date}</span>
                <span style="flex:1; text-align:center; color:#1d4ed8; font-weight:700;">ЁЯСд ${d.count}</span>
                <span style="flex:1.2; text-align:right; color:#059669; font-weight:700;">р╕┐${Number(d.barber).toLocaleString()}</span>
            </div>`).join("") : `<div style="padding:15px; text-align:center; color:#94a3b8;">тЭМ р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е</div>`;
        
        return { sumC, sumE, rowList, range: `${formatThaiDate(start)} - ${formatThaiDate(end)}` };
    };

    const d1 = fetchStats(v.s1, v.e1);
    const d2 = fetchStats(v.s2, v.e2);

    // ... р╕кр╣Ир╕зр╕Щр╕Чр╕╡р╣Ир╣Ар╕лр╕ер╕╖р╕н (reportHtml р╣Бр╕ер╕░ openReportModal) р╣Гр╕Кр╣Йр╕Вр╕нр╕Зр╣Ар╕Фр╕┤р╕бр╣Др╕Фр╣Йр╣Ар╕ер╕вр╕Др╕гр╕▒р╕Ъ ...
    const reportHtml = `
        <div style="font-family:'Kanit', sans-serif; text-align:left; background:#ffffff; margin:-20px; padding:20px; color:#1e293b;">
            <div style="background:#f0f9ff; border:1px solid #bae6fd; border-radius:24px; padding:18px; margin-bottom:15px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);">
                <div style="color:#0369a1; font-weight:700; font-size:13px; margin-bottom:10px; display:flex; align-items:center; gap:5px;">ЁЯУЕ ${d1.range}</div>
                <div style="display:flex; justify-content:space-between; align-items:center; background:#ffffff; padding:12px; border-radius:16px; border:1px solid #e0f2fe; margin-bottom:10px;">
                    <span style="flex:1.5; font-weight:800; color:#1e293b; font-size:14px;">р╕кр╕гр╕╕р╕Ыр╕гр╕зр╕б</span>
                    <span style="flex:1; text-align:center; color:#1d4ed8; font-weight:800; font-size:18px;">ЁЯСд ${d1.sumC}</span>
                    <span style="flex:1.2; text-align:right; color:#059669; font-weight:800; font-size:18px;">р╕┐${d1.sumE.toLocaleString()}</span>
                </div>
                <div style="max-height:160px; overflow-y:auto; -webkit-overflow-scrolling:touch; padding:0 5px;">
                    ${d1.rowList}
                </div>
            </div>

            <div style="text-align:center; color:#cbd5e1; font-weight:900; margin:10px 0; font-size:12px;">VS</div>

            <div style="background:#f0fdf4; border:1px solid #bbf7d0; border-radius: 24px; padding: 18px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);">
                <div style="color:#15803d; font-weight:700; font-size:13px; margin-bottom:10px; display:flex; align-items:center; gap:5px;">ЁЯУЕ ${d2.range}</div>
                <div style="display:flex; justify-content:space-between; align-items:center; background:#ffffff; padding:12px; border-radius:16px; border:1px solid #dcfce7; margin-bottom:10px;">
                    <span style="flex:1.5; font-weight:800; color:#1e293b; font-size:14px;">р╕кр╕гр╕╕р╕Ыр╕гр╕зр╕б</span>
                    <span style="flex:1; text-align:center; color:#1d4ed8; font-weight:800; font-size:18px;">ЁЯСд ${d2.sumC}</span>
                    <span style="flex:1.2; text-align:right; color:#059669; font-weight:800; font-size:18px;">р╕┐${d2.sumE.toLocaleString()}</span>
                </div>
                <div style="max-height:160px; overflow-y:auto; -webkit-overflow-scrolling:touch; padding:0 5px;">
                    ${d2.rowList}
                </div>
            </div>
            <div style="text-align:center; font-size:11px; color:#94a3b8; margin-top:15px;">р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Йр╕Юр╕▓р╕░р╕гр╕▓р╕вр╣Др╕Фр╣Йр╕Вр╕нр╕Зр╕Кр╣Ир╕▓р╕З</div>
        </div>`;

    openReportModal("р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е", reportHtml);
}
function openReportModal(title, htmlContent) {
    const modal = getEl('reportModal');
    const modalTitle = getEl('reportTitle');
    const modalContent = getEl('reportContent');
    
    if (!modal || !modalTitle || !modalContent) {
        console.error("тЭМ р╕лр╕▓ ID Modal р╣Др╕бр╣Ир╣Ар╕Ир╕н!");
        return;
    }
    // р╣Гр╕кр╣Ир╕Вр╣Йр╕нр╕бр╕╣р╕е
    modalTitle.innerText = title;
    modalContent.innerHTML = htmlContent;
    // р╕Ир╕▒р╕Фр╕кр╣Др╕Хр╕ер╣М modalInner (р╕Хр╕▒р╕зр╕Бр╕ер╣Ир╕нр╕Зр╕кр╕╡р╕Вр╕▓р╕з)
    const inner = modalContent.parentElement;
    inner.style.width = "95%";            // р╣Гр╕лр╣Йр╣Ар╕Бр╕╖р╕нр╕Ър╣Ар╕Хр╣Зр╕бр╕Ир╕нр╣Гр╕Щр╕бр╕╖р╕нр╕Цр╕╖р╕н
    inner.style.maxWidth = "650px";       // р╣Др╕бр╣Ир╣Гр╕лр╣Йр╕Бр╕зр╣Йр╕▓р╕Зр╣Др╕Ыр╣Гр╕Щр╕Др╕нр╕б
    inner.style.maxHeight = "85vh";       // р╣Др╕бр╣Ир╣Гр╕лр╣Йр╕кр╕╣р╕Зр╣Ар╕ер╕вр╕лр╕Щр╣Йр╕▓р╕Ир╕н
    inner.style.overflowY = "auto";       // р╣Гр╕лр╣Йр╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕Ър╕гр╕гр╕Чр╕▒р╕Фр╕Фр╕╣р╣Др╕Фр╣Й
    inner.style.background = "#ffffff";   // р╕Юр╕╖р╣Йр╕Щр╕лр╕ер╕▒р╕Зр╕Вр╕▓р╕зр╕кр╕░р╕нр╕▓р╕Ф
    inner.style.borderRadius = "24px";    // р╕Вр╕нр╕Ър╕бр╕Щр╕кр╕зр╕вр╕Зр╕▓р╕б
    inner.style.padding = "20px";
    inner.style.margin = "auto";
    
    // р╕кр╕│р╕Др╕▒р╕Н: р╕Чр╕│р╣Гр╕лр╣Йр╕Бр╕▓р╕гр╣Др╕Цр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕Ър╕Щ iPhone р╕ер╕╖р╣Ир╕Щр╣Др╕лр╕е
    inner.style.webkitOverflowScrolling = "touch";
    // р╕кр╕▒р╣Ир╕Зр╣Бр╕кр╕Фр╕Зр╕Ьр╕е Modal
    modal.style.display = "flex";
    modal.style.alignItems = "center";
    modal.style.justifyContent = "center";
}
</script>
</head>
<style>
/* 1. р╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕лр╕ер╕▒р╕Б (р╕Др╕Зр╣Ар╕Фр╕┤р╕б) */
:root { 
    --primary: #6366f1; --accent: #0ea5e9; --danger: #ef4444; --success: #22c55e; 
    --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #e2e8f0;
}

/* 2. р╕гр╕░р╕Ър╕Ър╕Шр╕╡р╕б (р╕Др╕Зр╣Ар╕Фр╕┤р╕б) */
body.navy { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --accent: #38bdf8; }
body.dark { --bg: #121212; --card: #1a1a1a; --text: #fbbf24; --accent: #fbbf24; }

/* 3. р╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ */
* { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }

body { 
    margin: 0; 
    background: var(--bg); 
    color: var(--text); 
    /* ЁЯФ┤ р╣Бр╕Бр╣Йр╣Др╕В: р╕ер╕Ф padding р╕Фр╣Йр╕▓р╕Щр╕ер╣Ир╕▓р╕Зр╕нр╕нр╕Бр╣Ар╕Юр╕гр╕▓р╕░р╣Др╕бр╣Ир╕бр╕╡р╣Ар╕бр╕Щр╕╣р╕Ър╕▓р╕гр╣Мр╣Бр╕ер╣Йр╕з */
    padding-bottom: 20px; 
    overflow-x: hidden; 
    transition: all 0.3s ease; 
}

/* 4. р╕гр╕░р╕Ър╕Ър╣Ар╕ер╕вр╣Мр╣Ар╕нр╕▓р╕Хр╣М */
.container { 
    padding: 10px; 
    max-width: 500px; 
    margin: auto; 
    position: relative; 
}

.page { 
    display: none; 
    background: var(--bg); 
    border-radius: 25px;
    padding: 20px;
    /* ЁЯФ┤ р╣Бр╕Бр╣Йр╣Др╕В: р╕Ыр╕гр╕▒р╕Ъ margin р╕Фр╣Йр╕▓р╕Щр╕ер╣Ир╕▓р╕Зр╣Гр╕лр╣Йр╕кр╕▒р╣Йр╕Щр╕ер╕З */
    margin: 10px 5px 20px 5px; 
    border: 1px solid var(--border);
    /* ЁЯФ┤ р╣Бр╕Бр╣Йр╣Др╕В: р╕Др╕╖р╕Щр╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣Ир╕Др╕зр╕▓р╕бр╕кр╕╣р╕Зр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╣Гр╕лр╣Йр╣Ар╕Хр╣Зр╕бр╕Чр╕╡р╣И */
    min-height: calc(100vh - 40px); 
    box-sizing: border-box;
    overflow-y: auto;
}

.page.active { 
    display: block !important; 
    animation: fadeIn 0.3s ease-in-out;
}

/* ЁЯЯв р╕кр╣Ир╕зр╕Щр╕Чр╕╡р╣Ир╣Ар╕Юр╕┤р╣Ир╕б: р╕кр╣Др╕Хр╕ер╣Мр╕Ыр╕╕р╣Ир╕бр╕вр╣Йр╕нр╕Щр╕Бр╕ер╕▒р╕Ъ (Back Button) */
.back-nav {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    cursor: pointer;
    color: var(--primary);
    padding: 10px;
    border-radius: 15px;
    background: rgba(99, 102, 241, 0.05); /* р╕Юр╕╖р╣Йр╕Щр╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Зр╣Ж р╣Гр╕лр╣Йр╕Фр╕╣р╣Бр╕Юр╕З */
    transition: 0.2s;
}
.back-nav:active { transform: translateX(-5px); }
.back-nav b { font-size: 18px; }

/* 5. р╕гр╕░р╕Ър╕Ър╣Ар╕бр╕Щр╕╣ Dashboard (р╕лр╕Щр╣Йр╕▓р╣Бр╕гр╕Б p0) */
.menu-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-top: 15px;
}

.menu-item {
    background: var(--card);
    border-radius: 20px;
    padding: 25px 10px;
    text-align: center;
    border: 1px solid var(--border);
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    cursor: pointer;
    transition: 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}

.menu-item:active { transform: scale(0.95); background: var(--border); }
.menu-item i { font-size: 32px; }
.menu-item span { font-size: 14px; font-weight: 700; color: var(--text); }

/* р╕Хр╕Бр╣Бр╕Хр╣Ир╕Зр╕кр╕╡р╣Др╕нр╕Др╕нр╕Щр╣Гр╕лр╣Йр╣Ар╕Фр╣Ир╕Щр╕Ър╕Щр╕Юр╕╖р╣Йр╕Щр╕лр╕ер╕▒р╕З Navy */
.icon-save   { color: #34d399 !important; } /* р╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕зр╕бр╕┤р╣Йр╕Щр╕Чр╣Мр╕кр╕зр╣Ир╕▓р╕З (р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Зр╕▓р╕Щ) */
.icon-report { color: #fbbf24 !important; } /* р╕кр╕╡р╣Ар╕лр╕ер╕╖р╕нр╕Зр╕Чр╕нр╕З (р╕гр╕▓р╕вр╕Зр╕▓р╕Щ) */
.icon-acc    { color: #60a5fa !important; } /* р╕кр╕╡р╕Яр╣Йр╕▓р╕кр╕зр╣Ир╕▓р╕З (р╕Ър╕▒р╕Нр╕Кр╕╡) */
.icon-stats  { color: #f472b6 !important; } /* р╕кр╕╡р╕Кр╕бр╕Юр╕╣р╕кр╕зр╣Ир╕▓р╕З (р╕кр╕Цр╕┤р╕Хр╕┤) */
.icon-know   { color: #a78bfa !important; } /* р╕кр╕╡р╕бр╣Ир╕зр╕Зр╕ер╕▓р╣Ар╕зр╕Щр╣Ар╕Фр╕нр╕гр╣М (р╕Др╕зр╕▓р╕бр╕гр╕╣р╣Й/р╣Ар╕Чр╕гр╕Щр╕Фр╣М) */
.icon-set    { color: #cbd5e1 !important; } /* р╕кр╕╡р╣Ар╕Чр╕▓р╕Вр╕▓р╕з (р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓) */

/* р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕нр╕Яр╣Ар╕Яр╕Бр╕Хр╣Мр╣Гр╕лр╣Йр╣Др╕нр╕Др╕нр╕Щр╕Фр╕╣р╕бр╕╡р╕Юр╕ер╕▒р╕З (Shadow) */
.menu-card i {
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.1));
    transition: transform 0.2s ease;
}

/* р╣Ар╕зр╕ер╕▓р╕Кр╣Ир╕▓р╕Зр╕Ир╕┤р╣Йр╕б р╣Гр╕лр╣Йр╣Др╕нр╕Др╕нр╕Щр╕Вр╕вр╕▒р╕Ър╕Щр╕┤р╕Фр╕Щр╕╢р╕Зр╕Фр╕╣р╕бр╕╡р╕Кр╕╡р╕зр╕┤р╕Хр╕Кр╕╡р╕зр╕▓ */
.menu-card:active i {
    transform: scale(1.1);
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}   
</style>
</head>
<body>
<div id="p0" class="page active">
┬а <div style="padding: 20px; display: flex; align-items: center; gap: 15px;">
┬а ┬а <div onclick="document.getElementById('logoInput').click();" style="width: 60px; height: 60px; background: #e2e8f0; border-radius: 50%; overflow: hidden; cursor: pointer; border: 2px solid #1e3a8a; position: relative;">
┬а ┬а ┬а ┬а <img id="mainLogo" src="logo.png" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2209/2209678.png'">
┬а ┬а ┬а ┬а <div style="position: absolute; bottom: 0; background: rgba(0,0,0,0.5); width: 100%; color: white; font-size: 8px; text-align: center;">р╣Бр╕Бр╣Йр╣Др╕В</div>
┬а ┬а </div>┬а
┬а ┬а <input type="file" id="logoInput" accept="image/*" style="display: none;" onchange="uploadLogo(this)">
┬а ┬а <div>
┬а ┬а ┬а ┬а <h2 style="margin: 0; font-size: 20px; color: #1e3a8a; font-weight: 900;">BARBER NOTE PRO</h2>
┬а ┬а ┬а ┬а <p style="margin: 0; font-size: 12px; color: #64748b;">р╕гр╕░р╕Ър╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕гр╣Йр╕▓р╕Щр╕Хр╕▒р╕Фр╕Ьр╕бр╕бр╕╖р╕нр╕нр╕▓р╕Кр╕╡р╕Ю</p>
┬а ┬а </div>
</div>
┬а ┬а<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px;">
┬а ┬а┬а
┬а ┬а <div onclick="go('p1')" style="background: #1e3a8a; padding: 25px 15px; border-radius: 25px; text-align: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
┬а ┬а ┬а ┬а <i class="fas fa-edit" style="font-size: 28px; color: #60a5fa; margin-bottom: 12px;"></i>
┬а ┬а ┬а ┬а <div style="font-weight: 800; color: #ffffff; font-size: 15px;">р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Зр╕▓р╕Щ</div>
┬а ┬а </div>

┬а ┬а <div onclick="go('p2')" style="background: #172554; padding: 25px 15px; border-radius: 25px; text-align: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
┬а ┬а ┬а ┬а <i class="fas fa-file-invoice" style="font-size: 28px; color: #fbbf24; margin-bottom: 12px;"></i>
┬а ┬а ┬а ┬а <div style="font-weight: 800; color: #ffffff; font-size: 15px;">р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕гр╕▓р╕вр╕зр╕▒р╕Щ</div>
┬а ┬а </div>

┬а ┬а <div onclick="go('p3')" style="background: #064e3b; padding: 25px 15px; border-radius: 25px; text-align: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
┬а ┬а ┬а ┬а <i class="fas fa-wallet" style="font-size: 28px; color: #34d399; margin-bottom: 12px;"></i>
┬а ┬а ┬а ┬а <div style="font-weight: 800; color: #ffffff; font-size: 15px;">р╕кр╕Цр╕▓р╕Щр╕░р╕Ър╕▒р╕Нр╕Кр╕╡</div>
┬а ┬а </div>

┬а ┬а <div onclick="go('p5')" style="background: #4c1d95; padding: 25px 15px; border-radius: 25px; text-align: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
┬а ┬а ┬а ┬а <i class="fas fa-chart-pie" style="font-size: 28px; color: #c084fc; margin-bottom: 12px;"></i>
┬а ┬а ┬а ┬а <div style="font-weight: 800; color: #ffffff; font-size: 15px;">р╕кр╕гр╕╕р╕Ы & р╕кр╕Цр╕┤р╕Хр╕┤</div>
┬а ┬а </div>

┬а ┬а <div onclick="go('p4')" style="background: #334155; padding: 25px 15px; border-radius: 25px; text-align: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
┬а ┬а ┬а ┬а <i class="fas fa-cut" style="font-size: 28px; color: #94a3b8; margin-bottom: 12px;"></i>
┬а ┬а ┬а ┬а <div style="font-weight: 800; color: #ffffff; font-size: 15px;">р╣Ар╕Чр╕гр╕Щр╕Фр╣Мр╕Чр╕гр╕Зр╕Ьр╕б</div>
┬а ┬а </div>

┬а ┬а <div onclick="document.getElementById('modalSet').style.display='flex'" style="background: #1e293b; padding: 25px 15px; border-radius: 25px; text-align: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
┬а ┬а ┬а ┬а <i class="fas fa-user-cog" style="font-size: 28px; color: #cbd5e1; margin-bottom: 12px;"></i>
┬а ┬а ┬а ┬а <div style="font-weight: 800; color: #ffffff; font-size: 15px;">р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ & р╕гр╕░р╕Ър╕Ъ</div>
┬а ┬а ┬а ┬а </div>
┬а ┬а </div>
</div>

<div id="p1" class="page" style="display: none; padding: 20px; background: #f8fafc; min-height: 100vh; flex-direction: column;">
┬а ┬а┬а
┬а ┬а <div style="text-align: center; margin-bottom: 25px; padding-top: 10px;">
┬а ┬а ┬а ┬а <h2 id="shopNameDisp" style="margin: 0; color:#1e3a8a; font-weight:900; font-size: 22px; letter-spacing: 1px; text-transform: uppercase;">BARBER SHOP</h2>
┬а ┬а ┬а ┬а <div style="height: 3px; width: 40px; background: #1e3a8a; margin: 8px auto; border-radius: 10px;"></div>
┬а ┬а </div>

┬а ┬а <div class="grid-3" style="display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap:12px; margin-bottom: 20px;">
┬а ┬а ┬а ┬а <div style="background:#fff; border-radius:20px; height:75px; position:relative; display:flex; align-items:center; justify-content:center; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
┬а ┬а ┬а ┬а ┬а ┬а <span id="dateDisplay" style="font-weight:800; color:#475569; font-size:16px;">ЁЯУЕ р╕зр╕▒р╕Щр╕Чр╕╡р╣И</span>
┬а ┬а ┬а ┬а ┬а ┬а <input type="date" id="dateInp" onchange="if(window.updateDateDisplay) updateDateDisplay(this.value);" style="position:absolute; opacity:0; width:100%; height:100%; cursor:pointer; z-index:2;">
┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а <input type="time" id="tStart" style="height:75px; border-radius:20px; border:none; text-align:center; font-weight:700; background:#fff; color:#1e293b; box-shadow: 0 4px 12px rgba(0,0,0,0.05); font-size: 16px;">
┬а ┬а ┬а ┬а <input type="time" id="tEnd" style="height:75px; border-radius:20px; border:none; text-align:center; font-weight:700; background:#fff; color:#1e293b; box-shadow: 0 4px 12px rgba(0,0,0,0.05); font-size: 16px;">
┬а ┬а </div>

┬а ┬а <div style="display: grid; grid-template-columns: 1.5fr 1fr 1fr; gap: 12px; margin-bottom: 20px;">
┬а ┬а ┬а ┬а <select id="hairStyle" style="height:70px; border-radius:20px; border:none; font-weight:700; background:#fff; color:#1e293b; box-shadow:0 4px 12px rgba(0,0,0,0.05); padding:0 15px; font-size: 16px;">
┬а ┬а ┬а ┬а ┬а ┬а <option value="">тЬВя╕П р╕Чр╕гр╕Зр╕Ьр╕б</option>
┬а ┬а ┬а ┬а ┬а ┬а <option>р╣Бр╕Яр╕Кр╕▒р╣Ир╕Щ</option><option>р╕кр╕Бр╕┤р╕Щр╣Ар╕Яр╕Ф</option><option>р╣Ар╕Ыр╕┤р╕Фр╕Вр╣Йр╕▓р╕З</option><option>р╕гр╕нр╕Зр╕Чр╕гр╕З</option>
┬а ┬а ┬а ┬а ┬а ┬а <option>р╕Хр╕│р╕гр╕зр╕И/р╕Чр╕лр╕▓р╕г</option><option>р╕Чр╕гр╕Зр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ</option><option>р╣Бр╕Бр╣Йр╕Ьр╕б</option><option>р╣Вр╕Бр╕Щр╕Ьр╕б</option>
┬а ┬а ┬а ┬а </select>
┬а ┬а ┬а ┬а <select id="extra1" style="height:70px; border-radius:20px; border:none; font-weight:700; background:#fff; color:#64748b; box-shadow:0 4px 12px rgba(0,0,0,0.05); padding:0 10px; font-size: 14px;">
┬а ┬а ┬а ┬а ┬а ┬а <option value="">р╕Ър╕гр╕┤р╕Бр╕▓р╕г 1</option>
┬а ┬а ┬а ┬а ┬а ┬а <option value="р╣Ар╕Фр╣Зр╕Б"> р╣Ар╕Фр╣Зр╕Б</option><option>р╣Вр╕Бр╕Щр╕лр╕Щр╕зр╕Ф</option><option>р╕Бр╕▒р╕Щр╕лр╕Щр╣Йр╕▓</option><option>р╕кр╕гр╕░р╕Ьр╕б</option><option>р╕вр╣Йр╕нр╕бр╕Ьр╕б</option><option>р╕Фр╕▒р╕Фр╕Ьр╕б</option><option>р╕вр╣Йр╕нр╕бр╣Бр╕Яр╕Кр╕▒р╣Ир╕Щ</option>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </select>
┬а ┬а ┬а ┬а <select id="extra2" style="height:70px; border-radius:20px; border:none; font-weight:700; background:#fff; color:#64748b; box-shadow:0 4px 12px rgba(0,0,0,0.05); padding:0 10px; font-size: 14px;">
┬а ┬а ┬а ┬а ┬а ┬а <option value="">р╕Ър╕гр╕┤р╕Бр╕▓р╕г 2</option>
┬а ┬а ┬а ┬а ┬а<option value="р╣Ар╕Фр╣Зр╕Б"> р╣Ар╕Фр╣Зр╕Б</option><option>р╣Вр╕Бр╕Щр╕лр╕Щр╕зр╕Ф</option><option>р╕Бр╕▒р╕Щр╕лр╕Щр╣Йр╕▓</option><option>р╕кр╕гр╕░р╕Ьр╕б</option><option>р╕вр╣Йр╕нр╕бр╕Ьр╕б</option><option>р╕Фр╕▒р╕Фр╕Ьр╕б</option><option>р╕вр╣Йр╕нр╕бр╣Бр╕Яр╕Кр╕▒р╣Ир╕Щ</option>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </select>
┬а ┬а </div>
┬а ┬а <div style="display: grid; grid-template-columns: 1.4fr 1fr; gap: 15px; margin-bottom: 20px;">
┬а ┬а ┬а ┬а <div style="position: relative; background: #ffffff; border-radius: 25px; box-shadow: 0 8px 25px rgba(99, 102, 241, 0.1); border: 2px solid #eef2ff;">
┬а ┬а ┬а ┬а ┬а ┬а <span style="position: absolute; left: 18px; top: 50%; transform: translateY(-50%); font-size: 24px; color: #6366f1; font-weight: 900;">р╕┐</span>
┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="priceInp" placeholder="0" inputmode="numeric" style="width: 100%; height: 95px; background: transparent; font-size: 48px; font-weight: 900; color: #1e293b; padding-left: 45px; border: none; outline: none;">
┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а <input type="number" id="tipInp" placeholder="р╕Чр╕┤р╕Ы" inputmode="numeric" style="width: 100%; height: 95px; background: #fffbeb; border-radius: 25px; font-size: 36px; font-weight: 900; color: #ad2c18; border: 2px solid #fef3c7; outline: none; text-align: center;">
┬а ┬а </div>

┬а ┬а <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap:12px; margin-bottom:25px;">
┬а ┬а ┬а ┬а <button id="btnCash" onclick="setPaymentType('Cash')" style="height:80px; border-radius:20px; border:none; background:linear-gradient(135deg, #10b981, #059669); color:#fff; font-weight:800; font-size: 15px;">
┬а ┬а ┬а ┬а ┬а ┬а <i class="fas fa-money-bill-wave"></i><br>р╣Ар╕Зр╕┤р╕Щр╕кр╕Ф
┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а <button id="btnTrans" onclick="setPaymentType('Trans')" style="height:80px; border-radius:20px; border:none; background:linear-gradient(135deg, #6366f1, #4338ca); color:#fff; font-weight:800; font-size: 15px;">
┬а ┬а ┬а ┬а ┬а ┬а <i class="fas fa-qrcode"></i><br>р╕кр╣Бр╕Бр╕Щр╕Ир╣Ир╕▓р╕в
┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а <button id="btnMix" onclick="setPaymentType('Mix')" style="height:80px; border-radius:20px; border:none; background:linear-gradient(135deg, #0ea5e9, #0284c7); color:#fff; font-weight:800; font-size: 15px;">
┬а ┬а ┬а ┬а ┬а ┬а <i class="fas fa-wallet"></i><br>р╕Ир╣Ир╕▓р╕вр╕Ьр╕кр╕б
┬а ┬а ┬а ┬а </button>
┬а ┬а </div>
┬а ┬а <div style="margin-top: auto; padding-bottom: 20px;">
┬а ┬а ┬а ┬а <button class="btn-main" onclick="handleSave(event)" style="width:100%; height:90px; border-radius:28px; background: linear-gradient(135deg, #1e3a8a, #0f172a); color:#fff; border:none; box-shadow: 0 12px 30px rgba(15, 23, 42, 0.3); display:flex; align-items:center; justify-content:center; gap:15px; margin-bottom: 15px;">
┬а ┬а ┬а ┬а ┬а ┬а <i class="fas fa-save" style="font-size: 32px;"></i>
┬а ┬а ┬а ┬а ┬а ┬а <span style="font-size: 28px; font-weight: 900; letter-spacing:1px;">р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е</span>
        </button>
┬а ┬а ┬а ┬а <button onclick="go('p0')" style="width: 100%; height: 55px; background: #fff; color: #64748b; border-radius: 20px; border: 1px solid #e2e8f0; font-weight: 800; font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 8px;">
┬а ┬а ┬а ┬а ┬а ┬а <i class="fas fa-home"></i> р╕Бр╕ер╕▒р╕Ър╕лр╕Щр╣Йр╕▓р╣Ар╕бр╕Щр╕╣р╕лр╕ер╕▒р╕Б
┬а ┬а ┬а ┬а </button>
┬а ┬а </div>
 <div id="p2" class="page" style="display:none; max-width:480px; margin:0 auto; padding: 15px; background: #0f172a; min-height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; color: white;">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;">
        <div style="background: #1e3a8a; padding:18px 15px; border-radius:20px; text-align:center; box-shadow:0 10px 15px -3px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1);">
            <small style="font-weight:800; color:#cbd5e1; text-transform: uppercase; letter-spacing: 0.5px; font-size: 11px;">р╕вр╕нр╕Фр╕гр╕зр╕бр╕зр╕▒р╕Щр╕Щр╕╡р╣Й</small>
            <div id="dTotal" style="font-size:36px; font-weight:900; color:#ffffff; margin: 5px 0;">0</div>
            <div id="dCounts" style="font-size:14px; font-weight:700; color:#cbd5e1; background:rgba(255,255,255,0.15); display:inline-block; padding:2px 10px; border-radius:10px;">р╕ер╕╣р╕Бр╕Др╣Йр╕▓ 0 р╕Др╕Щ</div>
        </div>

        <div style="background:#1e3a8a; padding:15px; border-radius:20px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); display:flex; flex-direction:column; justify-content:center; gap:8px;">
            <div style="display:flex; justify-content:space-between; align-items:center; font-size:14px; font-weight:700;">
                <span style="color:#cbd5e1;"><i class="fas fa-mobile-alt" style="width:18px; color:#60a5fa;"></i> р╣Вр╕нр╕Щ:</span> 
                <b id="dTrans" style="color:#ffffff;">0</b>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; font-size:14px; font-weight:700;">
                <span style="color:#cbd5e1;"><i class="fas fa-money-bill-wave" style="width:18px; color:#4ade80;"></i> р╕кр╕Ф:</span> 
                <b id="dCash" style="color:#ffffff;">0</b>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; font-size:14px; font-weight:700;">
                <span style="color:#cbd5e1;"><i class="fas fa-cut" style="width:18px; color:#fbbf24;"></i> р╕Кр╣Ир╕▓р╕З:</span> 
                <b id="dBarber" style="color:#ffffff;">0</b>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; font-size:14px; font-weight:800; border-top: 1px dashed rgba(255,255,255,0.2); padding-top: 8px;">
                <span style="color:#cbd5e1;"><i class="fas fa-store" style="width:18px; color:#f472b6;"></i> р╕гр╣Йр╕▓р╕Щ:</span> 
                <b id="dShop" style="color:#ffffff;">0</b>
            </div>
        </div>
    </div>
   <div id="settleBarContainer" style="margin-bottom:18px;"><div id="settleBar"></div> </div>
                <div id="dServiceStats"></div>
                <hr style="border:0; border-top:1px solid #e2e8f0; margin-top:15px;">
                <div id="dailyList"></div>
            </div>
        <button onclick="go('p0')" style="width: 100%; height: 45px; background: rgba(255,255,255,0.05); color: #cbd5e1; border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; font-weight: 700; font-size: 14px;">
            р╕Бр╕ер╕▒р╕Ър╕лр╕Щр╣Йр╕▓р╣Ар╕бр╕Щр╕╣р╕лр╕ер╕▒р╕Б
        </button>
    </div>
</div>
    <div id="p3" class="page" style="max-width:480px; margin:0 auto; padding: 12px; padding-bottom: 100px; background: #f8fafc;">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
        <div onclick="go('p0')" style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: #1e293b; background: #fff; padding: 8px 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
            <i class="fas fa-chevron-left" style="font-size: 18px;"></i>
            <span style="font-weight: 800; font-size: 16px;">р╣Ар╕бр╕Щр╕╣р╕лр╕ер╕▒р╕Б</span>
        </div>
        <div style="font-size: 14px; font-weight: 700; color: #64748b;">р╕гр╕░р╕Ър╕Ър╕Ър╕▒р╕Нр╕Кр╕╡р╕гр╣Йр╕▓р╕Щ</div>
    </div>

    <div class="card" style="background:#fff; border-radius:25px; padding:20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border:1px solid #fff; margin-bottom: 15px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <b style="font-size:22px; color:#92400e;"><i class="fas fa-wallet"></i> р╕кр╕Цр╕▓р╕Щр╕░р╕Ър╕▒р╕Нр╕Кр╕╡</b>
            <div id="accLight" style="background:#22c55e; width:10px; height:10px; border-radius:50%; box-shadow:0 0 8px #22c55e;"></div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
            <div style="background:#f8fafc; border-radius:18px; padding:12px; text-align:center; border: 1px solid #f1f5f9; box-shadow: 0 4px 12px rgba(0,0,0,0.03);">
                <small style="font-size:12px; color:#64748b; font-weight:700;">р╕Др╣Йр╕▓р╕Зр╣Ар╕Фр╕┤р╕б</small>
                <b style="font-size:18px; color:#1e293b; display:block;" id="accOldVal">р╕┐0</b>
            </div>
            <div style="background:#f8fafc; border-radius:18px; padding:12px; text-align:center; border: 1px solid #f1f5f9; box-shadow: 0 4px 12px rgba(0,0,0,0.03);">
                <small id="accDateLabel" style="font-size:12px; color:#64748b; font-weight:700;">00/00/0000</small>
                <b style="font-size:18px; color:#1e293b; display:block;" id="accTodayVal">р╕┐0</b>
            </div>
        </div>

        <div style="background:#f8fafc; border-radius:22px; padding:20px; text-align:center; margin-bottom:15px; border: 1px solid #f1f5f9;">
            <div id="statusBadge" style="display:inline-block; padding:4px 12px; border-radius:10px; font-size:12px; font-weight:700; margin-bottom:8px; background: #e2e8f0; color: #475569;">
                р╕Бр╕│р╕ер╕▒р╕Зр╕Др╕│р╕Щр╕зр╕У...
            </div>
            <div style="font-size:32px; font-weight:900; color:#1e293b;" id="accTotalVal">р╕┐0</div>
        </div>

        <div style="margin-bottom:15px;">
            <div style="display:flex; align-items:center; background:#f1f5f9; border-radius:15px; padding:0 15px; margin-bottom:8px; height:50px;">
                <i class="fas fa-calendar-alt" style="color:#6366f1;"></i>
                <input type="date" id="accDate" style="flex:1; border:none; background:none; font-size:16px; font-weight:600; padding-left:10px; outline:none;">
            </div>
            <div style="display:flex; align-items:center; background:#f1f5f9; border-radius:15px; padding:0 15px; height:50px;">
                <i class="fas fa-pen-nib" style="color:#94a3b8;"></i>
                <input type="text" id="accNote" placeholder="р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕..." style="flex:1; border:none; background:none; font-size:15px; padding-left:10px; outline:none;">
            </div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button onclick="clearAccount()" style="background:#22c55e; color:#fff; border:none; border-radius:18px; padding:15px 5px; font-size:14px; font-weight:800; cursor:pointer; box-shadow: 0 4px 6px rgba(16,185,129,0.2);">
                <i class="fas fa-check-double"></i> р╣Ар╕Др╕ер╕╡р╕вр╕гр╣Мр╣Ар╕Зр╕┤р╕Щ
            </button>
            <button onclick="openHistoryModal()" style="background:#f59e0b; color:#fff; border:none; border-radius:18px; padding:15px 5px; font-size:14px; font-weight:800; cursor:pointer; box-shadow: 0 4px 6px rgba(245,158,11,0.2);">
                <i class="fas fa-history"></i> р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╣Ар╕Др╕ер╕╡р╕вр╕гр╣Мр╣Ар╕Зр╕┤р╕Щ
            </button>
        </div>
    </div> 
<div id="p5" class="page">
    <div style="display: flex; align-items: center; margin-bottom: 25px;">
        <div onclick="go('p0')" style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: #1e293b; background: #fff; padding: 10px 18px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
            <i class="fas fa-chevron-left" style="font-size: 18px;"></i>
            <span style="font-weight: 800; font-size: 16px;">р╣Ар╕бр╕Щр╕╣р╕лр╕ер╕▒р╕Б</span>
        </div>
    </div>

    <div style="text-align: center; margin-bottom: 30px;">
        <h3 style="margin: 0; font-size: 24px; color: var(--primary); font-weight: 900;">ЁЯУИ р╕кр╕гр╕╕р╕Ыр╕Ьр╕е & р╕кр╕Цр╕┤р╕Хр╕┤</h3>
        <p style="font-size: 13px; color: #64748b; margin-top: 5px;">р╕Хр╕┤р╕Фр╕Хр╕▓р╕бр╕Ьр╕ер╕Зр╕▓р╕Щр╣Бр╕ер╕░р╕гр╕▓р╕вр╣Др╕Фр╣Йр╕Вр╕нр╕Зр╕Др╕╕р╕У</p>
    </div>

    <div style="display: grid; grid-template-columns: 1fr; gap: 15px;">
        
        <div onclick="document.getElementById('histMonth').showPicker()" 
             style="background:linear-gradient(135deg, #1e40af, #4338ca); border-radius:25px; padding:25px 15px; text-align:center; color:#fff; position:relative; box-shadow:0 10px 25px rgba(30, 64, 175, 0.25); cursor:pointer;">
            <i class="fas fa-calendar-check" style="font-size:32px; margin-bottom:12px; display:block;"></i>
            <b style="font-size:20px; letter-spacing: 0.5px;">р╕кр╕гр╕╕р╕Ыр╕гр╕▓р╕вр╣Ар╕Фр╕╖р╕нр╕Щ</b>
            <input type="month" id="histMonth" onchange="loadHistMonth()" 
                   style="position:absolute; inset:0; opacity:0; width:100%; height:100%; cursor:pointer;">
        </div>

        <div onclick="openComparisonSelector()" 
             style="background: linear-gradient(135deg, #0ea5e9, #2563eb); border-radius: 25px; padding: 25px 15px; text-align: center; color: #fff; cursor: pointer; box-shadow: 0 10px 25px rgba(14, 165, 233, 0.25); display: flex; flex-direction: column; align-items: center; gap: 12px;">       
            <i class="fas fa-chart-line" style="font-size: 32px;"></i>
            <b style="font-size: 20px;">р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Кр╣Ир╕зр╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И</b>
        </div>
    </div>
    <div id="stats-display-area" style="margin-top: 25px;"></div>
</div>          
  <div id="p4" class="page">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; gap: 10px;">
        <div onclick="go('p0')" style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: #1e293b; background: #fff; padding: 8px 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); flex-shrink: 0;">
            <i class="fas fa-chevron-left" style="font-size: 18px;"></i>
            <span style="font-weight: 800; font-size: 16px;">р╣Ар╕бр╕Щр╕╣р╕лр╕ер╕▒р╕Б</span>
        </div>
        
        <div style="text-align: right;">
            <h3 style="margin: 0; font-size: 18px; color: var(--primary); font-weight: 900;">ЁЯТИ р╕Др╕ер╕▒р╕Зр╕Др╕зр╕▓р╕бр╕гр╕╣р╣Й</h3>
            <div style="font-size: 10px; color: var(--text); opacity: 0.6;">Barber Guide</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 25px;">
        <div class="icon-card" onclick="showHairExpert(1)" style="height: 110px; background: linear-gradient(135deg, #1e293b, #334155); color: white; border: none; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 20px;">
            <i class="fas fa-microscope" style="font-size: 24px; margin-bottom: 8px; color: #fbbf24;"></i>
            <span style="font-weight: 800; font-size: 13px;">р╣Ар╕кр╣Йр╕Щр╕Ьр╕бр╣Бр╕Хр╣Ир╕ер╕░р╣Бр╕Ър╕Ъ</span>
            <small style="font-size: 9px; opacity: 0.8;">Texture Analysis</small>
        </div>
        
        <div class="icon-card" onclick="showHairExpert(2)" style="height: 110px; background: linear-gradient(135deg, #1e3a8a, #1e40af); color: white; border: none; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 20px;">
            <i class="fas fa-user-check" style="font-size: 24px; margin-bottom: 8px; color: #60a5fa;"></i>
            <span style="font-weight: 800; font-size: 13px;">р╣Вр╕Др╕гр╕Зр╕лр╕Щр╣Йр╕▓р╕Бр╕▒р╕Ър╕Чр╕гр╕Зр╕Ьр╕б</span>
            <small style="font-size: 9px; opacity: 0.8;">Face Shape Guide</small>
        </div>
        
        <div class="icon-card" onclick="showHairExpert(3)" style="height: 110px; background: linear-gradient(135deg, #4338ca, #6366f1); color: white; border: none; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 20px;">
            <i class="fas fa-cut" style="font-size: 24px; margin-bottom: 8px; color: #a5b4fc;"></i>
            <span style="font-weight: 800; font-size: 13px;">р╕Чр╕гр╕Зр╕Ьр╕бр╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щ</span>
            <small style="font-size: 9px; opacity: 0.8;">Hairstyle Gallery</small>
        </div>
        
        <div class="icon-card" onclick="showHairExpert(4)" style="height: 110px; background: linear-gradient(135deg, #059669, #10b981); color: white; border: none; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 20px;">
            <i class="fas fa-pump-soap" style="font-size: 24px; margin-bottom: 8px; color: #6ee7b7;"></i>
            <span style="font-weight: 800; font-size: 13px;">р╕Бр╕▓р╕гр╣Ар╕Лр╕Х/р╕Ир╕▒р╕Фр╕Чр╕гр╕З</span>
            <small style="font-size: 9px; opacity: 0.8;">Styling & Finish</small>
        </div>
    </div>

    <div id="hair-info-display" class="acc-main-card" style="min-height: 200px; padding: 20px; background: #fff; border-radius: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid var(--border);">
        <div style="text-align: center; color: #94a3b8; padding-top: 40px;">
            <i class="fas fa-lightbulb" style="font-size: 30px; margin-bottom: 15px; color: #e2e8f0;"></i>
            <p style="font-size: 14px;">р╣Ар╕ер╕╖р╕нр╕Бр╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣Ир╕Фр╣Йр╕▓р╕Щр╕Ър╕Щ<br>р╣Ар╕Юр╕╖р╣Ир╕нр╕Фр╕╣р╣Ар╕Чр╕Др╕Щр╕┤р╕Др╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╣Бр╕ер╕░р╕Ир╕▒р╕Фр╕Чр╕гр╕З</p>
        </div>
    </div>
</div>
<div id="modalSet" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); backdrop-filter:blur(15px); -webkit-backdrop-filter:blur(15px); z-index:9999; display:flex; align-items:center; justify-content:center; padding:15px;">
    <div style="background:#ffffff; width:95%; max-width:420px; border-radius:35px; display:flex; flex-direction:column; overflow:hidden; animation: slideUp 0.3s ease-out; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
        
        <div style="padding: 20px 20px 10px; text-align: center;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                <div onclick="document.getElementById('modalSet').style.display='none'; document.getElementById('config-area').style.display='none';" style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: #1e293b; background: #f1f5f9; padding: 8px 15px; border-radius: 15px;">
                    <i class="fas fa-times" style="font-size: 18px;"></i>
                    <span style="font-weight: 800; font-size: 16px;">р╕Ыр╕┤р╕Ф</span>
                </div>
                <h3 style="margin: 0; font-size: 20px; color: #1e3a8a; font-weight: 900;">тЪЩя╕П р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕гр╕░р╕Ър╕Ъ</h3>
                <div style="width: 45px;"></div> 
            </div>
        </div>

        <div style="padding: 0 20px 25px;">
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-bottom:20px;">
                <div class="icon-card" onclick="handleInsurance()" style="background:#fff; border:1px solid #e2e8f0; border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer;">
                    <div style="background:linear-gradient(135deg, #fbbf24, #f59e0b); width:35px; height:35px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff; font-size:16px;"><i class="fas fa-shield-alt"></i></div>
                    <span style="color:#1e293b; font-weight:800; font-size:12px;">р╕Ыр╕гр╕░р╕Бр╕▒р╕Щ</span>
                </div>
                
                <div class="icon-card" onclick="handleHoliday()" style="background:#fff; border:1px solid #e2e8f0; border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer;">
                    <div style="background:linear-gradient(135deg, #f87171, #ef4444); width:35px; height:35px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff; font-size:16px;"><i class="fas fa-umbrella-beach"></i></div>
                    <span style="color:#1e293b; font-weight:800; font-size:12px;">р╕зр╕▒р╕Щр╕лр╕вр╕╕р╕Ф</span>
                </div>

                <div class="icon-card" onclick="document.getElementById('config-area').style.display='block'" style="background:#fff; border:1px solid #e2e8f0; border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer;">
                    <div style="background:linear-gradient(135deg, #64748b, #334155); width:35px; height:35px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff; font-size:16px;"><i class="fas fa-cog"></i></div>
                    <span style="color:#1e293b; font-weight:800; font-size:12px;">р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕гр╕░р╕Ър╕Ъ</span>
                </div>
            </div>

            <div id="config-area" style="display:none; animation: fadeIn 0.3s ease-out;">
                <input type="text" id="setShop" placeholder="р╕Кр╕╖р╣Ир╕нр╕гр╣Йр╕▓р╕Щ" style="width: 100%; height: 52px; border-radius: 16px; border: 1px solid #e2e8f0; background: #f1f5f9; text-align: center; font-size: 18px; font-weight: 700; color: #1e3a8a; margin-bottom: 10px; outline: none;">

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
                    <input type="number" id="setPerc" placeholder="% р╕Кр╣Ир╕▓р╕З" style="width:100%; height:52px; border-radius:16px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:18px; font-weight:700;">
                    <input type="number" id="setGuar" placeholder="р╕Ыр╕гр╕░р╕Бр╕▒р╕Щ" style="width:100%; height:52px; border-radius:16px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:18px; font-weight:700;">
                </div>

                <div style="margin-bottom:10px;">
                    <select id="setTheme" style="width:100%; height:52px; border-radius:16px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:16px; font-weight:700; color:#475569;">
                        <option value="light">ЁЯМд р╕Шр╕╡р╕бр╕кр╕зр╣Ир╕▓р╕З</option>
                        <option value="navy">ЁЯММ р╕Шр╕╡р╕бр╕Щр╣Йр╕│р╣Ар╕Зр╕┤р╕Щ</option>
                        <option value="dark">ЁЯМС р╕Шр╕╡р╕бр╕Фр╕│-р╕Чр╕нр╕З</option>
                    </select>
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px;">
                    <div style="position: relative; display: flex; align-items: center;">
                        <select id="setSound" style="width:100%; height:52px; border-radius:16px; border:1px solid #cbd5e1; background:#f1f5f9; text-align:center; font-size:15px; font-weight:700; appearance:none; padding-left: 35px;">
                            <option value="on">р╣Ар╕Ыр╕┤р╕Фр╣Ар╕кр╕╡р╕вр╕З</option>
                            <option value="off">р╕Ыр╕┤р╕Фр╣Ар╕кр╕╡р╕вр╕З</option>
                        </select>
                        <i class="fas fa-volume-up" style="position: absolute; left: 12px; color: #475569; pointer-events: none;"></i>
                    </div>
                    <div style="position: relative; display: flex; align-items: center;">
                        <select id="setVoice" style="width:100%; height:52px; border-radius:16px; border:1px solid #cbd5e1; background:#f1f5f9; text-align:center; font-size:15px; font-weight:700; appearance:none; padding-left: 35px;">
                            <option value="female">р╣Ар╕кр╕╡р╕вр╕Зр╕лр╕Нр╕┤р╕З</option>
                            <option value="male">р╣Ар╕кр╕╡р╕вр╕Зр╕Кр╕▓р╕в</option>
                        </select>
                        <i class="fas fa-user-friends" style="position: absolute; left: 12px; color: #475569; pointer-events: none;"></i>
                    </div>
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:20px;">
                    <button onclick="exportBackup()" style="height:48px; background:#ffffff; border:1px solid #cbd5e1; border-radius:12px; font-size:11px; font-weight:800; display:flex; flex-direction:column; align-items:center; justify-content:center;">
                        <i class="fas fa-file-download"></i> <span>р╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е</span>
                    </button>
                    <button onclick="document.getElementById('fileInput').click()" style="height:48px; background:#ffffff; border:1px solid #cbd5e1; border-radius:12px; font-size:11px; font-weight:800; display:flex; flex-direction:column; align-items:center; justify-content:center;">
                        <i class="fas fa-file-upload"></i> <span>р╕Др╕╖р╕Щр╕Др╣Ир╕▓</span>
                    </button>
                    <button onclick="clearData()" style="height:48px; background:#fff1f2; border:1px solid #fecaca; border-radius:12px; font-size:11px; font-weight:800; color:#e11d48; display:flex; flex-direction:column; align-items:center; justify-content:center;">
                        <i class="fas fa-trash-alt"></i> <span>р╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е</span>
                    </button>
                </div>

                <div style="display:grid; grid-template-columns: 2fr 1.2fr; gap:12px;">
                    <button onclick="saveSettings()" style="background:#1e3a8a; color:#fff; height:55px; border-radius:20px; border:none; font-weight:800;">р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е</button>
                    <button onclick="document.getElementById('config-area').style.display='none'" style="background:#f1f5f9; color:#64748b; height:55px; border-radius:20px; border:none; font-weight:800;">р╕Лр╣Ир╕нр╕Щ</button>
                </div>
            </div>

            <div style="text-align:center; line-height: 1.4; margin-top: 15px;">
                <div style="font-size:10px; color:#94a3b8; font-weight:600;">V.<span id="display-version">1.0.7</span></div>
                <div style="font-size:9px; color:#cbd5e1;">Update: 22/02/2026</div>
            </div>
        </div>
    </div>
</div>
    <div id="reportModal" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 id="reportTitle" style="margin:0; color:#1a237e;">ЁЯУК р╕гр╕▓р╕вр╕Зр╕▓р╕Щ</h3>
            <button onclick="closeReportModal()" style="background:#fee2e2; color:#dc2626; border:none; width:35px; height:35px; border-radius:50%; font-size:18px; cursor:pointer;">тЬХ</button>
        </div>
        <div id="reportContent" style="max-height:400px; overflow-y:auto;"></div>
    </div>
</div>
<div id="historyModal" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0; color:#1a237e;">ЁЯУЬ р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╣Ар╕Др╕ер╕╡р╕вр╕гр╣Мр╣Ар╕Зр╕┤р╕Щ</h3>
            <button onclick="closeHistoryModal()" style="background:#fee2e2; color:#dc2626; border:none; width:35px; height:35px; border-radius:50%; font-size:18px; cursor:pointer;">тЬХ</button>
        </div>
        <div id="accHistory" style="max-height:400px; overflow-y:auto;"></div>
    </div>
</div>
<div id="linePreview" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center; padding:20px;">
    <div style="background:#fff; width:100%; max-width:450px; padding:20px; border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,0.2);">
        <h3 style="margin:0 0 15px 0; color:#1e293b; font-size:18px; display:flex; align-items:center; gap:8px;">ЁЯУЭ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕гр╕▓р╕вр╕Зр╕▓р╕Щ</h3>
        <textarea id="msgEdit" style="width:100%; height:300px; padding:12px; border:1px solid #cbd5e1; border-radius:10px; font-family:sans-serif; font-size:14px; line-height:1.5; outline:none; resize:none;"></textarea>
        <div style="display:flex; gap:10px; margin-top:15px;">
            <button onclick="document.getElementById('linePreview').style.display='none'" style="flex:1; padding:12px; background:#f1f5f9; color:#475569; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">р╕вр╕Бр╣Ар╕ер╕┤р╕Б</button>
            <button onclick="sendToLineFinal()" style="flex:1; padding:12px; background:#22c55e; color:#fff; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">р╕кр╣Ир╕Зр╣Ар╕Вр╣Йр╕▓ LINE тЬЕ</button>
        </div>
    </div>
</div>
    <nav></nav>
 <script>
 /* ==========================================================
   SECTION 1: INITIALIZATION & GLOBAL VARIABLES
   (р╕кр╣Ир╕зр╕Щр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╣Бр╕ер╕░р╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕лр╕ер╕▒р╕Б)
   ========================================================== */
const $ = (id) => document.getElementById(id);
// 1. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Ар╕ер╕Вр╣Ар╕зр╕нр╕гр╣Мр╕Кр╕▒р╕Щр╣Бр╕ер╕░р╕зр╕▒р╕Щр╕Чр╕╡р╣И
const APP_VERSION = "1.0.7"; 
const LAST_UPDATED = "22/02/2026"; 
// 2. р╕гр╕░р╕Ър╕Ър╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ (р╣Гр╕кр╣Ир╣Др╕зр╣Йр╕Хр╕гр╕Зр╕Щр╕╡р╣Йр╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕Чр╕│р╕Зр╕▓р╕Щр╕Чр╕▒р╕Щр╕Чр╕╡р╕Чр╕╡р╣Ир╣Вр╕лр╕ер╕Фр╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣М)
(function autoUpdate() {
    const currentStoredVersion = localStorage.getItem("app_v");
    if (currentStoredVersion !== APP_VERSION) {
        localStorage.setItem("app_v", APP_VERSION);
        if ('caches' in window) {
            caches.keys().then(names => {
                for (let name of names) caches.delete(name);
            });
        }
        // р╕Ър╕▒р╕Зр╕Др╕▒р╕Ър╕гр╕╡р╣Вр╕лр╕ер╕Фр╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕▒р╕Ър╣Вр╕Др╣Йр╕Фр╣Гр╕лр╕бр╣И
        window.location.reload(true);
    }
})();
// 3. р╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕лр╕ер╕▒р╕Бр╕Вр╕нр╕Зр╕гр╕░р╕Ър╕Ъ
let db = JSON.parse(localStorage.getItem("barber_db")) || [];
let archives = JSON.parse(localStorage.getItem("barber_archives")) || [];
let account = JSON.parse(localStorage.getItem("barber_account")) || { balance: 0, logs: [] };
let conf = JSON.parse(localStorage.getItem("barber_conf")) || { shop: "Barber Shop", perc: 50, guar: 0 };
let payMethod = "";
// 4. р╕кр╕▒р╣Ир╕Зр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╣Ар╕ер╕Вр╣Ар╕зр╕нр╕гр╣Мр╕Кр╕▒р╕Щр╣Бр╕ер╕░р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Ър╕Щр╕лр╕Щр╣Йр╕▓р╕Ир╕н
document.addEventListener("DOMContentLoaded", () => {
    if ($("display-version")) $("display-version").innerText = APP_VERSION;
    if ($("display-date")) $("display-date").innerText = LAST_UPDATED;
});
function go(p) {
    // 1. р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Бр╕▓р╕гр╕Лр╣Ир╕нр╕Щ/р╣Бр╕кр╕Фр╕Зр╕лр╕Щр╣Йр╕▓
    document.querySelectorAll('.page').forEach(pg => {
        pg.classList.remove('active');
        pg.style.display = 'none'; 
    });
    let targetId = (typeof p === 'number') ? 'p' + p : p;
    const targetPage = document.getElementById(targetId);

    if (targetPage) {
        targetPage.classList.add('active');
        targetPage.style.display = 'block';
    }
    // 2. р╕Цр╣Йр╕▓р╕Бр╕ер╕▒р╕Ър╕бр╕▓р╕лр╕Щр╣Йр╕▓ Dashboard (p0) р╣Гр╕лр╣Йр╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕бр╕▓р╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╣Гр╕лр╕бр╣Ир╣Ар╕кр╕бр╕н
    if (targetId === 'p0') {
        updateDashboardStats();
        // р╕ер╣Зр╕нр╕Др╕Кр╕╖р╣Ир╕нр╕лр╕Щр╣Йр╕▓р╣Ар╕бр╕Щр╕╣р╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щр╕Кр╕╖р╣Ир╕нр╣Бр╕нр╕Ыр╕Цр╕▓р╕зр╕г р╣Др╕бр╣Ир╣Гр╕лр╣Йр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Хр╕▓р╕бр╕Кр╕╖р╣Ир╕нр╕гр╣Йр╕▓р╕Щ
        const shopTitleEl = document.querySelector('#p0 h2'); 
        if (shopTitleEl) shopTitleEl.innerText = "BARBER NOTE PRO";
    }
    // 3. р╕Ир╕▒р╕Фр╕Бр╕▓р╕г Nav Bar (р╕Цр╣Йр╕▓р╕Кр╣Ир╕▓р╕Зр╕вр╕▒р╕Зр╕бр╕╡р╣Гр╕Кр╣Йр╕нр╕вр╕╣р╣И)
    document.querySelectorAll('.nav-item').forEach((btn, i) => {
        btn.classList.toggle('active', (i + 1) === p);
    });
    // 4. р╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕Вр╕Юр╕┤р╣Ар╕ир╕йр╕Хр╕▓р╕бр╕лр╕Щр╣Йр╕▓р╕вр╣Ир╕нр╕в
    const dateVal = document.getElementById("dateInp")?.value || new Date().toISOString().split('T')[0];
    // р╕лр╕Щр╣Йр╕▓р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Зр╕▓р╕Щ (p1) - р╕Цр╣Йр╕▓р╕Кр╣Ир╕▓р╕Зр╕нр╕вр╕▓р╕Бр╣Гр╕лр╣Йр╣Бр╕кр╕Фр╕Зр╕Кр╕╖р╣Ир╕нр╕гр╣Йр╕▓р╕Щр╣Ар╕Йр╕Юр╕▓р╕░р╕лр╕Щр╣Йр╕▓р╕Щр╕╡р╣Й
    if (targetId === 'p1') {
        const savedShopName = localStorage.getItem("shopName") || "BARBER SHOP";
        const shopTitleP1 = document.querySelector('#p1 h3'); 
        if (shopTitleP1) shopTitleP1.innerText = "ЁЯУЭ " + savedShopName;
    }

    if (p === 2 || p === 'p2') { if (typeof renderDay === 'function') renderDay(dateVal); }
    if (p === 3 || p === 'p3') { if (typeof loadAccountStatus === 'function') loadAccountStatus(); }

    window.scrollTo({ top: 0, behavior: 'smooth' });
}
// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕гр╕╣р╕Ыр╣Бр╕ер╕░р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б
function uploadLogo(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            // 1. р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕гр╕╣р╕Ыр╕Ър╕Щр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕Чр╕▒р╕Щр╕Чр╕╡
            document.getElementById('mainLogo').src = e.target.result;
            // 2. р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕гр╕╣р╕Ыр╣Др╕зр╣Йр╣Гр╕Щ LocalStorage (р╣Ар╕Лр╕Яр╕ер╕Зр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕З)
            localStorage.setItem('userLogo', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
    }
}
// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Фр╕╢р╕Зр╕гр╕╣р╕Ыр╣Ар╕Фр╕┤р╕бр╕Чр╕╡р╣Ир╣Ар╕Др╕вр╣Ар╕Лр╕Яр╣Др╕зр╣Йр╕бр╕▓р╣Вр╕Кр╕зр╣М (р╣Гр╕лр╣Йр╣Ар╕гр╕╡р╕вр╕Бр╣Гр╕Кр╣Йр╕Хр╕нр╕Щр╣Вр╕лр╕ер╕Фр╣Бр╕нр╕Ы)
function loadSavedLogo() {
    const savedLogo = localStorage.getItem('userLogo');
    if (savedLogo) {
        const logoImg = document.getElementById('mainLogo');
        if (logoImg) logoImg.src = savedLogo;
    }
}
// р╣Ар╕гр╕╡р╕вр╕Бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Хр╕нр╕Щр╣Вр╕лр╕ер╕Фр╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ъ
window.addEventListener('load', loadSavedLogo);
function updateDateDisplay(v) {
    if (!v) return;
    // 1. р╣Бр╕вр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣И (v р╕Ир╕░р╣Ар╕Ыр╣Зр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ 2026-02-13)
    const [y, m, d] = v.split('-');
    // 2. р╕Др╕│р╕Щр╕зр╕Ур╕Ыр╕╡ р╕Ю.р╕и. р╣Бр╕Ър╕Ър╕кр╕нр╕Зр╕лр╕ер╕▒р╕Б (2026 + 543 = 2569 -> р╕Хр╕▒р╕Фр╣Ар╕лр╕ер╕╖р╕н 69)
    const thaiYearFull = parseInt(y) + 543;
    const thaiYearShort = thaiYearFull.toString().slice(-2); 
    // 3. р╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╣Ар╕Фр╕╖р╕нр╕Щр╕вр╣Ир╕н
    const months = ['р╕б.р╕Д.', 'р╕Б.р╕Ю.', 'р╕бр╕╡.р╕Д.', 'р╣Ар╕б.р╕в.', 'р╕Ю.р╕Д.', 'р╕бр╕┤.р╕в.', 'р╕Б.р╕Д.', 'р╕к.р╕Д.', 'р╕Б.р╕в.', 'р╕Х.р╕Д.', 'р╕Ю.р╕в.', 'р╕Ш.р╕Д.'];
    // 4. тЬи р╕Ир╕▒р╕Фр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г: "13 р╕Б.р╕Ю. 69"
    const formattedDate = `${parseInt(d)} ${months[parseInt(m)-1]} ${thaiYearShort}`;
    // 5. р╕Щр╕│р╣Др╕Ыр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╣Гр╕Щр╕Ир╕╕р╕Фр╕Хр╣Ир╕▓р╕Зр╣Ж
    const el = document.getElementById("dateDisplay");
    if (el) el.innerText = formattedDate;
    // р╕Цр╣Йр╕▓р╕бр╕╡р╕Ир╕╕р╕Фр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╣Гр╕Щр╕лр╕Щр╣Йр╕▓р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б (р╕лр╕Щр╣Йр╕▓ 2) р╕Бр╣Зр╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Фр╣Йр╕зр╕вр╕Др╕гр╕▒р╕Ъ
    const el2 = document.getElementById("displayDateThai");
    if (el2) el2.innerText = formattedDate;
    // р╕кр╕▒р╣Ир╕Зр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╕бр╣Ир╕Хр╕▓р╕бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕ер╕╖р╕нр╕Б
    if (typeof renderDay === "function") renderDay(v);
}
/* ==========================================================
   SECTION 2: CORE DATA & BACKUP SYSTEM
   (р╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕ер╕░р╕гр╕░р╕Ър╕Ър╕кр╕│р╕гр╕нр╕З/р╕Бр╕╣р╣Йр╕Др╕╖р╕Щ)
   ========================================================== */
function saveDB() {
    try {
        localStorage.setItem("barber_db", JSON.stringify(db));
        localStorage.setItem("barber_archives", JSON.stringify(archives));
        localStorage.setItem("barber_account", JSON.stringify(account));
        localStorage.setItem("barber_conf", JSON.stringify(conf));
        console.log("ЁЯТ╛ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕зр╕Др╕гр╕▒р╕Ъ");
    } catch (e) {
        console.error("тЭМ р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Др╕Фр╣Й:", e);
    }
}
// 1. р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╣Ир╕Зр╕нр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е (Backup)
function exportBackup() {
    try {
        const data = {
            db: JSON.parse(localStorage.getItem("barber_db") || "[]"),
            archives: JSON.parse(localStorage.getItem("barber_archives") || "[]"),
            account: account, // р╕гр╕зр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ър╕▒р╕Нр╕Кр╕╡р╣Др╕Ыр╕Фр╣Йр╕зр╕в
            settings: JSON.parse(localStorage.getItem("barber_settings") || "{}")
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `full-backup-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        alert("тЬЕ р╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕гр╕зр╕бр╕Ър╕▒р╕Нр╕Кр╕╡р╕кр╕│р╣Ар╕гр╣Зр╕И");
    } catch (e) { alert("р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕Фр╣Й"); }
}
// 2. р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Щр╕│р╣Ар╕Вр╣Йр╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕▓р╕Бр╣Др╕Яр╕ер╣М (Import)
function importBackup(input) {
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            if(confirm("тЪая╕П р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕Щр╕│р╣Ар╕Вр╣Йр╕▓? р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Фр╕┤р╕бр╕Ир╕░р╕Цр╕╣р╕Бр╕ер╕Ър╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З")) {
                localStorage.clear(); // р╕ер╣Йр╕▓р╕Зр╕Вр╕нр╕Зр╣Ар╕Бр╣Ир╕▓р╕Чр╕┤р╣Йр╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
                localStorage.setItem("barber_db", JSON.stringify(data.db || []));
                localStorage.setItem("barber_archives", JSON.stringify(data.archives || []));
                localStorage.setItem("barber_account", JSON.stringify(data.account || { balance: 0, logs: [] }));
                localStorage.setItem("barber_settings", JSON.stringify(data.settings || {}));
                alert("тЬЕ р╕Щр╕│р╣Ар╕Вр╣Йр╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И р╕гр╕░р╕Ър╕Ър╕Ир╕░р╣Ар╕гр╕┤р╣Ир╕бр╣Гр╕лр╕бр╣Ир╕Др╕гр╕▒р╕Ъ");
                location.reload();
            }
        } catch(err) { alert("тЭМ р╣Др╕Яр╕ер╣Мр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З"); }
    };
    if (input.files && input.files[0]) reader.readAsText(input.files[0]);
}
// 3. р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Др╕╖р╕Щр╕Др╣Ир╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕е (Restore р╕Ир╕▓р╕Бр╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕Хр╕гр╕Зр╣Ж)
function restoreData(jsonData) {
    try {
        const data = JSON.parse(jsonData);
        // 1. р╕Др╕╖р╕Щр╕Др╣Ир╕▓р╕Хр╕▒р╕зр╣Бр╕Ыр╕г
        account = data.account || { balance: 0, logs: [] };
        archives = data.archives || []; 
        // 2. р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕ер╕З Storage р╕Чр╕▒р╕Щр╕Чр╕╡ (р╣Гр╕Кр╣Йр╕Кр╕╖р╣Ир╕н Key р╣Гр╕лр╣Йр╕Хр╕гр╕Зр╕Бр╕▒р╕Ър╕гр╕░р╕Ър╕Ър╕Вр╕нр╕Зр╕Др╕╕р╕У)
        localStorage.setItem("barber_account", JSON.stringify(account));
        localStorage.setItem("barber_archives", JSON.stringify(archives));
        // р╕Цр╣Йр╕▓р╕Др╕╕р╕Ур╕бр╕╡р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ save() р╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╣Ар╕Вр╕╡р╕вр╕Щр╕Др╣Ир╕▓р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з р╣Гр╕лр╣Йр╣Ар╕гр╕╡р╕вр╕Бр╣Гр╕Кр╣Й
        if (typeof save === "function") save();
        alert("тЬЕ р╕Др╕╖р╕Щр╕Др╣Ир╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕ер╕░р╕ер╣Йр╕▓р╕Зр╕вр╕нр╕Фр╕Ър╕▒р╕Нр╕Кр╕╡р╣Ар╕Фр╕┤р╕бр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕зр╕Др╕гр╕▒р╕Ъ");
        // 3. р╕гр╕╡р╣Ар╕Яр╕гр╕Кр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╣Ар╕Юр╕╖р╣Ир╕нр╕ер╣Йр╕▓р╕Зр╕Др╣Ир╕▓р╕Др╣Йр╕▓р╕Зр╣Гр╕Щр╕Др╕зр╕▓р╕бр╕Ир╕│р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕З
        location.reload(); 
        
    } catch (e) {
        alert("тЭМ р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Др╕╖р╕Щр╕Др╣Ир╕▓р╣Др╕Фр╣Й р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З");
    }
}
// 4. р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕нр╕Ы (Hard Reset)
function clearData() {
        const confirmDelete = confirm("тЪая╕П р╕Др╕╕р╕Ур╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Гр╕Щр╕гр╕░р╕Ър╕Ър╣Гр╕Кр╣Ир╕лр╕гр╕╖р╕нр╣Др╕бр╣И? р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ър╕▒р╕Нр╕Кр╕╡р╣Бр╕ер╕░р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Ир╕░р╕Цр╕╣р╕Бр╕ер╣Йр╕▓р╕Зр╣Гр╕лр╕бр╣Ир╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф");
                if (confirmDelete) {
                    // р╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╕р╕Бр╕нр╕вр╣Ир╕▓р╕Зр╕Чр╕╡р╣Ир╣Бр╕нр╕Ыр╣Ар╕Бр╣Зр╕Ър╣Др╕зр╣Й
                    localStorage.clear(); 
                    alert("тЬЕ р╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕гр╕░р╕Ър╕Ър╣Бр╕ер╕░р╕Ър╕▒р╕Нр╕Кр╕╡р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з");
                    location.reload(); // р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕Бр╕ер╕▒р╕Ър╣Др╕Ыр╣Ар╕Ыр╣Зр╕Щ 0
                }
            }

function clearAllData(){if(confirm("р╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф?")){localStorage.clear();location.reload()}}            
/* ==========================================================
   SECTION 3: DAILY WORK INPUT & FORM HANDLING
   (р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Бр╕Ър╕Ър╕Яр╕нр╕гр╣Мр╕бр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Зр╕▓р╕Щр╕гр╕▓р╕вр╕зр╕▒р╕Щ)
   ========================================================== */
function addRecord() {
    const dInp = $("dateInp").value;
    const timeInp = $("timeInp").value;
    const price = parseFloat($("priceInp").value) || 0;
    const tip = parseFloat($("tipInp").value) || 0;
    const total = price + tip; 
    
    const currentPay = payMethod; 
    if (price === 0 && currentPay !== 'Holiday' && currentPay !== 'Guarantee') {
        alert("р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕░р╕Ър╕╕р╕гр╕▓р╕Др╕▓");
        return;
    }

    let finalCash = 0;
    let finalTrans = 0;
    if (currentPay === 'Mix') {
        finalCash = parseFloat($("mixCash").value) || 0;
        finalTrans = parseFloat($("mixTrans").value) || 0;
    } else if (currentPay === 'Cash' || currentPay === 'р╣Ар╕Зр╕┤р╕Щр╕кр╕Ф') {
        finalCash = total;
        finalTrans = 0;
    } else if (currentPay === 'Trans' || currentPay === 'р╣Вр╕нр╕Щ') {
        finalCash = 0;
        finalTrans = total;
    }

    const newRec = {
        id: Date.now(),
        date: dInp,
        time: timeInp,
        price: price,
        tip: tip,
        pay: currentPay, 
        svcs: selectedServices,
        payCash: finalCash,
        payTrans: finalTrans
    };

    db.push(newRec);
    localStorage.setItem("barber_db", JSON.stringify(db));

    if (typeof calculateMoney === "function") {
        const result = calculateMoney(); 
        const idx = archives.findIndex(a => a.date === dInp);
        const archiveData = {
            date: dInp,
            settle: result.settle, 
            type: (currentPay === 'Holiday') ? 'HOLIDAY' : 'WORK'
        };

        if (idx > -1) {
            archives[idx].settle = result.settle; 
        } else {
            archives.push(archiveData); 
        }
        localStorage.setItem("barber_archives", JSON.stringify(archives));
    }

    // --- ЁЯЫбя╕П р╕кр╣Ир╕зр╕Щр╕Чр╕╡р╣Ир╣Ар╕Юр╕┤р╣Ир╕бр╣Гр╕лр╕бр╣И: р╕Ыр╕ер╕Фр╕ер╣Зр╕нр╕Др╕Ыр╕╕р╣Ир╕бр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╕Щр╕Чр╕╡р╕Чр╕╡р╣Ир╕бр╕╡р╕Зр╕▓р╕Щр╣Гр╕лр╕бр╣И ---
   const btn = document.getElementById("btnSubmitSend");
const icon = document.getElementById("btnIcon");
if (btn) {
    btn.disabled = false; // р╕Ыр╕ер╕Фр╕ер╣Зр╕нр╕Б
    btn.style.background = "#ff6f00"; // р╕Бр╕ер╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щр╕кр╕╡р╕кр╣Йр╕б
    if (icon) icon.className = "fas fa-paper-plane"; // р╕Бр╕ер╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щр╣Др╕нр╕Др╕нр╕Щр╕Ир╕гр╕зр╕Ф
    btn.style.cursor = "pointer";
}
    // -------------------------------------------------------
    alert("р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в");

    if (typeof resetForm === 'function') resetForm();
    if (typeof renderDay === 'function') renderDay();
    
    // ЁЯОп р╣Ар╕гр╕╡р╕вр╕Бр╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕вр╕нр╕Фр╕лр╕Щр╣Йр╕▓р╕Ър╕▒р╕Нр╕Кр╕╡р╕Чр╕▒р╕Щр╕Чр╕╡
    if (typeof loadAccountStatus === 'function') loadAccountStatus();
} // <--- ЁЯЯв р╕Ыр╕┤р╕Фр╕Ыр╕╡р╕Бр╕Бр╕▓р╕Хр╕▒р╕зр╕кр╕╕р╕Фр╕Чр╣Йр╕▓р╕вр╣Бр╕Др╣Ир╕Хр╕гр╕Зр╕Щр╕╡р╣Йр╕Юр╕нр╕Др╕гр╕▒р╕Ър╕Кр╣Ир╕▓р╕З
 // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕ер╣Йр╕▓р╕Зр╕Др╣Ир╕▓р╣Гр╕Щр╕Яр╕нр╕гр╣Мр╕бр╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б
function resetForm() {
    // 1. р╕ер╣Йр╕▓р╕Зр╕Хр╕▒р╕зр╣Ар╕ер╕Вр╣Гр╕Щр╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е
    if ($("priceInp")) $("priceInp").value = "";
    if ($("tipInp")) $("tipInp").value = "";
    if ($("mixCash")) $("mixCash").value = "";
    if ($("mixTrans")) $("mixTrans").value = ""; // р╣Бр╕Бр╣Йр╣Др╕Вр╕Хр╕гр╕Зр╕Щр╕╡р╣Йр╣Гр╕лр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕Др╕гр╕▒р╕Ъ
    // 2. р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕Бр╕▓р╕гр╕Ир╣Ир╕▓р╕вр╣Ар╕Зр╕┤р╕Щ
    if ($("mixPanel")) $("mixPanel").style.display = "none"; 
    // р╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕зр╕┤р╕Шр╕╡р╕Ир╣Ир╕▓р╕вр╣Ар╕Зр╕┤р╕Щр╕Бр╕ер╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щ "р╣Ар╕Зр╕┤р╕Щр╕кр╕Ф" р╣Ар╕Ыр╣Зр╕Щр╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ
    payMethod = "Cash"; 
    if (typeof setPaymentType === "function") {
        setPaymentType('Cash'); 
    }
    // 3. р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Ър╕гр╕┤р╕Бр╕▓р╕г (Services)
    selectedServices = []; 
    // р╕ер╣Йр╕▓р╕Зр╕кр╕Цр╕▓р╕Щр╕░р╕кр╕╡р╕Вр╕нр╕Зр╕Ыр╕╕р╣Ир╕бр╕Чр╕╡р╣Ир╕Бр╕Фр╣Ар╕ер╕╖р╕нр╕Бр╣Др╕зр╣Й
    const serviceButtons = document.querySelectorAll('.service-btn');
    serviceButtons.forEach(btn => btn.classList.remove('selected', 'active', 'bg-blue-500')); // р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕ер╕▓р╕кр╕Чр╕╡р╣Ир╕Кр╣Ир╕▓р╕Зр╣Гр╕Кр╣Йр╕нр╕нр╕Бр╣Гр╕лр╣Йр╕лр╕бр╕Ф
    // 4. р╕Хр╕▒р╣Йр╕Зр╣Ар╕зр╕ер╕▓р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╣Гр╕лр╕бр╣Ир╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щр╣Ар╕зр╕ер╕▓р╕ер╣Ир╕▓р╕кр╕╕р╕Ф
    const n = new Date();
    const t = n.getHours().toString().padStart(2, '0') + ':' + n.getMinutes().toString().padStart(2, '0'); 
    if ($("timeInp")) $("timeInp").value = t;
    console.log("ЁЯз╣ р╕ер╣Йр╕▓р╕Зр╕Яр╕нр╕гр╣Мр╕бр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕гр╕▒р╕Ър╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕гр╕▓р╕вр╣Гр╕лр╕бр╣Ир╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╕Др╕гр╕▒р╕Ъ");
}
// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Ар╕Ыр╕┤р╕Ф/р╕Ыр╕┤р╕Ф mixPanel р╕Хр╕▓р╕бр╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Бр╕зр╕┤р╕Шр╕╡р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ
function togglePayType() {
    const payType = $("payTypeInp").value;
    const panel = $("mixPanel");
    
    if (payType === 'Mix') {
        panel.style.display = "block";
        // р╣Гр╕кр╣Ир╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╣Гр╕лр╣Йр╕Кр╣Ир╕нр╕Зр╣Вр╕нр╕Щ = р╕вр╕нр╕Фр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
        const total = (parseFloat($("priceInp").value) || 0) + (parseFloat($("tipInp").value) || 0);
        $("mixCash").value = "";
        $("mixTrans").value = total;
    } else {
        panel.style.display = "none";
    }
}
// р╣Ар╕бр╕╖р╣Ир╕нр╕Бр╕гр╕нр╕Б "р╣Ар╕Зр╕┤р╕Щр╕кр╕Ф" р╣Гр╕лр╣Й "р╣Ар╕Зр╕┤р╕Щр╣Вр╕нр╕Щ" р╕ер╕Фр╕ер╕Зр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
$("mixCash").addEventListener("input", function() {
    const total = (parseFloat($("priceInp").value) || 0) + (parseFloat($("tipInp").value) || 0);
    const cash = parseFloat(this.value) || 0;
    const remain = total - cash;
    $("mixTrans").value = remain > 0 ? remain : 0;
});    
 function addMinutes(time, mins) {
                if (!time) return "";
                const [h, m] = time.split(":").map(Number);
                const d = new Date();
                d.setHours(h, m + mins, 0, 0);
                return d.toTimeString().slice(0, 5);
            }

function speak(txt) {
    // ЁЯЯв р╣Ар╕Юр╕┤р╣Ир╕бр╕кр╣Ир╕зр╕Щр╕Щр╕╡р╣Й: р╕Цр╣Йр╕▓р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Ыр╕┤р╕Фр╣Ар╕кр╕╡р╕вр╕Зр╣Др╕зр╣Й р╣Гр╕лр╣Йр╕лр╕вр╕╕р╕Фр╕Чр╕│р╕Зр╕▓р╕Щр╕Чр╕▒р╕Щр╕Чр╕╡ р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Юр╕╣р╕Ф
    if (typeof conf !== 'undefined' && conf.sound === "off") {
        console.log("р╕Ыр╕┤р╕Фр╣Ар╕кр╕╡р╕вр╕Зр╕нр╕вр╕╣р╣Ир╕Др╕гр╕▒р╕Ъ");
        return; 
    }

    if ('speechSynthesis' in window) {
        // 1. р╕кр╕▒р╣Ир╕Зр╣Гр╕лр╣Йр╕лр╕вр╕╕р╕Фр╕Юр╕╣р╕Фр╕Ыр╕гр╕░р╣Вр╕вр╕Др╕Бр╣Ир╕нр╕Щр╕лр╕Щр╣Йр╕▓р╕Чр╕▒р╕Щр╕Чр╕╡
        window.speechSynthesis.cancel();

        const msg = new SpeechSynthesisUtterance(txt);
        // 2. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Ар╕кр╕╡р╕вр╕Зр╕ар╕▓р╕йр╕▓р╣Др╕Чр╕в
        msg.lang = 'th-TH'; 
        
        // 3. р╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕Зр╣Ар╕кр╕╡р╕вр╕З
        msg.pitch = 0.8;  
        msg.rate = 1.0;   
        msg.volume = 1;   

        // 4. р╕Др╣Йр╕Щр╕лр╕▓р╣Ар╕кр╕╡р╕вр╕Зр╕Ьр╕╣р╣Йр╕Кр╕▓р╕в (р╕Цр╣Йр╕▓р╕бр╕╡)
        const voices = window.speechSynthesis.getVoices();
        const maleVoice = voices.find(v => v.lang === 'th-TH' && (v.name.includes('Male') || v.name.includes('р╕Кр╕▓р╕в')));
        if (maleVoice) {
            msg.voice = maleVoice;
        }
        
        window.speechSynthesis.speak(msg);
    } else {
        console.warn("р╣Ар╕Ър╕гр╕▓р╕зр╣Мр╣Ар╕Лр╕нр╕гр╣Мр╕Щр╕╡р╣Йр╣Др╕бр╣Ир╕гр╕нр╕Зр╕гр╕▒р╕Ър╕гр╕░р╕Ър╕Ър╣Ар╕кр╕╡р╕вр╕Зр╕Юр╕╣р╕Фр╕Др╕гр╕▒р╕Ъ");
    }
}
// р╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Зр╕▓р╕Щр╕Кр╕▒р╣Ир╕зр╕Др╕гр╕▓р╕з
 function delRec(id) { if (confirm("р╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Щр╕╡р╣Й?")) { db = db.filter(r => r.id !== id); saveDB(); renderDay(); } }
// р╣Бр╕Бр╣Йр╣Др╕Вр╣Ар╕зр╕ер╕▓р╕Чр╕│р╕Зр╕▓р╕Щ
function editTime(id) {
    const rec = db.find(r => r.id === id);
    if (!rec) return;
    
    const newStart = prompt("тП▒я╕П р╣Бр╕Бр╣Йр╣Ар╕зр╕ер╕▓р╣Ар╕гр╕┤р╣Ир╕б (HH:MM)", rec.time);
    if (!newStart) return;
    
    const newEnd = prompt("тП▒я╕П р╣Бр╕Бр╣Йр╣Ар╕зр╕ер╕▓р╣Ар╕кр╕гр╣Зр╕И (HH:MM)", rec.endTime || "");
    
    rec.time = newStart;
    // р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡р╣Ар╕зр╕ер╕▓р╣Ар╕кр╕гр╣Зр╕И р╣Гр╕лр╣Йр╕Ър╕зр╕Бр╣Др╕Ы 30 р╕Щр╕▓р╕Чр╕╡р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
    rec.endTime = newEnd || (typeof addMinutes === 'function' ? addMinutes(newStart, 30) : "");
    
    saveDB();
    renderDay();
}
function setPaymentType(m) {
    // 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Ар╕Ыр╣Зр╕Щр╕Бр╕▓р╕гр╕Бр╕Фр╕Лр╣Йр╕│р╕Ыр╕╕р╣Ир╕бр╣Ар╕Фр╕┤р╕бр╕лр╕гр╕╖р╕нр╣Др╕бр╣И (Toggle Off)
    if (typeof payMethod !== 'undefined' && payMethod === m) {
        payMethod = ''; // р╕ер╣Йр╕▓р╕Зр╕Др╣Ир╕▓р╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕Ир╣Ир╕▓р╕вр╣Ар╕Зр╕┤р╕Щ
        // р╕Др╕╖р╕Щр╕Др╣Ир╕▓р╕Чр╕╕р╕Бр╕Ыр╕╕р╣Ир╕бр╣Гр╕лр╣Йр╕Бр╕ер╕▒р╕Ър╕бр╕▓р╣Ар╕Ыр╣Зр╕Щр╕кр╕╡р╕Ыр╕Бр╕Хр╕┤
        ['btnCash', 'btnTrans', 'btnMix'].forEach(id => {
            const el = $(id);
            if (el) el.className = 'btn btn-pay'; 
        });

        if ($("mixPanel")) $("mixPanel").style.display = 'none';
        return;
    }
    // 2. р╕Цр╣Йр╕▓р╣Ар╕Ыр╣Зр╕Щр╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Бр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╣Гр╕лр╕бр╣И (Toggle On)
    payMethod = m;

    const btns = {
        'Cash': { id: 'btnCash', active: 'active-cash' },
        'Trans': { id: 'btnTrans', active: 'active-trans' },
        'Mix': { id: 'btnMix', active: 'active-mix' }
    };
    // р╕Ыр╕гр╕▒р╕Ър╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕Цр╕▓р╕Щр╕░р╕Ыр╕╕р╣Ир╕бр╕Хр╕▓р╕бр╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Б
    Object.keys(btns).forEach(key => {
        const target = $(btns[key].id);
        if (target) {
            if (m === key) {
                // р╕Ыр╕╕р╣Ир╕бр╕Чр╕╡р╣Ир╣Ар╕ер╕╖р╕нр╕Б: р╣Гр╕кр╣Ир╕кр╕╡р╕Хр╕▓р╕бр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Бр╕▓р╕гр╕Ир╣Ир╕▓р╕в
                target.className = `btn btn-pay ${btns[key].active}`;
            } else {
                // р╕Ыр╕╕р╣Ир╕бр╕Чр╕╡р╣Ир╣Др╕бр╣Ир╣Др╕Фр╣Йр╣Ар╕ер╕╖р╕нр╕Б: р╕Чр╕│р╣Гр╕лр╣Йр╕Фр╕╣р╕Ир╕▓р╕Зр╕ер╕З
                target.className = `btn btn-pay is-inactive`;
            }
        }
    });
    // 3. р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Бр╕Ьр╕Зр╕Ир╣Ир╕▓р╕вр╣Бр╕Ър╕Ър╕Ьр╕кр╕б (Mix Panel)
    const mixPanel = $("mixPanel");
    if (mixPanel) {
        if (m === 'Mix') {
            mixPanel.style.display = 'block';
            // р╕Др╕│р╕Щр╕зр╕Ур╕вр╕нр╕Фр╕гр╕зр╕бр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╕Щр╕│р╣Др╕Ыр╣Гр╕кр╣Ир╣Гр╕Щр╕Кр╣Ир╕нр╕З Mix р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
            const price = parseFloat($("priceInp")?.value) || 0;
            const tip = parseFloat($("tipInp")?.value) || 0;
            const total = price + tip;
            // р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╣Гр╕лр╣Й MixTrans р╣Ар╕Ыр╣Зр╕Щр╕вр╕нр╕Фр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф р╣Бр╕ер╕░ MixCash р╣Ар╕Ыр╣Зр╕Щ 0 (р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Ыр╕гр╕▒р╕Ър╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕нр╕З)
            if ($("mixCash")) $("mixCash").value = ""; 
            if ($("mixTrans")) $("mixTrans").value = total > 0 ? total : "";   
            // р╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╣Др╕Ыр╕Чр╕╡р╣Ир╣Бр╕Ьр╕З Mix р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕бр╕нр╕Зр╣Ар╕лр╣Зр╕Щр╕Зр╣Ир╕▓р╕в
            mixPanel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        } else {
            mixPanel.style.display = 'none';
        }
    }
}
function togglePayType() {
    const payType = $("payTypeInp") ? $("payTypeInp").value : payMethod;
    const panel = $("mixPanel");
    
    if (!panel) return;

    if (payType === 'Mix') {
        panel.style.display = "block";
        // р╕Др╕│р╕Щр╕зр╕Ур╕вр╕нр╕Фр╕гр╕зр╕бр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ
        const total = (parseFloat($("priceInp").value) || 0) + (parseFloat($("tipInp").value) || 0);
        // р╣Гр╕кр╣Ир╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ: р╣Ар╕Зр╕┤р╕Щр╕кр╕Фр╕зр╣Ир╕▓р╕Зр╣Др╕зр╣Й р╣Бр╕ер╕░р╣Гр╕лр╣Йр╣Вр╕нр╕Щр╣Ар╕Ыр╣Зр╕Щр╕вр╕нр╕Фр╣Ар╕Хр╣Зр╕б
        if ($("mixCash")) $("mixCash").value = "";
        if ($("mixTrans")) $("mixTrans").value = total > 0 ? total : "";
    } else {
        panel.style.display = "none";
    }
}
// --- р╕кр╣Ир╕зр╕Щр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕Ур╣Ар╕Зр╕┤р╕Щр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ (Event Listeners) ---
// р╣Ар╕бр╕╖р╣Ир╕нр╕Бр╕гр╕нр╕Б "р╣Ар╕Зр╕┤р╕Щр╕кр╕Ф" р╣Гр╕лр╣Й "р╣Ар╕Зр╕┤р╕Щр╣Вр╕нр╕Щ" р╕ер╕Фр╕ер╕Зр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
if ($("mixCash")) {
    $("mixCash").addEventListener("input", function() {
        const price = parseFloat($("priceInp").value) || 0;
        const tip = parseFloat($("tipInp").value) || 0;
        const total = price + tip;
        
        const cash = parseFloat(this.value) || 0;
        const remain = total - cash;
        
        // р╕Ыр╕гр╕▒р╕Ър╕вр╕нр╕Фр╣Вр╕нр╕Щр╕Чр╕╡р╣Ир╣Ар╕лр╕ер╕╖р╕н (р╕лр╣Йр╕▓р╕бр╕Хр╕┤р╕Фр╕ер╕Ъ)
        if ($("mixTrans")) {
            $("mixTrans").value = remain >= 0 ? remain : 0;
        }
    });
}
// р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б: р╣Ар╕бр╕╖р╣Ир╕нр╕Бр╕гр╕нр╕Б "р╣Ар╕Зр╕┤р╕Щр╣Вр╕нр╕Щ" р╣Гр╕лр╣Й "р╣Ар╕Зр╕┤р╕Щр╕кр╕Ф" р╕ер╕Фр╕ер╕Зр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ (р╣Ар╕Ьр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Бр╕гр╕нр╕Бр╕кр╕ер╕▒р╕Ър╕Кр╣Ир╕нр╕З)
if ($("mixTrans")) {
    $("mixTrans").addEventListener("input", function() {
        const total = (parseFloat($("priceInp").value) || 0) + (parseFloat($("tipInp").value) || 0);
        const trans = parseFloat(this.value) || 0;
        const remain = total - trans;
        
        if ($("mixCash")) {
            $("mixCash").value = remain >= 0 ? remain : 0;
        }
    });
}
function updateMixValues() {
    // р╕Фр╕╢р╕Зр╕Др╣Ир╕▓р╕гр╕▓р╕Др╕▓р╣Бр╕ер╕░р╕Чр╕┤р╕Ыр╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕│р╕Щр╕зр╕Ур╕вр╕нр╕Фр╕гр╕зр╕бр╕ер╣Ир╕▓р╕кр╕╕р╕Ф
    const price = parseFloat($("priceInp")?.value) || 0;
    const tip = parseFloat($("tipInp")?.value) || 0;
    const total = price + tip;
    // р╕Фр╕╢р╕Зр╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕кр╕Фр╕Чр╕╡р╣Ир╕Бр╕гр╕нр╕Б
    const cash = parseFloat($("mixCash")?.value) || 0;
    // р╕Др╕│р╕Щр╕зр╕Ур╕вр╕нр╕Фр╣Вр╕нр╕Щр╕Чр╕╡р╣Ир╣Ар╕лр╕ер╕╖р╕н (р╕лр╣Йр╕▓р╕бр╕Хр╕┤р╕Фр╕ер╕Ъ)
    const trans = total - cash;
    
    if ($("mixTrans")) {
        $("mixTrans").value = trans > 0 ? trans.toFixed(2).replace(/\.00$/, '') : 0;
    }
}
/* ==========================================================
   SECTION 4: CALCULATION & CLOSING DAILY REPORT
   (р╕гр╕░р╕Ър╕Ър╕Др╕│р╕Щр╕зр╕Ур╕кр╣Ир╕зр╕Щр╣Бр╕Ър╣Ир╕Зр╣Бр╕ер╕░р╕Бр╕▓р╕гр╕Ыр╕┤р╕Фр╕вр╕нр╕Фр╕гр╕▓р╕вр╕зр╕▒р╕Щ)
   ========================================================== */
async function saveAndGo(date, total) {
    if (typeof db === 'undefined' || typeof archives === 'undefined') return;

    const btn = document.getElementById("btnSubmitSend");
    const icon = document.getElementById("btnIcon");

    // ЁЯОп 1. р╕Фр╕▒р╕Бр╕Ир╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Лр╣Йр╕│: р╕Цр╣Йр╕▓р╕кр╣Ир╕Зр╣Бр╕ер╣Йр╕зр╣Гр╕лр╣Йр╣Ар╕Хр╕╖р╕нр╕Щр╣Бр╕ер╕░р╕ер╣Зр╕нр╕Бр╕Ыр╕╕р╣Ир╕бр╣Ар╕Ыр╣Зр╕Щр╕кр╕╡р╣Ар╕Чр╕▓ р╣Др╕нр╕Др╕нр╕Щр╕Ир╕гр╕зр╕Ф
    const alreadySent = archives.some(a => a.date === date);
    if (alreadySent) {
        alert(`тЪая╕П р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Вр╕нр╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣И ${date} р╕кр╣Ир╕Зр╣Др╕Ыр╣Бр╕ер╣Йр╕з`);
        if (btn) {
            btn.disabled = true; 
            btn.style.background = "#94a3b8"; // ЁЯФШ р╕кр╕╡р╣Ар╕Чр╕▓
            if (icon) icon.className = "fas fa-paper-plane"; // р╣Др╕нр╕Др╕нр╕Щр╕Ир╕гр╕зр╕Фр╣Ар╕лр╕бр╕╖р╕нр╕Щр╣Ар╕Фр╕┤р╕б
            btn.style.cursor = "default";
        }
        return;
    }

    // ЁЯОп 2. р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╣Ир╕нр╕Щр╕кр╣Ир╕З
    if (!confirm(`р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕зр╕▒р╕Щр╕Чр╕╡р╣И ${date} р╣Гр╕Кр╣Ир╣Др╕лр╕б?`)) return;

    // ЁЯОп 3. р╣Ар╕гр╕┤р╣Ир╕бр╕кр╣Ир╕З: р╕ер╣Зр╕нр╕Бр╕Ыр╕╕р╣Ир╕бр╣Ар╕Ыр╣Зр╕Щр╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕з
    if (btn) {
        if (btn.disabled) return; 
        btn.disabled = true;             
        btn.style.background = "#22c55e"; // ЁЯЯв р╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕з (р╕Бр╕│р╕ер╕▒р╕Зр╕кр╣Ир╕З)
        if (icon) icon.className = "fas fa-spinner fa-spin"; 
    }

    // ... [Logic р╕Др╕│р╕Щр╕зр╕Ур╕Др╕Зр╣Ар╕Фр╕┤р╕бр╕Вр╕нр╕Зр╕Кр╣Ир╕▓р╕З] ...
    const allToday = db.filter(r => r.date === date);
    const todayData = allToday.filter(r => r.type === 'SERVICE');
    const isHoliday = allToday.some(r => r.type === 'HOLIDAY');
    let cash = 0, tips = 0;
    todayData.forEach(r => {
        const p = Number(r.price) || 0;
        const t = Number(r.tip) || 0;
        tips += t;
        if (r.pay === "Cash" || r.pay === "р╣Ар╕Зр╕┤р╕Щр╕кр╕Ф") { cash += (p + t); }
        else if (r.pay === "Mix") { cash += Number(r.payCash) || 0; }
    });
    const commission = total * (Number(conf.perc) / 100);
    const baseEarn = Math.max(commission, Number(conf.guar) || 0); 
    const bEarn = isHoliday ? 0 : baseEarn + tips;
    const settle = isHoliday ? 0 : cash - bEarn;
    const data = { date, total, cash, barber: Math.floor(bEarn), settle: settle, type: isHoliday ? "HOLIDAY" : "WORK", details: allToday };
    const idx = archives.findIndex(a => a.date === date);
    if (idx > -1) { archives[idx] = data; } else { archives.push(data); }
    if (!isHoliday) { account.balance = -settle; }
    db = db.filter(r => r.date !== date);

    try {
        if (typeof saveDB === "function") { await saveDB(); } else { await save(); }
        
        // ЁЯОп 4. р╕кр╣Ир╕Зр╕кр╕│р╣Ар╕гр╣Зр╕И: р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕Ыр╣Зр╕Щр╕кр╕╡р╣Ар╕Чр╕▓ р╣Бр╕Хр╣Ир╣Др╕нр╕Др╕нр╕Щр╕Ир╕гр╕зр╕Фр╣Ар╕лр╕бр╕╖р╕нр╕Щр╣Ар╕Фр╕┤р╕б
        if (btn) {
            btn.style.background = "#94a3b8"; // ЁЯФШ р╕кр╕╡р╣Ар╕Чр╕▓ (р╕кр╕│р╣Ар╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з)
            if (icon) icon.className = "fas fa-paper-plane"; // тЬИя╕П р╕Ир╕гр╕зр╕Фр╣Ар╕лр╕бр╕╖р╕нр╕Щр╣Ар╕Фр╕┤р╕б
            btn.disabled = true;             
            btn.style.cursor = "default";
        }

        if (typeof loadAccountStatus === 'function') loadAccountStatus();
        
        setTimeout(() => {
            alert(`тЬЕ р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И`);
        }, 500);

    } catch (e) {
        if (btn) {
            btn.disabled = false;
            btn.style.background = "#ff6f00"; // ЁЯЯа р╕Бр╕ер╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щр╕кр╕╡р╕кр╣Йр╕б
            if (icon) icon.className = "fas fa-paper-plane";
        }
        alert("тЭМ р╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф: " + e);
    }
}
// --- р╕гр╕░р╕Ър╕Ър╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕гр╕▓р╕вр╣Др╕Фр╣Й ---
function handleInsurance() {
    const d = $("dateInp")?.value || new Date().toISOString().split('T')[0];
    const g = parseInt(conf.guar) || 0;
    // 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕вр╕нр╕Фр╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З
    if (g <= 0) {
        if (typeof speak === "function") speak("р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕гр╕▓р╕вр╕зр╕▒р╕Щр╕Бр╣Ир╕нр╕Щ");
        alert("тЪая╕П р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕вр╕нр╕Фр╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╣Гр╕Щ 'р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕гр╕░р╕Ър╕Ъ' р╕Бр╣Ир╕нр╕Щр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ");
        return;
    }
    // 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╣Ар╕Др╕вр╣Ар╕Ыр╕┤р╕Фр╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╣Др╕Ыр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З
    const isClaimed = db.find(r => r.date === d && r.type === "GUARANTEE_CLAIM");
    if (isClaimed) {
        if (typeof speak === "function") speak("р╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╣Ар╕Ыр╕┤р╕Фр╕гр╕░р╕Ър╕Ър╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╣Др╕Ыр╣Бр╕ер╣Йр╕з");
        alert("ЁЯЫбя╕П р╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╣Ар╕Ыр╕┤р╕Фр╕гр╕░р╕Ър╕Ър╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╣Др╕Ыр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з");
        return;
    }
    // 3. р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╣Ар╕Ыр╕┤р╕Фр╕гр╕░р╕Ър╕Ър╕Ыр╕гр╕░р╕Бр╕▒р╕Щ
    if (confirm(`ЁЯЫбя╕П р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╣Ар╕Ыр╕┤р╕Фр╕гр╕░р╕Ър╕Ъ 'р╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕гр╕▓р╕вр╣Др╕Фр╣Й' (${g} р╕Ър╕▓р╕Ч)?\nр╕гр╕░р╕Ър╕Ър╕Ир╕░р╣Гр╕Кр╣Йр╕вр╕нр╕Фр╕Щр╕╡р╣Йр╣Ар╕Ыр╣Зр╕Щр╕гр╕▓р╕вр╣Др╕Фр╣Йр╕Вр╕▒р╣Йр╕Щр╕Хр╣Ир╕│р╕лр╕▓р╕Бр╕Др╣Ир╕▓р╕Др╕нр╕бр╕бр╕┤р╕Кр╕Кр╕▒р╣Ир╕Щр╣Др╕бр╣Ир╕Цр╕╢р╕З`)) {
        db.push({ 
            id: Date.now(), 
            date: d, 
            time: "00:00", 
            svcs: ["ЁЯЫбя╕П р╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕гр╕▓р╕вр╕зр╕▒р╕Щ"], 
            price: 0, 
            pay: "N/A", 
            type: "GUARANTEE_CLAIM" 
        });

        saveDB(); 
        if (typeof speak === "function") speak(`р╣Ар╕Ыр╕┤р╕Фр╕гр╕░р╕Ър╕Ър╕Ыр╕гр╕░р╕Бр╕▒р╕Щ ${g} р╕Ър╕▓р╕Ч р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в`);
        alert(`тЬЕ р╣Ар╕Ыр╕┤р╕Фр╕гр╕░р╕Ър╕Ър╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕гр╕▓р╕вр╕зр╕▒р╕Щ (${g}.-) р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в`);
        renderDay(d);
    }
}
// --- р╕гр╕░р╕Ър╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕зр╕▒р╕Щр╕лр╕вр╕╕р╕Ф ---
function handleHoliday() {
    const d = $("dateInp")?.value;
    if (!d) return alert("тЪая╕П р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Бр╣Ир╕нр╕Щр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕зр╕▒р╕Щр╕лр╕вр╕╕р╕Ф");
    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Лр╣Йр╕│р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
    const isHoliday = db.find(r => r.date === d && r.type === "HOLIDAY");
    if (isHoliday) return alert("ЁЯПЦя╕П р╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Ар╕Ыр╣Зр╕Щр╕зр╕▒р╕Щр╕лр╕вр╕╕р╕Фр╣Др╕Ыр╣Бр╕ер╣Йр╕з");

    if (confirm(`ЁЯПЦя╕П р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣И ${d} р╣Ар╕Ыр╣Зр╕Щ "р╕зр╕▒р╕Щр╕лр╕вр╕╕р╕Ф"?\n(р╕гр╕░р╕Ър╕Ър╕Ир╕░р╣Др╕бр╣Ир╕Др╕│р╕Щр╕зр╕Ур╕гр╕▓р╕вр╣Др╕Фр╣Йр╣Бр╕ер╕░р╕Др╣Ир╕▓р╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╣Гр╕Щр╕зр╕▒р╕Щр╕Щр╕╡р╣Й)`)) {
        db.push({
            id: Date.now(),
            date: d, 
            time: "00:00",
            svcs: ["ЁЯПЦя╕П р╕зр╕▒р╕Щр╕лр╕вр╕╕р╕Ф"],
            price: 0, 
            pay: "N/A",
            type: "HOLIDAY",
            off: true  
        });

        saveDB();
        if (typeof speak === "function") speak("р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕зр╕▒р╕Щр╕лр╕вр╕╕р╕Фр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в");
        alert("ЁЯПЦя╕П р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕зр╕▒р╕Щр╕лр╕вр╕╕р╕Фр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в");
        renderDay(d);
    }
}
function renderDay(selectedDate){
    let dInp = selectedDate || ($("dateInp") ? $("dateInp").value : new Date().toISOString().split('T')[0]);
    if ($("dateInp")) $("dateInp").value = dInp;
    let allRec = db.filter(r => r.date === dInp);
    
    if (allRec.length === 0 && typeof archives !== 'undefined') {
        const archivedDay = archives.find(a => a.date === dInp);
        if (archivedDay && archivedDay.details) {
            allRec = archivedDay.details;
        }
    }
    const isHoliday = allRec.some(r => r.type && r.type.toUpperCase() === 'HOLIDAY');
    const stats = {};
    const extraSvcs = ["р╣Вр╕Бр╕Щр╕лр╕Щр╕зр╕Ф", "р╕Бр╕▒р╕Щр╕лр╕Щр╣Йр╕▓", "р╕кр╕гр╕░р╕Ьр╕б"];
    let tot = 0, trans = 0, cash = 0, tips = 0;
    let listHtml = "";
    let realCustomerCount = 0;
    // --- р╕кр╣Ир╕зр╕Щр╕Бр╕▓р╕гр╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╕Вр╣Йр╕нр╕бр╕╣р╕е ---
    allRec
    .slice()
    .sort((a,b) => a.time.localeCompare(b.time))
    .forEach((r, i) => {
        const p = parseFloat(r.price) || 0; 
        const t = parseFloat(r.tip) || 0;
        const rType = r.type ? String(r.type).toUpperCase().trim() : '';
        const currentSvcs = Array.isArray(r.svcs) ? r.svcs : [];
 // тЬЕ 1. р╕Др╕│р╕Щр╕зр╕Ур╕вр╕нр╕Фр╕гр╕зр╕бр╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ (р╣Бр╕Бр╣Йр╣Др╕Вр╣Гр╕лр╕бр╣Ир╣Гр╕лр╣Йр╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Фр╕╢р╕Зр╕Др╣Ир╕▓р╕Ир╕▓р╕Б DB)
        tot += p;
        tips += t;
        if (r.pay === 'Mix') {
            // р╕Фр╕╢р╕Зр╕вр╕нр╕Фр╕Чр╕╡р╣Ир╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕бр╕▓р╣Гр╕Кр╣Йр╣Вр╕Фр╕вр╕Хр╕гр╕З
            const pCash = parseFloat(r.payCash) || 0;
            const pTrans = parseFloat(r.payTrans) || 0; 
            trans += pTrans;
            // cash р╣Гр╕Щр╕Чр╕╡р╣Ир╕Щр╕╡р╣Йр╕Др╕╖р╕нр╣Ар╕Зр╕┤р╕Щр╕кр╕Фр╕Чр╕╡р╣Ир╕гр╣Йр╕▓р╕Щр╕Хр╣Йр╕нр╕Зр╣Др╕Фр╣Йр╕гр╕▒р╕Ъ (р╕лр╕▒р╕Бр╕Чр╕┤р╕Ыр╕Чр╕╡р╣Ир╕Кр╣Ир╕▓р╕Зр╣Ар╕нр╕▓р╣Др╕Ыр╣Бр╕ер╣Йр╕з)
            // р╕Цр╣Йр╕▓ r.payCash р╕гр╕зр╕бр╕Чр╕┤р╕Ыр╕бр╕▓р╕Фр╣Йр╕зр╕в р╣Гр╕лр╣Йр╣Гр╕Кр╣Й pCash - t
            cash += (pCash - t); 
        } else if (r.pay === 'Trans' || r.pay === 'р╣Вр╕нр╕Щ') {
            // р╕Цр╣Йр╕▓р╕Ир╣Ир╕▓р╕вр╣Вр╕нр╕Щр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф: р╕вр╕нр╕Фр╕гр╕▓р╕Др╕▓ + р╕Чр╕┤р╕Ы р╕Ир╕░р╣Ар╕Вр╣Йр╕▓р╕кр╣Ир╕зр╕Щ trans
            trans += (p + t);
        } else {
            // р╕Цр╣Йр╕▓р╕Ир╣Ир╕▓р╕вр╣Ар╕Зр╕┤р╕Щр╕кр╕Фр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (Cash): р╕вр╕нр╕Фр╕гр╕▓р╕Др╕▓р╣Ар╕Вр╣Йр╕▓ cash р╕Вр╕нр╕Зр╕гр╣Йр╕▓р╕Щ (р╕Чр╕┤р╕Ыр╕нр╕вр╕╣р╣Ир╕Чр╕╡р╣Ир╕Кр╣Ир╕▓р╕Зр╣Бр╕ер╣Йр╕зр╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Ър╕зр╕Б)
            cash += p;
        }
      // ЁЯЪи 2. р╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕Вр╕Бр╕▓р╕гр╕Щр╕▒р╕Ър╕ер╕╣р╕Бр╕Др╣Йр╕▓ (р╣Бр╕Ър╕Ър╣Бр╕Бр╣Йр╣Др╕В)
    if (rType === 'HOLIDAY' || rType === 'GUARANTEE' || p === 0) {
        // р╕Вр╣Йр╕▓р╕бр╕Бр╕▓р╕гр╕Щр╕▒р╕Ъ (р╕зр╕▒р╕Щр╕лр╕вр╕╕р╕Ф/р╕Бр╕▓р╕гр╕▒р╕Щр╕Хр╕╡/р╕вр╕нр╕Фр╣Ар╕Ыр╣Зр╕Щ 0)
    } else {
    // ЁЯЯв р╣Бр╕Бр╣Йр╣Др╕В: р╕Щр╕▒р╕Ър╕ер╕╣р╕Бр╕Др╣Йр╕▓ 1 р╕Др╕Щр╣Ар╕кр╕бр╕нр╕Цр╣Йр╕▓р╕бр╕╡р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Ър╕гр╕┤р╕Бр╕▓р╕г (р╣Др╕бр╣Ир╕зр╣Ир╕▓р╕Ир╕░р╕Хр╕▒р╕Фр╕Ьр╕бр╕лр╕гр╕╖р╕нр╕Ър╕гр╕┤р╕Бр╕▓р╕гр╣Ар╕кр╕гр╕┤р╕б)
    if (currentSvcs.length > 0) {
        realCustomerCount++; 
    }
    // р╕кр╣Ир╕зр╕Щр╕Бр╕▓р╕гр╣Ар╕Бр╣Зр╕Ър╕кр╕Цр╕┤р╕Хр╕┤р╣Бр╕вр╕Бр╕Ыр╕гр╕░р╣Ар╕ар╕Ч (р╕Др╕Зр╣Др╕зр╣Йр╣Ар╕лр╕бр╕╖р╕нр╕Щр╣Ар╕Фр╕┤р╕бр╣Ар╕Юр╕╖р╣Ир╕нр╕Фр╕╣р╕зр╣Ир╕▓р╣Гр╕Др╕гр╕Хр╕▒р╕Фр╕Ьр╕бр╕Ър╣Йр╕▓р╕З)
    const cleanExtras = extraSvcs.map(s => s.trim().toLowerCase());
    const hasRealHaircut = currentSvcs.some(s => {
        if (!s) return false;
        const cleanS = s.trim().toLowerCase();
        return !cleanExtras.includes(cleanS);
    });
    if (hasRealHaircut) {
        stats["р╕Хр╕▒р╕Фр╕Ьр╕б"] = (stats["р╕Хр╕▒р╕Фр╕Ьр╕б"] || 0) + 1;
    }
    // р╕Щр╕▒р╕Ър╕Ир╕│р╕Щр╕зр╕Щр╕Др╕гр╕▒р╣Йр╕Зр╕Вр╕нр╕Зр╣Бр╕Хр╣Ир╕ер╕░р╕Ър╕гр╕┤р╕Бр╕▓р╕г
    currentSvcs.forEach(s => {
        if (s) stats[s] = (stats[s] || 0) + 1;
    });
}
        // тЬЕ 3. р╕кр╣Ир╕зр╕Щр╕кр╕гр╣Йр╕▓р╕З HTML (р╕Ыр╕гр╕▒р╕Ър╣Гр╕лр╣Йр╣Вр╕Кр╕зр╣Мр╣Др╕нр╕Др╕нр╕Щ Mix)
        const timeShow = r.endTime ? `${r.time}-${r.endTime}` : r.time;
        
        let payIcon = r.pay === 'Trans' ? 'ЁЯУ▒' : 'ЁЯТ╡';
        let mixText = "";
        if (r.pay === 'Mix') {
            payIcon = 'ЁЯМУ'; // р╣Др╕нр╕Др╕нр╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╣Ир╕▓р╕вр╕Ьр╕кр╕б
            mixText = `<br><small style="color:#64748b; font-size:10px; font-weight:normal;">(р╕кр╕Ф:${r.payCash}/р╣Вр╕нр╕Щ:${r.payTrans})</small>`;
        } 
        listHtml += `
        <div class="history-row" style="padding:15px; border-bottom:1px solid #f1f5f9; background:#fff;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div style="width:28px; height:28px; background:#f8fafc; border:1px solid #e2e8f0; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:800; color:#64748b; flex-shrink:0;">
                        ${i+1}
                    </div>
                    <div style="display:flex; flex-direction:column;">
                        <div style="font-weight:800; font-size:14px; color:#1e293b; margin-bottom:2px;">
                            <span style="color:#64748b; font-weight:500;">[${timeShow}]</span> ${currentSvcs.join(' + ')}
                        </div>
                        <div style="display:flex; gap:8px; align-items:center;">
                            ${t ? `<small style="color:#be185d; font-weight:700; font-size:11px;">ЁЯФ╣ р╕Чр╕┤р╕Ы: р╕┐${t}</small>` : '<small style="color:#94a3b8; font-size:11px;">(р╣Др╕бр╣Ир╕бр╕╡р╕Чр╕┤р╕Ы)</small>'}
                        </div>
                    </div>
                </div>
                <div style="text-align:right;">
                    <b style="font-size:16px; display:block; color:#1e293b; line-height:1.2;">
                        <span style="font-size:14px;">${payIcon}</span> р╕┐${p}${t ? ` <span style="color:#be185d;">(+${t})</span>` : ''}
                        ${mixText}
                    </b>
                    <span style="font-size:11px; font-weight:700; color:#ef4444; cursor:pointer;" onclick="delRec(${r.id})">р╕ер╕Ъ</span>
                </div>
            </div>
        </div>`;
    });

    const bEarn = isHoliday ? 0 : Math.max(tot * (conf.perc / 100), conf.guar) + tips;
    const sEarn = isHoliday ? 0 : tot - (bEarn - tips);
    const settle = isHoliday ? 0 : cash - bEarn;

    if ($("dTotal")) $("dTotal").innerText = tot.toLocaleString();
    if ($("dTrans")) $("dTrans").innerText = trans.toLocaleString();
    if ($("dCash")) $("dCash").innerText = cash.toLocaleString();
    if ($("dBarber")) $("dBarber").innerText = Math.floor(bEarn).toLocaleString();
    if ($("dShop")) $("dShop").innerText = Math.floor(sEarn).toLocaleString();

    if ($("dCounts")) {
        if (isHoliday) {
            $("dCounts").innerText = "ЁЯПЦя╕П р╕зр╕▒р╕Щр╕лр╕вр╕╕р╕Ф";
        } else if (realCustomerCount === 0 && allRec.length > 0) {
            $("dCounts").innerText = "ЁЯЫбя╕П р╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕гр╕▓р╕вр╣Др╕Фр╣Й";
        } else if (allRec.length === 0 && allRec.length > 0) {
            $("dCounts").innerText = "р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕е";
        } else {
            $("dCounts").innerText = `р╕ер╕╣р╕Бр╕Др╣Йр╕▓: ${realCustomerCount} р╕Др╕Щ`;
        }
    }

    let sH = `<div style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center; margin-bottom:10px;">`;
    const priority = ["р╕Хр╕▒р╕Фр╕Ьр╕б", "р╣Ар╕Фр╣Зр╕Б"];
    priority.forEach(k => { if (stats[k]) sH += `<span style="background:#4338ca;color:#fff;padding:5px 12px;border-radius:8px;font-size:11px;font-weight:800;">${k}: ${stats[k]}</span>`; });
    for (let s in stats) { if (!priority.includes(s)) sH += `<span style="background:#64748b;color:#fff;padding:5px 12px;border-radius:8px;font-size:11px;font-weight:800;">${s}: ${stats[s]}</span>`; }
    if ($("dServiceStats")) $("dServiceStats").innerHTML = sH + `</div>`;

    let txt = "", statusColor = "", icon = "";
    if (isHoliday) {
        txt = "р╕зр╕▒р╕Щр╕лр╕вр╕╕р╕Ф"; statusColor = "#1e40af"; icon = "ЁЯПЦя╕П";
    } else if (allRec.length === 0) {
        txt = "р╕гр╕нр╕Вр╣Йр╕нр╕бр╕╣р╕е..."; statusColor = "#64748b"; icon = "ЁЯУЭ";
    } else if (tot === 0) {
        txt = "р╕гр╣Йр╕▓р╕Щр╕Ир╣Ир╕▓р╕вр╕Ыр╕гр╕░р╕Бр╕▒р╕Щ"; statusColor = "#0369a1"; icon = "ЁЯЫбя╕П";
    } else if (settle > 0) {
        txt = `р╕Кр╣Ир╕▓р╕Зр╕Др╕╖р╕Щр╕гр╣Йр╕▓р╕Щ р╕┐${Math.floor(settle).toLocaleString()}`; statusColor = "#b91c1c"; icon = "ЁЯСитАНЁЯОи";
    } else if (settle < 0) {
        txt = `р╕гр╣Йр╕▓р╕Щр╕Др╕╖р╕Щр╕Кр╣Ир╕▓р╕З р╕┐${Math.floor(Math.abs(settle)).toLocaleString()}`; statusColor = "#4338ca"; icon = "ЁЯПа";
    } else {
        txt = "р╕вр╕нр╕Фр╕Юр╕нр╕Фр╕╡"; statusColor = "#15803d"; icon = "тЬЕ";
    }

    const actionBox = $("settleBarContainer");
    if (actionBox) {
        actionBox.style.display = "flex";
        actionBox.style.gap = "10px";
        actionBox.innerHTML = `
            <div id="settleBar" style="flex:8; height:55px; background:#f1f5f9; display:flex; align-items:center; justify-content:center; border-radius:18px; font-weight:800; font-size:14px; color:${statusColor}; border:1px solid #e2e8f0;">
                <span style="margin-right:8px; font-size:18px;">${icon}</span> ${txt}
            </div>
          <button id="btnSubmitSend" onclick="saveAndGo('${dInp}', ${tot})" 
        style="flex:2.2; height:55px; background:#ff6f00; color:#fff; border-radius:18px; border:none; font-size:22px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition: background 0.3s;">
    <i id="btnIcon" class="fas fa-paper-plane"></i>
</button>`;
    }
const dList = $("dailyList");
if (dList) {
    const dateParts = dInp.split('-'); 
    let displayDateBE = dInp;

    if (dateParts.length === 3) {
        const d = dateParts[2];
        const m = dateParts[1];
        const yBE = parseInt(dateParts[0]) + 543; // р╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щ р╕Ю.р╕и.
        displayDateBE = `${d}/${m}/${yBE}`;
    }
    dList.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; background: #ffffff; padding: 8px 12px; border-radius: 12px; border-bottom: 2px solid #f1f5f9; margin-bottom: 10px;">           
            <div style="display: flex; align-items: center; gap: 10px;">
                <b style="font-size: 16px; color: #1e293b;">ЁЯУЛ р╕гр╕▓р╕вр╕Зр╕▓р╕Щ</b>              
            <div style="position: relative; background: #f1f5f9; padding: 5px 12px; border-radius: 8px; border: 1px solid #e2e8f0; display: flex; align-items: center; cursor: pointer; width: 180px;"> 
                <span style="font-size: 14px; font-weight: 700; color: #6366f1; width: 100%; text-align: center;">${displayDateBE}</span>                
            <input type="date" id="reportDateSelector" value="${dInp}" 
                   onchange="renderDay(this.value)" 
                   style="position: absolute; opacity: 0; left: 0; top: 0; width: 100%; height: 100%; cursor: pointer;">
        </div>
    </div>
            <i class="fab fa-line" style="color: #22c55e; font-size: 32px; cursor: pointer;" onclick="shareLine()"></i>
        </div>
        <div style="padding: 0 5px;">
            ${isHoliday ? `<center style='padding:30px; color:#64748b;'>ЁЯПЦя╕П р╕зр╕▒р╕Щр╕лр╕вр╕╕р╕Ф (${displayDateBE})</center>` : (listHtml || "<center style='padding:30px; color:#94a3b8;'>р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕е</center>")}
        </div>
    `;
}
}             
/* ==========================================================
   SECTION 5: ACCOUNTING & FINANCIAL STATUS
   (р╕гр╕░р╕Ър╕Ър╕кр╕бр╕╕р╕Фр╕Ър╕▒р╕Нр╕Кр╕╡ р╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╣Ар╕Зр╕┤р╕Щ р╣Бр╕ер╕░р╣Др╕Яр╣Ар╕Хр╕╖р╕нр╕Щ)
   ========================================================== */
function loadAccountStatus() {
    const getEl = (id) => document.getElementById(id);
    
    // ЁЯОп р╣Бр╕Бр╣Йр╕Ир╕╕р╕Фр╕Щр╕╡р╣Й: р╕Фр╕╢р╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Ир╕▓р╕Б Input "accDate" р╕Хр╕гр╕Зр╣Ж р╣Ар╕Юр╕гр╕▓р╕░р╕бр╕▒р╕Щр╕Др╕╖р╕нр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Ър╕Чр╕╡р╣Ир╕Ър╕▒р╕Щр╕Чр╕╢р╕Б
    // р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡р╣Гр╕лр╣Йр╕Фр╕╢р╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╣Гр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ ISO (YYYY-MM-DD) р╕Лр╕╢р╣Ир╕Зр╕бр╕▒р╕Бр╕Ир╕░р╕Хр╕гр╕Зр╕Бр╕▒р╕Ър╕Чр╕╡р╣Ир╕гр╕░р╕Ър╕Ър╣Гр╕Кр╣Йр╣Ар╕Бр╣Зр╕Ъ
    let todayKey = getEl("accDate")?.value;
    
    if (!todayKey) {
        const now = new Date();
        const y = now.getFullYear();
        const m = String(now.getMonth() + 1).padStart(2, '0');
        const d = String(now.getDate()).padStart(2, '0');
        todayKey = `${y}-${m}-${d}`; // р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ 2026-02-14
    }

    if (typeof archives === "undefined") return;

    // ЁЯОп 1. р╕Фр╕╢р╕Зр╕вр╕нр╕Ф "р╕Др╣Йр╕▓р╕Зр╕зр╕▒р╕Щр╕Щр╕╡р╣Й"
    const todayData = archives.find(a => a.date === todayKey);
    let todaySettle = todayData ? -todayData.settle : 0;

    // ЁЯОп 2. р╕Фр╕╢р╕Зр╕вр╕нр╕Ф "р╕Др╣Йр╕▓р╕Зр╣Ар╕Фр╕┤р╕б" (р╣Ар╕нр╕▓р╣Ар╕Йр╕Юр╕▓р╕░р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕вр╕▒р╕Зр╕Др╣Йр╕▓р╕Зр╕нр╕вр╕╣р╣Ир╣Бр╕ер╕░р╣Др╕бр╣Ир╣Гр╕Кр╣Ир╕зр╕▒р╕Щр╕Щр╕╡р╣Й)
    let oldSettle = archives.reduce((sum, day) => {
        // р╕Хр╣Йр╕нр╕Зр╣Др╕бр╣Ир╣Гр╕Кр╣Ир╕зр╕▒р╕Щр╕Щр╕╡р╣Й 
        // р╣Бр╕ер╕░р╕Хр╣Йр╕нр╕Зр╣Ар╕Ыр╣Зр╕Щр╕вр╕нр╕Фр╕Чр╕╡р╣И "р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╣Ар╕Др╕ер╕╡р╕вр╕гр╣М" (р╕Цр╣Йр╕▓р╕Кр╣Ир╕▓р╕Зр╕бр╕╡р╕гр╕░р╕Ър╕Ър╣Ар╕Др╕ер╕╡р╕вр╕гр╣Мр╣Бр╕ер╣Йр╕зр╕вр╕нр╕Фр╕Ир╕░р╕Бр╕ер╕▓р╕вр╣Ар╕Ыр╣Зр╕Щ 0)
        if (day.date !== todayKey && day.settle !== 0) {
            return sum + (Number(-day.settle) || 0);
        }
        return sum;
    }, 0);

    // ЁЯОп 3. р╕лр╕▒р╕Бр╕ер╕Ър╕Бр╕▒р╕Щр╣Ар╕Ыр╣Зр╕Щ "р╕вр╕нр╕Фр╕Хр╣Йр╕нр╕Зр╣Ар╕Др╕ер╕╡р╕вр╕гр╣М"
    let totalBalance = oldSettle + todaySettle;
    if (typeof account !== "undefined") {
        account.balance = totalBalance;
    }

    // ЁЯУК р╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Хр╕▒р╕зр╣Ар╕ер╕В
    if (getEl("accTodayVal")) getEl("accTodayVal").innerText = `р╕┐${todaySettle.toLocaleString()}`;
    if (getEl("accOldVal"))   getEl("accOldVal").innerText = `р╕┐${oldSettle.toLocaleString()}`;
    
    if (getEl("accTotalVal")) {
        getEl("accTotalVal").innerText = `р╕┐${Math.abs(totalBalance).toLocaleString()}`;
    }

    // р╕кр╣Ир╕зр╕Щр╕Вр╕нр╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Бр╕кр╕Фр╕Зр╕Ър╕Щр╕лр╕▒р╕з (р╣Вр╕Кр╕зр╣Мр╣Гр╕лр╣Йр╕кр╕зр╕вр╕Зр╕▓р╕б)
    if (getEl("accDateLabel")) {
        getEl("accDateLabel").innerText = new Date(todayKey).toLocaleDateString('th-TH', { 
            day: 'numeric', month: 'short', year: 'numeric' 
        });
    }

    // р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕кр╕Цр╕▓р╕Щр╕░р╕Ыр╣Йр╕▓р╕в
    const badge = getEl("statusBadge");
    if (badge) {
        if (totalBalance < 0) {
            badge.innerText = "ЁЯСитАНЁЯОи р╕Кр╣Ир╕▓р╕Зр╕Др╕╖р╕Щр╕гр╣Йр╕▓р╕Щ";
            badge.style.backgroundColor = "#fee2e2"; badge.style.color = "#991b1b";
        } else if (totalBalance > 0) {
            badge.innerText = "ЁЯПа р╕гр╣Йр╕▓р╕Щр╕Др╕╖р╕Щр╕Кр╣Ир╕▓р╕З";
            badge.style.backgroundColor = "#dcfce7"; badge.style.color = "#166534";
        } else {
            badge.innerText = "тЬЕ р╕вр╕нр╕Фр╕ер╕Зр╕Хр╕▒р╕з";
            badge.style.backgroundColor = "#f1f5f9"; badge.style.color = "#64748b";
        }
    }

    if (typeof updateStatusUI === 'function') updateStatusUI(totalBalance);
}
function updateStatusUI(net) {
    const getEl = (id) => document.getElementById(id);
    const badge = getEl("statusBadge");
    const light = getEl("accLight"); 

    // тЬЕ р╕Ыр╕гр╕▒р╕Ър╕Хр╕гр╕гр╕Бр╕░р╕кр╕╡: р╕ер╕Ъ=р╣Бр╕Фр╕З (р╕Кр╣Ир╕▓р╕Зр╕Др╕╖р╕Щр╕гр╣Йр╕▓р╕Щ) | р╕Ър╕зр╕Б=р╕Щр╣Йр╕│р╣Ар╕Зр╕┤р╕Щ (р╕гр╣Йр╕▓р╕Щр╕Др╕╖р╕Щр╕Кр╣Ир╕▓р╕З)
    let color = net < 0 ? "#dc2626" : (net > 0 ? "#1e3a8a" : "#16a34a");
    let txt = net < 0 ? "ЁЯСитАНЁЯОи р╕Кр╣Ир╕▓р╕Зр╕Др╕╖р╕Щр╕гр╣Йр╕▓р╕Щ" : (net > 0 ? "ЁЯПа р╕гр╣Йр╕▓р╕Щр╕Др╕╖р╕Щр╕Кр╣Ир╕▓р╕З" : "тЬЕ р╕вр╕нр╕Фр╕ер╕Зр╕Хр╕▒р╕з");

    if (badge) {
        badge.innerText = txt;
        badge.style.background = net < 0 ? "#fef2f2" : (net > 0 ? "#eff6ff" : "#f0fdf4");
        badge.style.color = color;
    }
    if (light) {
        light.style.background = color;
        light.style.boxShadow = `0 0 12px ${color}`;
    }
}
function clearAccount() {
    const net = Number(account.balance) || 0;
    if (net === 0) return alert("ЁЯТО р╕вр╕нр╕Фр╣Ар╕Ыр╣Зр╕Щр╕ир╕╣р╕Щр╕вр╣Мр╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з");

    const accNoteEl = document.getElementById("accNote");
    const d = document.getElementById("accDate")?.value || new Date().toLocaleDateString('th-TH');

    // 1. р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕ер╕Зр╣Бр╕Яр╣Йр╕б (logs) р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Бр╣Зр╕Ър╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤
    account.logs.push({
        date: d,
        amount: -net, 
        note: (accNoteEl && accNoteEl.value) || "р╣Ар╕Др╕ер╕╡р╕вр╕гр╣Мр╕вр╕нр╕Фр╕Др╣Йр╕▓р╕З"
    });

    // ЁЯОп 2. р╕Щр╕╡р╣Ир╕Др╕╖р╕нр╕Ър╕гр╕гр╕Чр╕▒р╕Фр╕Чр╕╡р╣Ир╕Ьр╕бр╕кр╕░р╣Ар╕Юр╕гр╣Ир╕▓р╣Др╕бр╣Ир╣Др╕Фр╣Йр╣Ар╕Хр╕┤р╕бр╣Гр╕лр╣Й: "р╕ер╣Йр╕▓р╕Зр╕вр╕нр╕Фр╣Гр╕Щ Archives р╕Чр╕╕р╕Бр╕зр╕▒р╕Щр╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щ 0"
    // р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕бр╕▒р╕Щр╣Др╕бр╣Ир╕зр╕Щр╕ер╕╣р╕Ыр╕Бр╕ер╕▒р╕Ър╕бр╕▓р╕Ър╕зр╕Бр╕Чр╕Ър╣Гр╕Щр╕лр╕Щр╣Йр╕▓р╕Ър╕▒р╕Нр╕Кр╕╡р╕нр╕╡р╕Б
    if (typeof archives !== "undefined") {
        archives.forEach(day => {
            day.settle = 0; 
        });
        // р╣Ар╕Лр╕Яр╕ер╕Зр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕Чр╕▒р╕Щр╕Чр╕╡р╕Бр╕▒р╕Щр╕Юр╕ер╕▓р╕Ф
        localStorage.setItem("barber_archives", JSON.stringify(archives));
    }

    // 3. р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕лр╕Щр╣Йр╕▓р╕Ир╕н
    if (typeof save === "function") save();
    if (typeof loadAccountHistory === 'function') loadAccountHistory();
    
    loadAccountStatus(); // р╕Юр╕нр╕вр╕нр╕Фр╣Гр╕Щ archives р╣Ар╕Ыр╣Зр╕Щ 0 р╣Бр╕ер╣Йр╕з р╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕Ир╕░р╕Бр╕ер╕▓р╕вр╣Ар╕Ыр╣Зр╕Щ 0 р╕Чр╕▒р╕Щр╕Чр╕╡
    alert("тЬЕ р╣Ар╕Др╕ер╕╡р╕вр╕гр╣Мр╕Ър╕▒р╕Нр╕Кр╕╡р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в!");
}
// 1. р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕ер╕Ър╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Ър╕▒р╕Нр╕Кр╕╡
function deleteAccountLog(index) {
    if (confirm("тЪая╕П р╕Др╕╕р╕Ур╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Щр╕╡р╣Йр╣Гр╕Кр╣Ир╕лр╕гр╕╖р╕нр╣Др╕бр╣И?\nр╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕кр╕╕р╕Чр╕Шр╕┤р╕Ир╕░р╕Цр╕╣р╕Бр╕Др╕│р╕Щр╕зр╕Ур╣Гр╕лр╕бр╣Ир╕Хр╕▓р╕бр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕╡р╣Ир╣Ар╕лр╕ер╕╖р╕нр╕нр╕вр╕╣р╣И")) {
        // р╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕▓р╕Б Array
        account.logs.splice(index, 1);
        // р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕ер╕З LocalStorage (р╣Гр╕Кр╣Й saveDB р╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕зр╕▓р╕бр╕Др╕гр╕нр╕Ър╕Др╕ер╕╕р╕б)
        if (typeof saveDB === "function") saveDB(); else if (typeof save === "function") save();
        
        alert("тЬЕ р╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з");
        
        // р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕е (р╣Гр╕Кр╣Йр╕Кр╕╖р╣Ир╕нр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Гр╕лр╣Йр╕Хр╕гр╕Зр╕Бр╕▒р╕Ър╕Чр╕╡р╣Ир╕Др╕╕р╕Ур╕бр╕╡)
        if (typeof loadAccountHistory === "function") loadAccountHistory();
        else if (typeof renderHistoryList === "function") renderHistoryList();
        
        // р╕Др╕│р╕Щр╕зр╕Ур╕вр╕нр╕Фр╕кр╕гр╕╕р╕Ыр╕Чр╕╡р╣Ир╕лр╕Щр╣Йр╕▓р╕лр╕ер╕▒р╕Бр╣Гр╕лр╕бр╣И
        if (typeof loadAccountStatus === "function") loadAccountStatus();
    }
}
// 2. р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Ър╕▒р╕Нр╕Кр╕╡
function editAccountLog(index) {
    let log = account.logs[index];
    if (!log) return;

    const newNote = prompt("ЁЯУЭ р╣Бр╕Бр╣Йр╣Др╕Вр╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕:", log.note);
    // р╣Бр╕кр╕Фр╕Зр╕Др╣Ир╕▓р╣Бр╕Ър╕Ъ absolute (р╣Др╕бр╣Ир╕бр╕╡р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕лр╕бр╕▓р╕вр╕ер╕Ъ) р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Бр╕Бр╣Йр╣Др╕Вр╕Зр╣Ир╕▓р╕в
    const newAmount = prompt("ЁЯТ░ р╣Бр╕Бр╣Йр╣Др╕Вр╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ:", Math.abs(log.amount));
    
    if (newNote !== null && newAmount !== null) {
        // р╕гр╕▒р╕Бр╕йр╕▓р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕лр╕бр╕▓р╕вр╣Ар╕Фр╕┤р╕бр╣Др╕зр╣Й (р╕Ър╕зр╕Бр╕Др╕╖р╕нр╕гр╕▒р╕Ъ/р╕Др╕╖р╕Щр╕гр╣Йр╕▓р╕Щ, р╕ер╕Ър╕Др╕╖р╕нр╕Ир╣Ир╕▓р╕вр╕нр╕нр╕Б/р╕гр╣Йр╕▓р╕Щр╕Др╕╖р╕Щр╕Кр╣Ир╕▓р╕З)
        const isNegative = log.amount < 0;
        const val = parseFloat(newAmount.replace(/,/g, '')) || 0;
        
        account.logs[index].note = newNote;
        account.logs[index].amount = isNegative ? -val : val;
        
        if (typeof saveDB === "function") saveDB(); else if (typeof save === "function") save();
        
        alert("тЬЕ р╣Бр╕Бр╣Йр╣Др╕Вр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з");
        
        if (typeof loadAccountHistory === "function") loadAccountHistory();
        else if (typeof renderHistoryList === "function") renderHistoryList();
        
        if (typeof loadAccountStatus === "function") loadAccountStatus();
    }
}
function loadAccountHistory() {
    const historyContainer = $("accHistory");
    if (!historyContainer) return;

    if (!account.logs || account.logs.length === 0) {
        historyContainer.innerHTML = '<center style="padding:40px; color:#94a3b8;">р╣Др╕бр╣Ир╕бр╕╡р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ър╕▒р╕Нр╕Кр╕╡</center>';
        return;
    }

    const historyHtml = account.logs.slice().reverse().map((l, originalIndex) => {
        const realIdx = account.logs.length - 1 - originalIndex;
        
        // ЁЯОп р╣Бр╕Бр╣Йр╕Ир╕╕р╕Фр╕Щр╕╡р╣Йр╣Гр╕лр╣Йр╕Хр╕гр╕Зр╕Бр╕▒р╕Ъ -settle:
        // р╕ер╕Ъ (-) = р╕Кр╣Ир╕▓р╕Зр╕Др╕╖р╕Щр╕гр╣Йр╕▓р╕Щ (р╕кр╕╡р╣Бр╕Фр╕З)
        // р╕Ър╕зр╕Б (+) = р╕гр╣Йр╕▓р╕Щр╕Др╕╖р╕Щр╕Кр╣Ир╕▓р╕З (р╕кр╕╡р╕Щр╣Йр╕│р╣Ар╕Зр╕┤р╕Щ)
        const isBarberDebt = l.amount < 0; 
        const color = isBarberDebt ? '#dc2626' : '#1e3a8a';
        const sign = l.amount > 0 ? '+' : (l.amount < 0 ? '-' : '');

        return `
        <div class="log-item" style="padding:15px; border-bottom:1px solid #f1f5f9; display:flex; justify-content:space-between; align-items:center; background:#fff;">
            <div style="flex:1;">
                <b style="font-size:13px; color:#64748b;">${l.date}</b><br>
                <span style="font-size:14px; font-weight:700; color:#1e293b;">${l.note}</span>
            </div>
            <div style="text-align:right; flex-shrink:0;">
                <b style="font-size:15px; color:${color}; display:block; margin-bottom:5px;">
                    ${sign}р╕┐${Math.abs(l.amount).toLocaleString()}
                </b>
                <div style="display:flex; gap:10px; justify-content:flex-end;">
                    <small style="color:#6366f1; font-weight:700; cursor:pointer;" onclick="editAccountLog(${realIdx})">р╣Бр╕Бр╣Йр╣Др╕В</small>
                    <small style="color:#ef4444; font-weight:700; cursor:pointer;" onclick="deleteAccountLog(${realIdx})">р╕ер╕Ъ</small>
                </div>
            </div>
        </div>`;
    }).join('');

    historyContainer.innerHTML = historyHtml;
}
// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Ар╕Ыр╕┤р╕Ф-р╕Ыр╕┤р╕Фр╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤
function toggleAccHistory() {
    const wrapper = $("accHistoryWrapper");
    if (!wrapper) return;

    if (wrapper.style.display === "none" || wrapper.style.display === "") {
        wrapper.style.display = "block";
        loadAccountHistory(); // р╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╕бр╣Ир╕Чр╕╕р╕Бр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╣Ар╕Ыр╕┤р╕Ф
        
        // р╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕ер╕Зр╕бр╕▓р╕Чр╕╡р╣Ир╕кр╣Ир╕зр╕Щр╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╣Ар╕лр╣Зр╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╕Щр╕Чр╕╡
        wrapper.scrollIntoView({ behavior: 'smooth', block: 'start' });
    } else {
        wrapper.style.display = "none";
    }
}
/* ==========================================================
   SECTION 6: MODALS & USER INTERFACE RENDER
   (р╕кр╣Ир╕зр╕Щр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕лр╕Щр╣Йр╕▓р╕Хр╣Ир╕▓р╕З Pop-up р╣Бр╕ер╕░р╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤)
   ========================================================== */
function openHistoryModal() { 
    const modal = $("historyModal");
    if (!modal) return alert("тЪая╕П р╣Др╕бр╣Ир╕Юр╕Ър╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕З historyModal р╣Гр╕Щр╕гр╕░р╕Ър╕Ъ");
    // р╣Бр╕кр╕Фр╕З Modal р╕Фр╣Йр╕зр╕вр╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕зр╕▓р╕Зр╣Бр╕Ър╕Ъ Flex
    modal.style.display = "flex"; 
    // р╣Ар╕гр╕╡р╕вр╕Бр╣Гр╕Кр╣Йр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕г (р╕Юр╕гр╣Йр╕нр╕бр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Юр╕гр╣Йр╕нр╕бр╕Вр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е)
    if (typeof renderHistoryList === "function") {
        renderHistoryList(); 
    } else { 
        console.warn("тЪая╕П р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ renderHistoryList р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З р╕лр╕гр╕╖р╕нр╕Цр╕╣р╕Бр╣Ар╕Вр╕╡р╕вр╕Щр╣Др╕зр╣Йр╕Фр╣Йр╕▓р╕Щр╕ер╣Ир╕▓р╕З");
    }
}
function closeHistoryModal() { 
    const modal = $("historyModal");
    if (modal) modal.style.display = "none"; 
}
function closeReportModal() {
    const modal = $("reportModal"); 
    
    if (modal) {
        modal.style.display = "none";
        document.body.style.overflow = "auto";
    }

    // р╕лр╕Щр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓р╣Ар╕ер╣Зр╕Бр╕Щр╣Йр╕нр╕вр╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Й UI р╕Др╕╖р╕Щр╕Др╣Ир╕▓р╣Др╕Фр╣Йр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М
    setTimeout(() => {
        if (typeof go === 'function') {
            console.log("р╕Бр╕│р╕ер╕▒р╕Зр╕Бр╕ер╕▒р╕Ър╣Др╕Ыр╕лр╕Щр╣Йр╕▓р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б...");
            go(2); 
        }
    }, 100); 
} // р╕Ыр╕┤р╕Фр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Бр╕Др╣Ир╕Хр╕гр╕Зр╕Щр╕╡р╣Йр╕Юр╕нр╕Др╕гр╕▒р╕Ър╕Кр╣Ир╕▓р╕З (р╕Ыр╕╡р╕Бр╕Бр╕▓р╕нр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕Бр╕┤р╕Щр╕нр╕нр╕Бр╣Др╕Ыр╣Бр╕ер╣Йр╕з)
function closeAndGoHome() {
    const m = $("modalSet");
    if (m) m.style.display = 'none';

    if (typeof go === 'function') {
        go(1); 
    } else {
        location.reload();
    }
}              
function renderHistoryList() {
    // 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕лр╕гр╕╖р╕нр╣Др╕бр╣И
    if (!account.logs || account.logs.length === 0) {
        $("accHistory").innerHTML = `
            <div style="padding:50px; text-align:center; color:#94a3b8;">
                <span style="font-size:40px;">ЁЯУВ</span><br>
                <p style="font-size:15px; margin-top:10px;">р╣Др╕бр╣Ир╕бр╕╡р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╣Ар╕Др╕ер╕╡р╕вр╕гр╣Мр╕вр╕нр╕Ф</p>
            </div>`;
        return;
    }

    // 2. р╕Ир╕▒р╕Фр╕Бр╕ер╕╕р╣Ир╕бр╕Вр╣Йр╕нр╕бр╕╣р╕е (Grouping by Month/Year)
    const groups = {};
    account.logs.forEach((log, index) => {
        // р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Чр╕▒р╣Йр╕З 2026-02-13 р╣Бр╕ер╕░ 13/02/2026
        const dateParts = log.date.includes('-') ? log.date.split('-') : log.date.split('/');
        
        // р╕Хр╕гр╕гр╕Бр╕░р╕Бр╕▓р╕гр╣Бр╕Ыр╕ер╕Зр╕Ыр╕╡: р╕Цр╣Йр╕▓р╣Ар╕Ыр╣Зр╕Щ р╕Д.р╕и. (4 р╕лр╕ер╕▒р╕Б) р╣Гр╕лр╣Й +543 р╣Ар╕Ыр╣Зр╕Щ р╕Ю.р╕и.
        let m = dateParts[1];
        let y = dateParts[0].length === 4 ? parseInt(dateParts[0]) + 543 : dateParts[2];
        const monthYear = `${m}/${y}`;

        if (!groups[monthYear]) groups[monthYear] = [];
        groups[monthYear].push({ ...log, originalIndex: index });
    });

    // 3. р╣Ар╕гр╕╡р╕вр╕Зр╕ер╕│р╕Фр╕▒р╕Ър╣Ар╕Фр╕╖р╕нр╕Щ (Sorting)
    const sortedMonths = Object.keys(groups).sort((a, b) => {
        return b.split('/').reverse().join().localeCompare(a.split('/').reverse().join());
    });

    // 4. р╕кр╕гр╣Йр╕▓р╕З HTML р╕Фр╣Йр╕зр╕в Tag <details> р╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕зр╕▓р╕бр╕кр╕зр╕вр╕Зр╕▓р╕б
    let finalHtml = "";
    sortedMonths.forEach(my => {
        const monthLogs = groups[my];
        const monthSum = monthLogs.reduce((s, l) => s + (parseFloat(l.amount) || 0), 0);

        finalHtml += `
            <details style="margin-bottom:12px; border:1px solid #e2e8f0; border-radius:18px; overflow:hidden; background:#fff; box-shadow:0 2px 4px rgba(0,0,0,0.02);" open>
                <summary style="padding:15px; background:#f8fafc; cursor:pointer; display:flex; justify-content:space-between; align-items:center; list-style:none; border-bottom:1px solid #f1f5f9;">
                    <div style="display:flex; align-items:center; gap:8px;">
                        <span style="font-size:18px;">ЁЯУВ</span>
                        <b style="font-size:15px; color:#1e293b;">р╣Бр╕Яр╣Йр╕бр╣Ар╕Фр╕╖р╕нр╕Щ ${my}</b>
                    </div>
                    <b style="color:${monthSum >= 0 ? '#16a34a' : '#dc2626'}; font-size:15px;">
                        р╕┐${Math.abs(monthSum).toLocaleString()}
                    </b>
                </summary>
                <div style="padding:5px;">
                    ${monthLogs.slice().reverse().map(l => `
                        <div style="padding:12px 10px; border-bottom:1px solid #f8fafc; display:flex; justify-content:space-between; align-items:center;">
                            <div style="flex:1;">
                                <div style="font-size:11px; color:#94a3b8; margin-bottom:2px;">ЁЯУЕ ${l.date}</div>
                                <div style="font-weight:600; color:#334155; font-size:14px;">${l.note || 'р╣Ар╕Др╕ер╕╡р╕вр╕гр╣Мр╕вр╕нр╕Фр╕Др╣Йр╕▓р╕З'}</div>
                            </div>
                            <div style="text-align:right;">
                                <div style="color:${l.amount >= 0 ? '#16a34a' : '#dc2626'}; font-weight:800; font-size:16px; margin-bottom:5px;">
                                    ${l.amount >= 0 ? '+' : '-'}р╕┐${Math.abs(l.amount).toLocaleString()}
                                </div>
                                <div style="display:flex; gap:5px; justify-content:flex-end;">
                                    <button onclick="editAccountLog(${l.originalIndex})" style="background:#fffbeb; color:#92400e; border:none; border-radius:8px; padding:6px 10px; font-size:12px; font-weight:700; cursor:pointer;">р╣Бр╕Бр╣Йр╣Др╕В</button>
                                    <button onclick="deleteAccountLog(${l.originalIndex})" style="background:#fff1f2; color:#be123c; border:none; border-radius:8px; padding:6px 10px; font-size:12px; font-weight:700; cursor:pointer;">р╕ер╕Ъ</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </details>
        `;
    });

    $("accHistory").innerHTML = finalHtml;
}
/* ==========================================================
   SECTION 7: ANALYTICS, REPORTS & SHARING
   (р╕кр╣Ир╕зр╕Щр╕кр╕Цр╕┤р╕Хр╕┤ р╕гр╕▓р╕вр╕Зр╕▓р╕Щ р╣Бр╕ер╕░р╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Вр╣Йр╕▓ LINE)
   ========================================================== */
 function loadHistDaily() {
    const d = $("histDate").value;
    if (!d) return;
    const f = archives.find(a => a.date === d);
    if (!f) return alert("р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Вр╕нр╕Зр╕зр╕▒р╕Щр╕Щр╕╡р╣Й");
    let cashTotal = f.cash || 0;
    let transTotal = f.trans || 0;
    let totalRevenue = cashTotal + transTotal;
    let customerCount = f.count || (f.details ? f.details.length : 0);
    const barberEarn = Math.floor(f.barber || 0);
    const shopEarn = Math.floor(f.shop || 0);
    const svcCounts = {};
    (f.details || []).forEach(r => {
        const services = Array.isArray(r.svcs) ? r.svcs : [r.svcs];
        services.forEach(s => {
            if(s) svcCounts[s] = (svcCounts[s] || 0) + 1;
        });
    });

    const svcHTML = Object.entries(svcCounts).map(([name, count]) => `
        <div style="background:rgba(203, 213, 225, 0.1); padding:6px 12px; border-radius:10px; font-size:12px; color:#cbd5e1; font-weight:600; display:inline-block; margin:3px; border:1px solid rgba(255, 255, 255, 0.1);">
            ${name} <span style="opacity:0.7; margin-left:4px;">x${count}</span>
        </div>
    `).join("");

    let settleHTML = "";
    if (cashTotal > barberEarn) {
        const toShop = cashTotal - barberEarn;
        settleHTML = `<div style="background:rgba(251,146,60,0.1); padding:16px; border-radius:16px; margin-bottom:20px; text-align:center; border:1px solid rgba(251,146,60,0.3);">
            <div style="font-size:16px; color:#fdba74; font-weight:600; margin-bottom:4px;">ЁЯСитАНЁЯОи р╕Кр╣Ир╕▓р╕Зр╕Др╕╖р╕Щр╕гр╣Йр╕▓р╕Щ</div>
            <div style="font-size:24px; color:#fb923c; font-weight:800;">р╕┐${toShop.toLocaleString()}</div>
        </div>`;
    } else if (barberEarn > cashTotal) {
        const toBarber = barberEarn - cashTotal;
        settleHTML = `<div style="background:rgba(56,189,248,0.1); padding:16px; border-radius:16px; margin-bottom:20px; text-align:center; border:1px solid rgba(56,189,248,0.3);">
            <div style="font-size:16px; color:#7dd3fc; font-weight:600; margin-bottom:4px;">ЁЯПа р╕гр╣Йр╕▓р╕Щр╕Др╕╖р╕Щр╕Кр╣Ир╕▓р╕З</div>
            <div style="font-size:24px; color:#38bdf8; font-weight:800;">р╕┐${toBarber.toLocaleString()}</div>
        </div>`;
    }
    const rows = (f.details || [])
        .slice()
        .sort((a, b) => (a.time || "").localeCompare(b.time || ""))
        .map((r, index) => {
            const p = Number(r.price) || 0;
            const t = Number(r.tip) || 0;
            const fullTime = (r.time && r.endTime) ? `${r.time}-${r.endTime}` : (r.time || "--:--");
            let payText = "";
            if (r.pay === 'Mix') {
                payText = `ЁЯМУ р╕Ьр╕кр╕б (р╕кр╕Ф:${(r.payCash||0)}/р╣Вр╕нр╕Щ:${(r.payTrans||0)})`;
            } else {
                payText = r.pay === 'Trans' ? 'ЁЯУ▒ р╣Вр╕нр╕Щ' : 'ЁЯТ╡ р╣Ар╕Зр╕┤р╕Щр╕кр╕Ф';
            }
            return `
            <div style="padding:14px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08); border-radius:16px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div style="width:28px; height:28px; background:rgba(255,255,255,0.08); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:14px; font-weight:700; color:#94a3b8;">${index + 1}</div>
                    <div>
                        <div style="font-weight:700; font-size:14px; color:#f8fafc;">${Array.isArray(r.svcs) ? r.svcs.join(' + ') : r.svcs}</div>
                        <div style="font-size:13px; color:#94a3b8; font-weight:500; margin-top:2px;">тП▒ ${fullTime} тАв ${payText}</div>
                    </div>
                </div>
                <div style="text-align:right;">
                    <div style="font-size:16px; font-weight:800; color:#f8fafc;">р╕┐${p.toLocaleString()}</div>
                    ${t > 0 ? `<div style="font-size:12px; font-weight:600; color:#f472b6;">+ Tip р╕┐${t.toLocaleString()}</div>` : ''}
                </div>
            </div>`;
        }).join("");

    openReportModal(`р╕гр╕▓р╕вр╕Зр╕▓р╕Щ ${d}`, `
        <div style="font-family:'Inter', system-ui, sans-serif; background:#0f172a; margin:-16px; padding:24px; color:#f1f5f9; min-height:100vh;">
            <div style="text-align:center; padding:20px 0 30px 0;">
                <div style="font-size:16px; color:#94a3b8; font-weight:600; text-transform:uppercase; letter-spacing:1px;">р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕гр╕зр╕б</div>
                <div style="font-size:48px; font-weight:900; color:#ffffff; margin-top:5px;">р╕┐${totalRevenue.toLocaleString()}</div>
            </div>

            <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; margin-bottom:24px;">
                <div style="background:#14532d; padding:14px 8px; border-radius:18px; text-align:center; color:#ffffff;">
                    <div style="font-size:13px; opacity:0.8; font-weight:600; margin-bottom:4px;">ЁЯТ╡ р╣Ар╕Зр╕┤р╕Щр╕кр╕Ф</div>
                    <div style="font-size:16px; font-weight:800;">р╕┐${cashTotal.toLocaleString()}</div>
                </div>
                <div style="background:#1e3a8a; padding:14px 8px; border-radius:18px; text-align:center; color:#ffffff;">
                    <div style="font-size:13px; opacity:0.8; font-weight:600; margin-bottom:4px;">ЁЯУ▒ р╣Ар╕Зр╕┤р╕Щр╣Вр╕нр╕Щ</div>
                    <div style="font-size:16px; font-weight:800;">р╕┐${transTotal.toLocaleString()}</div>
                </div>
                <div style="background:#78350f; padding:14px 8px; border-radius:18px; text-align:center; color:#ffffff;">
                    <div style="font-size:13px; opacity:0.8; font-weight:600; margin-bottom:4px;">ЁЯСе р╕ер╕╣р╕Бр╕Др╣Йр╕▓</div>
                    <div style="font-size:16px; font-weight:800;">${customerCount}</div>
                </div>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px;">
                <div style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); padding:16px; border-radius:20px; text-align:center;">
                    <div style="font-size:14px; color:#94a3b8; font-weight:600; margin-bottom:4px;">р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕Кр╣Ир╕▓р╕З</div>
                    <div style="font-size:20px; font-weight:800; color:#f8fafc;">р╕┐${barberEarn.toLocaleString()}</div>
                </div>
                <div style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); padding:16px; border-radius:20px; text-align:center;">
                    <div style="font-size:14px; color:#94a3b8; font-weight:600; margin-bottom:4px;">р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕гр╣Йр╕▓р╕Щ</div>
                    <div style="font-size:20px; font-weight:800; color:#f8fafc;">р╕┐${shopEarn.toLocaleString()}</div>
                </div>
            </div>

            ${settleHTML}

            <div style="margin-bottom:30px;">
                <div style="font-size:14px; color:#94a3b8; font-weight:700; text-transform:uppercase; margin-bottom:12px; text-align:center;">р╕кр╕гр╕╕р╕Ыр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Зр╕▓р╕Щ</div>
                <div style="text-align:center;">${svcHTML}</div>
            </div>

            <div style="font-weight:800; font-size:16px; color:#f8fafc; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                <div style="width:4px; height:18px; background:#cbd5e1; border-radius:2px;"></div>
                р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕Зр╕▓р╕Щ
            </div>
            <div style="max-height:400px; overflow-y:auto;">
                ${rows}
            </div>
            </div>
    `);
}
function loadHistMonth() {
    const $ = (id) => document.getElementById(id);
    const m = $("histMonth").value;
    if (!m) return alert("р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕Фр╕╖р╕нр╕Щр╕Бр╣Ир╕нр╕Щр╕Др╕гр╕▒р╕Ъ");

    if (typeof archives === 'undefined') return alert("р╣Др╕бр╣Ир╕Юр╕Ър╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕лр╕ер╕▒р╕Б (archives)");

    const filtered = archives.filter(a => a.date && a.date.startsWith(m));
    if (!filtered.length) {
        return openReportModal("ЁЯУК р╕кр╕гр╕╕р╕Ыр╕гр╕▓р╕вр╣Ар╕Фр╕╖р╕нр╕Щ", `<div style='text-align:center;padding:50px;color:#94a3b8;'>р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Вр╕нр╕Зр╣Ар╕Фр╕╖р╕нр╕Щ ${m}</div>`);
    }

    // ЁЯЯв р╣Ар╕Юр╕┤р╣Ир╕бр╕Хр╕▒р╕зр╕Щр╕▒р╕Ъ monthGuarDays (р╕Ир╕│р╕Щр╕зр╕Щр╕зр╕▒р╕Щр╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕гр╕▓р╕вр╣Др╕Фр╣Й)
    let monthTotal = 0, monthBarber = 0, monthCount = 0, monthGuarDays = 0; 
    let hairStats = {}, serviceStats = {};
    let offDays = 0, workDays = 0;
    let weeklyData = {};

    const haircutList = ["р╣Бр╕Яр╕Кр╕▒р╣Ир╕Щ","р╕кр╕Бр╕┤р╕Щр╣Ар╕Яр╕Ф","р╣Ар╕Ыр╕┤р╕Фр╕Вр╣Йр╕▓р╕З","р╕гр╕нр╕Зр╕Чр╕гр╕З","р╕Хр╕│р╕гр╕зр╕И/р╕Чр╕лр╕▓р╕г","р╕Чр╕гр╕Зр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ","р╣Бр╕Бр╣Йр╕Ьр╕б","р╣Вр╕Бр╕Щр╕Ьр╕б","р╣Ар╕Фр╣Зр╕Б"];
    const dayNames = ["р╕нр╕▓р╕Чр╕┤р╕Хр╕вр╣М", "р╕Ир╕▒р╕Щр╕Чр╕гр╣М", "р╕нр╕▒р╕Зр╕Др╕▓р╕г", "р╕Юр╕╕р╕Ш", "р╕Юр╕др╕лр╕▒р╕кр╕Ър╕Фр╕╡", "р╕ир╕╕р╕Бр╕гр╣М", "р╣Ар╕кр╕▓р╕гр╣М"];

    filtered.forEach(day => {
        const dObj = new Date(day.date);
        let wIdx = Math.ceil(dObj.getDate() / 7);
        const wKey = `р╕кр╕▒р╕Ыр╕Фр╕▓р╕лр╣Мр╕Чр╕╡р╣И ${wIdx}`;

        if (!weeklyData[wKey]) {
            weeklyData[wKey] = { 
                customers: 0, workDays: 0, offDays: 0, 
                zeroDays: 0, guarDays: 0, dailyCounts: [], // р╣Ар╕Юр╕┤р╣Ир╕б guarDays р╣Гр╕Щр╕гр╕░р╕Фр╕▒р╕Ър╕кр╕▒р╕Ыр╕Фр╕▓р╕лр╣Мр╕Фр╣Йр╕зр╕в
                popularHair: {}, 
                popularService: {}, 
                income: 0 
            };
        }

        if (day.off === true || day.type === "HOLIDAY") {
            offDays++;
            weeklyData[wKey].offDays++;
            return;
        }

        workDays++;
        weeklyData[wKey].workDays++;
        
        // ЁЯЫбя╕П р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Гр╕Щр╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕зр╕▒р╕Щр╕Щр╕▒р╣Йр╕Щ р╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕г "GUARANTEE_CLAIM" р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
        const hasInsurance = day.details && day.details.some(d => d.type === "GUARANTEE_CLAIM");
        if (hasInsurance) {
            monthGuarDays++;
            weeklyData[wKey].guarDays++;
        }

        const dailyIncome = Number(day.total) || 0;
        const dailyBarber = Number(day.barber) || 0; 
        
        monthTotal += dailyIncome;
        monthBarber += dailyBarber;
        weeklyData[wKey].income += dailyIncome;

        let dayCustomerCount = 0;
        if (day.details && Array.isArray(day.details)) {
            day.details.forEach(d => {
                // ЁЯСд р╕Щр╕▒р╕Ър╣Ар╕Йр╕Юр╕▓р╕░ SERVICE р╕Ир╕гр╕┤р╕Зр╣Ж (р╣Др╕бр╣Ир╕Щр╕▒р╕Ъ GUARANTEE_CLAIM р╣Ар╕Ыр╣Зр╕Щр╕ер╕╣р╕Бр╕Др╣Йр╕▓)
                if (d.type === "SERVICE") {
                    monthCount++;
                    dayCustomerCount++;
                    weeklyData[wKey].customers++;

                    const svcs = Array.isArray(d.svcs) ? d.svcs : [d.svcs];
                    svcs.forEach(s => {
                        if (!s) return;
                        const cleanS = s.trim();
                        if (haircutList.includes(cleanS)) {
                            hairStats[cleanS] = (hairStats[cleanS] || 0) + 1;
                            weeklyData[wKey].popularHair[cleanS] = (weeklyData[wKey].popularHair[cleanS] || 0) + 1;
                        } else {
                            serviceStats[cleanS] = (serviceStats[cleanS] || 0) + 1;
                            weeklyData[wKey].popularService[cleanS] = (weeklyData[wKey].popularService[cleanS] || 0) + 1;
                        }
                    });
                }
            });
        }
        if (dayCustomerCount === 0) weeklyData[wKey].zeroDays++;
        
        weeklyData[wKey].dailyCounts.push({ 
            dayName: dayNames[dObj.getDay()], 
            count: dayCustomerCount, 
            income: dailyIncome,
            barberEarn: dailyBarber 
        });
    });

    const avgCustomerPerDay = workDays > 0 ? (monthCount / workDays) : 0;
    
    // ЁЯОп р╕кр╣Ир╕Зр╕Др╣Ир╕▓ monthGuarDays р╣Ар╕Вр╣Йр╕▓р╣Др╕Ыр╣Гр╕Щр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕гр╕╕р╕Ыр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Фр╣Йр╕зр╕в
    generateMonthlyReport(m, monthTotal, monthBarber, monthCount, workDays, offDays, avgCustomerPerDay, weeklyData, hairStats, serviceStats, monthGuarDays);
}
function generateMonthlyReport(m, monthTotal, monthBarber, monthCount, workDays, offDays, avgCustomerPerDay, weeklyData, hairStats, serviceStats, monthGuarDays) {
    // --- 1. р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М (Logic) ---
    const weekEntries = Object.entries(weeklyData);
    const dayStats = {};
    let dailyTimeline = []; 

    const haircutList = ["р╣Бр╕Яр╕Кр╕▒р╣Ир╕Щ","р╕кр╕Бр╕┤р╕Щр╣Ар╕Яр╕Ф","р╣Ар╕Ыр╕┤р╕Фр╕Вр╣Йр╕▓р╕З","р╕гр╕нр╕Зр╕Чр╕гр╕З","р╕Хр╕│р╕гр╕зр╕И/р╕Чр╕лр╕▓р╕г","р╕Чр╕гр╕Зр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ","р╣Бр╕Бр╣Йр╕Ьр╕б","р╣Вр╕Бр╕Щр╕Ьр╕б","р╣Ар╕Фр╣Зр╕Б"];
    const allHaircuts = ["р╣Бр╕Яр╕Кр╕▒р╣Ир╕Щ","р╕кр╕Бр╕┤р╕Щр╣Ар╕Яр╕Ф","р╣Ар╕Ыр╕┤р╕Фр╕Вр╣Йр╕▓р╕З","р╕гр╕нр╕Зр╕Чр╕гр╕З","р╕Хр╕│р╕гр╕зр╕И/р╕Чр╕лр╕▓р╕г","р╕Чр╕гр╕Зр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ","р╣Бр╕Бр╣Йр╕Ьр╕б","р╣Вр╕Бр╕Щр╕Ьр╕б","р╣Ар╕Фр╣Зр╕Б"];
    const allServices = ["р╣Вр╕Бр╕Щр╕лр╕Щр╕зр╕Ф", "р╕кр╕гр╕░р╕Ьр╕б", "р╕вр╣Йр╕нр╕бр╕Ьр╕б", "р╕Бр╕▒р╕Щр╕лр╕Щр╣Йр╕▓", "р╕Фр╕▒р╕Фр╕Ьр╕б", "р╕вр╣Йр╕нр╕бр╣Бр╕Яр╕Кр╕▒р╣Ир╕Щ"]; 

    const topHair = Object.entries(hairStats).sort((a, b) => b[1] - a[1])[0];
    const topService = Object.entries(serviceStats).sort((a, b) => b[1] - a[1])[0];

    weekEntries.forEach(([wk, data]) => {
        if (data.dailyCounts) {
            data.dailyCounts.forEach(d => {
                dailyTimeline.push(d); 
                const dayName = d.dayName.split(' ')[0]; 
                if (!dayStats[dayName]) dayStats[dayName] = { total: 0, count: 0 };
                if (d.count > 0) {
                    dayStats[dayName].total += d.count;
                    dayStats[dayName].count += 1;
                }
            });
        }
    });

    const topIncomeWeek = weekEntries.length > 0 ? weekEntries.reduce((prev, curr) => (curr[1].income > prev[1].income ? curr : prev)) : null;
    const topCountWeek = weekEntries.length > 0 ? weekEntries.reduce((prev, curr) => (curr[1].customers > prev[1].customers ? curr : prev)) : null;

    const dayAverages = Object.entries(dayStats)
        .filter(([name, data]) => data.count > 0)
        .map(([name, data]) => ({ name, avg: data.total / data.count }));

    const busiestDay = dayAverages.sort((a, b) => b.avg - a.avg)[0];
    const quietestDay = dayAverages.sort((a, b) => a.avg - b.avg)[0];

    const renderStats = (statsObj, color) => {
        const entries = Object.entries(statsObj).sort((a,b) => b[1]-a[1]);
        if (entries.length === 0) return `<div style="color:#64748b; font-size:12px;">р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕Цр╕┤р╕Хр╕┤</div>`;
        const maxVal = entries[0][1];
        return entries.map(([name, count]) => {
            const width = (count / maxVal) * 100;
            return `
            <div style="margin-bottom:10px;">
                <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:4px;">
                    <span style="color:#f8fafc;">${name}</span>
                    <span style="color:${color}; font-weight:700;">${count}</span>
                </div>
                <div style="width:100%; height:6px; background:rgba(255,255,255,0.05); border-radius:10px; overflow:hidden;">
                    <div style="width:${width}%; height:100%; background:${color}; border-radius:10px;"></div>
                </div>
            </div>`;
        }).join("");
    };

    const maxWeekCount = topCountWeek ? topCountWeek[1].customers : 0;
    const maxIncomeAmount = topIncomeWeek ? (topIncomeWeek[1].income || 0) : 0;

    // ЁЯОп р╣Бр╕Бр╣Йр╣Др╕Вр╕Ир╕╕р╕Фр╕Чр╕╡р╣Ир╕бр╕╡р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕лр╕бр╕▓р╕в ? р╣Ар╕Бр╕┤р╕Щ р╣Бр╕ер╕░р╕Ир╕▒р╕Фр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ Insights
    const insights = [
        `р╣Ар╕Фр╕╖р╕нр╕Щр╕Щр╕╡р╣Йр╣Ар╕Ыр╕┤р╕Фр╣Гр╕лр╣Йр╕Ър╕гр╕┤р╕Бр╕▓р╕гр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф <b>${workDays} р╕зр╕▒р╕Щ</b> (р╕лр╕вр╕╕р╕Ф ${offDays} р╕зр╕▒р╕Щ)`,
        `р╣Гр╕Кр╣Йр╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕гр╕▓р╕вр╣Др╕Фр╣Йр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф <b>${monthGuarDays || 0} р╕зр╕▒р╕Щ</b>`,
        (topIncomeWeek && maxIncomeAmount > 0) ? `р╕кр╕▒р╕Ыр╕Фр╕▓р╕лр╣Мр╕Чр╕╡р╣Ир╕Чр╕│р╕гр╕▓р╕вр╣Др╕Фр╣Йр╕кр╕╣р╕Зр╕кр╕╕р╕Фр╕Др╕╖р╕н <b>${topIncomeWeek[0]}</b>` : `р╕кр╕▒р╕Ыр╕Фр╕▓р╕лр╣Мр╕Чр╕╡р╣Ир╕Чр╕│р╕гр╕▓р╕вр╣Др╕Фр╣Йр╕кр╕╣р╕Зр╕кр╕╕р╕Фр╕Др╕╖р╕н <b>-</b>`,
        (topCountWeek && maxWeekCount > 0) ? `р╕кр╕▒р╕Ыр╕Фр╕▓р╕лр╣Мр╕Чр╕╡р╣Ир╕бр╕╡р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕бр╕▓р╕Бр╕Чр╕╡р╣Ир╕кр╕╕р╕Фр╕Др╕╖р╕н <b>${topCountWeek[0]}</b>` : `р╕кр╕▒р╕Ыр╕Фр╕▓р╕лр╣Мр╕Чр╕╡р╣Ир╕бр╕╡р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕бр╕▓р╕Бр╕Чр╕╡р╣Ир╕кр╕╕р╕Фр╕Др╕╖р╕н <b>-</b>`,
        (busiestDay && busiestDay.avg > 0) ? (() => {
            if (!quietestDay || busiestDay.avg === quietestDay.avg) return `р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╣Ар╕Вр╣Йр╕▓р╣Ар╕вр╕нр╕░р╣Гр╕Щ <b>р╕зр╕▒р╕Щ${busiestDay.name}</b>`;
            return `р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╣Ар╕Вр╣Йр╕▓р╣Ар╕вр╕нр╕░р╣Гр╕Щ <b>р╕зр╕▒р╕Щ${busiestDay.name}</b> р╣Бр╕ер╕░р╕Щр╣Йр╕нр╕вр╣Гр╕Щ <b>р╕зр╕▒р╕Щ${quietestDay.name}</b>`;
        })() : `р╕кр╕Цр╕┤р╕Хр╕┤р╕гр╕▓р╕вр╕зр╕▒р╕Щ: -`,
        `р╕Чр╕гр╕Зр╕Ьр╕бр╕вр╕нр╕Фр╕Щр╕┤р╕вр╕б: <b>${topHair ? topHair[0] : '-'}</b> | р╕Ър╕гр╕┤р╕Бр╕▓р╕гр╕вр╕нр╕Фр╕Щр╕┤р╕вр╕б: <b>${topService ? topService[0] : '-'}</b>`
    ];

    const weeklyHtml = weekEntries.map(([wk, data]) => {
        const weeklyTotalIncome = data.income || 0;
        let sumBarber = 0;
        if (data.dailyCounts) {
            data.dailyCounts.forEach(day => { sumBarber += Number(day.barberEarn || 0); });
        }
        const wBarber = sumBarber;
        const wShop = weeklyTotalIncome - wBarber;
        const avg = data.workDays > 0 ? (data.customers / data.workDays).toFixed(1) : 0;
        
        const sortedDays = data.dailyCounts ? [...data.dailyCounts].sort((a,b) => b.count - a.count) : [];
        const maxCount = sortedDays.length > 0 ? sortedDays[0].count : 0;
        const minCount = sortedDays.length > 0 ? sortedDays[sortedDays.length - 1].count : 0;

        const bestDay = (maxCount > 0) ? `${sortedDays[0].dayName} (${maxCount})` : "-";
        let worstDay = (sortedDays.length > 1 && maxCount !== minCount) ? `${sortedDays[sortedDays.length - 1].dayName} (${minCount})` : "-";

        const unusedHair = allHaircuts.filter(h => !data.popularHair[h]);
        const unusedService = allServices.filter(s => !data.popularService[s]);

        const popHair = Object.entries(data.popularHair || {}).sort((a,b) => b[1] - a[1]).slice(0, 2).map(([name, count]) => `
            <span style="background:rgba(190,242,100,0.1); color:#bef264; padding:2px 8px; border-radius:8px; font-size:10px; border:1px solid rgba(190,242,100,0.2); margin-right:4px;">тЬВя╕П ${name} ${count}</span>
        `).join("");

        const popService = Object.entries(data.popularService || {}).sort((a,b) => b[1] - a[1]).slice(0, 2).map(([name, count]) => `
            <span style="background:rgba(56,189,248,0.1); color:#38bdf8; padding:2px 8px; border-radius:8px; font-size:10px; border:1px solid rgba(56,189,248,0.2); margin-right:4px;">ЁЯз┤ ${name} ${count}</span>
        `).join("");

        return `
        <div style="background:#020617; border:1px solid rgba(255,255,255,0.08); padding:16px; border-radius:22px; margin-bottom:12px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <div style="font-size:15px; font-weight:800; color:#f8fafc;">ЁЯУЕ ${wk}</div>
                <div style="font-size:10px; color:#94a3b8;">р╣Ар╕Ыр╕┤р╕Ф ${data.workDays} | р╕лр╕вр╕╕р╕Ф ${data.offDays}</div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:6px; margin-bottom:10px;">
                <div style="background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.1); padding:6px 4px; border-radius:12px; text-align:center;">
                    <div style="font-size:9px; color:#94a3b8; margin-bottom:2px;">р╕вр╕нр╕Фр╕гр╕зр╕б</div>
                    <div style="font-size:13px; font-weight:800; color:#ffffff;">р╕┐${weeklyTotalIncome.toLocaleString()}</div>
                </div>
                <div style="background:rgba(190,242,100,0.05); border:1px solid rgba(190,242,100,0.2); padding:6px 4px; border-radius:12px; text-align:center;">
                    <div style="font-size:9px; color:#bef264; margin-bottom:2px;">р╕Кр╣Ир╕▓р╕З</div>
                    <div style="font-size:13px; font-weight:800; color:#bef264;">р╕┐${Math.floor(wBarber).toLocaleString()}</div>
                </div>
                <div style="background:rgba(56,189,248,0.05); border:1px solid rgba(56,189,248,0.2); padding:6px 4px; border-radius:12px; text-align:center;">
                    <div style="font-size:9px; color:#38bdf8; margin-bottom:2px;">р╕гр╣Йр╕▓р╕Щ</div>
                    <div style="font-size:13px; font-weight:800; color:#38bdf8;">р╕┐${Math.floor(wShop).toLocaleString()}</div>
                </div>
            </div>
            <div style="display:flex; gap:6px; margin-bottom:10px;">
                <div style="flex:1; background:rgba(255,255,255,0.02); padding:4px 10px; border-radius:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-size:10px; color:#64748b;">ЁЯСд р╕ер╕╣р╕Бр╕Др╣Йр╕▓</span>
                    <span style="font-size:11px; font-weight:700; color:#38bdf8;">${data.customers}</span>
                </div>
                <div style="flex:1; background:rgba(250,204,21,0.05); border:1px solid rgba(250,204,21,0.1); padding:4px 10px; border-radius:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-size:10px; color:#facc15;">ЁЯЫбя╕П р╕Ыр╕гр╕░р╕Бр╕▒р╕Щ</span>
                    <span style="font-size:11px; font-weight:700; color:#facc15;">${data.guarDays || 0}</span>
                </div>
                <div style="flex:1; background:rgba(255,255,255,0.02); padding:4px 10px; border-radius:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-size:10px; color:#64748b;">ЁЯУК р╣Ар╕Йр╕ер╕╡р╣Ир╕в</span>
                    <span style="font-size:11px; font-weight:700; color:#ffffff;">${avg}</span>
                </div>
            </div>
            <div style="font-size:11px; color:#64748b; line-height:1.6; padding:0 4px 10px 4px; border-bottom:1px solid rgba(255,255,255,0.05); margin-bottom:10px;">
                <div>ЁЯУИ р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╣Ар╕вр╕нр╕░р╕Чр╕╡р╣Ир╕кр╕╕р╕Ф: <span style="color:#f1f5f9; font-weight:600;">${bestDay}</span></div>
                <div>ЁЯУЙ р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕Щр╣Йр╕нр╕вр╕Чр╕╡р╣Ир╕кр╕╕р╕Ф: <span style="color:#f1f5f9; font-weight:600;">${worstDay}</span></div>
            </div>
            <div style="display:flex; flex-wrap:wrap; gap:4px; margin-top: 8px;">
                ${popHair} ${popService}
            </div>
        </div>`;
    }).join("");

    openReportModal(
        `р╕кр╕гр╕╕р╕Ыр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╣Ар╕Фр╕╖р╕нр╕Щ ${m}`,
        `<div style="background:#0f172a; padding:24px; color:#f1f5f9; border-radius:20px; font-family: sans-serif; margin-bottom:50px;">
            <div style="text-align:center; padding:10px 0 20px 0;">
                <div style="font-size:16px; color:#94a3b8; font-weight:700; margin-bottom:5px;">тЬВя╕П р╕гр╕▓р╕вр╣Др╕Фр╣Йр╕гр╕зр╕бр╕Ыр╕гр╕░р╕Ир╕│р╣Ар╕Фр╕╖р╕нр╕Щ</div>
                <div style="font-size:48px; font-weight:900; color:#ffffff;">р╕┐${monthTotal.toLocaleString()}</div>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px;">
                <div style="background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.1); padding:15px; border-radius:20px; text-align:center;">
                    <div style="font-size:11px; color:#94a3b8;">р╕гр╕▓р╕вр╣Др╕Фр╣Йр╕Кр╣Ир╕▓р╕З</div>
                    <div style="font-size:20px; font-weight:800; color:#f8fafc;">р╕┐${Math.floor(monthBarber).toLocaleString()}</div>
                </div>
                <div style="background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.1); padding:15px; border-radius:20px; text-align:center;">
                    <div style="font-size:11px; color:#94a3b8;">р╕гр╕▓р╕вр╣Др╕Фр╣Йр╕гр╣Йр╕▓р╕Щ</div>
                    <div style="font-size:20px; font-weight:800; color:#f8fafc;">р╕┐${Math.floor(monthTotal - monthBarber).toLocaleString()}</div>
                </div>
            </div>
            <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:8px; margin-bottom:25px;">
                <div style="background:rgba(56,189,248,0.15); padding:6px 14px; border-radius:12px; font-size:13px; font-weight:600; color:#38bdf8;">ЁЯСд р╕ер╕╣р╕Бр╕Др╣Йр╕▓ ${monthCount} р╕Др╕Щ</div>
                <div style="background:rgba(255,255,255,0.08); padding:6px 14px; border-radius:12px; font-size:13px; font-weight:600; color:#f8fafc;">ЁЯУЕ р╣Ар╕Ыр╕┤р╕Фр╕гр╣Йр╕▓р╕Щ ${workDays} р╕зр╕▒р╕Щ</div>
                <div style="background:rgba(250,204,21,0.15); padding:6px 14px; border-radius:12px; font-size:13px; font-weight:600; color:#facc15;">ЁЯЫбя╕П р╕Ыр╕гр╕░р╕Бр╕▒р╕Щ ${monthGuarDays || 0} р╕зр╕▒р╕Щ</div>
                <div style="background:rgba(244,63,94,0.15); padding:6px 14px; border-radius:12px; font-size:13px; font-weight:600; color:#fb7185;">ЁЯЫС р╕лр╕вр╕╕р╕Ф ${offDays} р╕зр╕▒р╕Щ</div>
                <div style="background:rgba(147, 51, 234, 0.15); padding:6px 14px; border-radius:12px; font-size:13px; font-weight:600; color:#a855f7;">ЁЯУК р╣Ар╕Йр╕ер╕╡р╣Ир╕в ${avgCustomerPerDay.toFixed(2)}</div>
            </div>
            <div style="margin-bottom:25px;">
                <div style="font-size:14px; font-weight:800; color:#facc15; margin-bottom:12px;">ЁЯУЕ р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕гр╕▓р╕вр╕кр╕▒р╕Ыр╕Фр╕▓р╕лр╣М</div>
                ${weeklyHtml}
            </div>
            <div style="background:rgba(250,204,21,0.08); border:1px solid rgba(250,204,21,0.25); padding:18px; border-radius:20px; margin-bottom:30px;">
                <div style="font-size:14px; font-weight:800; color:#facc15; margin-bottom:10px;">ЁЯТб р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕ар╕▓р╕Юр╕гр╕зр╕б</div>
                ${insights.map(i => `<div style="font-size:13px; color:#f8fafc; margin-bottom:6px;">тАв ${i}</div>`).join("")}
            </div>
            <div style="margin-bottom:25px;">
                <div style="font-size:15px; font-weight:800; color:#bef264; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                    <div style="width:4px; height:16px; background:#bef264; border-radius:2px;"></div> р╕Чр╕гр╕Зр╕Ьр╕бр╕вр╕нр╕Фр╕Щр╕┤р╕вр╕б
                </div>
                ${renderStats(hairStats, "#bef264")}
            </div>
            <div style="padding-bottom:20px;">
                <div style="font-size:15px; font-weight:800; color:#38bdf8; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                    <div style="width:4px; height:16px; background:#38bdf8; border-radius:2px;"></div> р╕Ър╕гр╕┤р╕Бр╕▓р╕гр╕вр╕нр╕Фр╕Щр╕┤р╕вр╕б
                </div>
                ${renderStats(serviceStats, "#38bdf8")}
            </div>
        </div>`
    );
}  
function renderStats(obj, accentColor) {
    const entries = Object.entries(obj).sort((a, b) => b[1] - a[1]);
    if (!entries.length) return "<div style='color:rgba(255,255,255,0.2); padding:10px; font-size:13px;'>р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕Цр╕┤р╕Хр╕┤</div>";
    
    return entries.map(([k, v]) => `
        <div style="display:flex; justify-content:space-between; align-items:center; padding:12px 16px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08); border-radius:16px; margin-bottom:8px;">
            <div style="font-weight:600; color:#f1f5f9; font-size:14px;">${k}</div>
            <div style="font-weight:800; color:${accentColor}; font-size:16px;">${v} <span style="font-size:11px; opacity:0.5; color:#fff;">р╕Др╕гр╕▒р╣Йр╕З</span></div>
        </div>`).join("");
}
function shareLine() {
    const dInp = $("dateInp").value;
    const today = db.filter(r => r.date === dInp);
    
    if (!today.length) {
        alert("р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Вр╕нр╕Зр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕ер╕╖р╕нр╕Б");
        return;
    }
    // --- ЁЯЯв р╣Бр╕Бр╣Йр╣Др╕Вр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щр╣Бр╕Ър╕Ър╕вр╣Ир╕н (р╣Ар╕Кр╣Ир╕Щ 13 р╕Б.р╕Ю. 69) ---
    const [y, m, d] = dInp.split('-');
    const months = ['р╕б.р╕Д.', 'р╕Б.р╕Ю.', 'р╕бр╕╡.р╕Д.', 'р╣Ар╕б.р╕в.', 'р╕Ю.р╕Д.', 'р╕бр╕┤.р╕в.', 'р╕Б.р╕Д.', 'р╕к.р╕Д.', 'р╕Б.р╕в.', 'р╕Х.р╕Д.', 'р╕Ю.р╕в.', 'р╕Ш.р╕Д.'];
    const fDate = `${parseInt(d)} ${months[parseInt(m)-1]} ${(parseInt(y) + 543).toString().slice(-2)}`;
    
    // --- ЁЯЯв р╕Фр╕╢р╕Зр╕Кр╕╖р╣Ир╕нр╕гр╣Йр╕▓р╕Щр╕Ир╕▓р╕Б Config ---
    const shopName = conf.shop || "Barber Shop";

    let tot = 0, cash = 0, trans = 0, tips = 0;
    let stats = {}, realCustomerCount = 0;

    // 1. р╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╕гр╕▓р╕вр╕Бр╕▓р╕гр╕ер╕╣р╕Бр╕Др╣Йр╕▓ (р╕Др╕Зр╣Ар╕Фр╕┤р╕б)
    const clientList = today
        .sort((a, b) => a.time.localeCompare(b.time))
        .map((r, i) => {
            const p = Number(r.price) || 0;
            const t = Number(r.tip) || 0;
            const rType = r.type ? String(r.type).toUpperCase().trim() : '';
            
            tot += p;
            tips += t;

            if (r.pay === 'Trans') {
                trans += (p + t);
            } else {
                cash += p;
            }

            const isService = !['GUARANTEE', 'HOLIDAY'].includes(rType) && p > 0;
            if (isService) {
                realCustomerCount++;
                if (r.hair && r.hair.includes("р╣Ар╕Фр╣Зр╕Б")) stats["р╣Ар╕Фр╣Зр╕Б"] = (stats["р╣Ар╕Фр╣Зр╕Б"] || 0) + 1;
                (r.svcs || []).forEach(s => { if (s) stats[s] = (stats[s] || 0) + 1; });
            }

            const tShow = r.endTime ? `${r.time}-${r.endTime}` : r.time;
            const icon = rType === 'GUARANTEE' ? 'ЁЯЫбя╕П' : (rType === 'HOLIDAY' ? 'ЁЯПЦя╕П' : '');
            const payIcon = r.pay === 'Trans' ? 'ЁЯУ▒' : 'ЁЯТ╡';

            return `${i + 1}. [${tShow}] ${icon} ${(r.svcs || []).join('+')} = ${p}${t ? ` (+р╕Чр╕┤р╕Ы ${t})` : ''} ${payIcon}`;
        }).join('\n');

    // 2. р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕кр╕Цр╕┤р╕Хр╕┤ (р╕Др╕Зр╣Ар╕Фр╕┤р╕б)
    const allowed = ["р╣Ар╕Фр╣Зр╕Б", "р╕кр╕гр╕░р╕Ьр╕б", "р╣Вр╕Бр╕Щр╕лр╕Щр╕зр╕Ф", "р╕вр╣Йр╕нр╕бр╕Ьр╕б", "р╕вр╣Йр╕нр╕бр╕кр╕╡"];
    const icons = { "р╣Ар╕Фр╣Зр╕Б": "ЁЯзТ", "р╕кр╕гр╕░": "ЁЯз╝", "р╣Вр╕Бр╕Щ": "ЁЯкТ", "р╕вр╣Йр╕нр╕б": "ЁЯОи" };
    
    let statText = Object.entries(stats)
        .filter(([k]) => allowed.some(a => k.includes(a)))
        .map(([k, v]) => {
            const iconKey = Object.keys(icons).find(i => k.includes(i));
            return `${icons[iconKey] || 'ЁЯФ╣'} ${k}: ${v}`;
        }).join('\n');

    // 3. р╕Др╕│р╕Щр╕зр╕Ур╕гр╕▓р╕вр╣Др╕Фр╣Й (р╕Др╕Зр╣Ар╕Фр╕┤р╕б)
    let bEarn = Math.max(tot * (conf.perc / 100), conf.guar) + tips;
    let bEarnNoTip = bEarn - tips; 
    let shopEarn = tot - bEarnNoTip;
    
    let settle = cash - bEarn;
    let settleMsg = settle > 0 
        ? `тЪая╕П р╕Кр╣Ир╕▓р╕Зр╕Др╕╖р╕Щр╕гр╣Йр╕▓р╕Щ: ${Math.floor(Math.abs(settle)).toLocaleString()} р╕Ър╕▓р╕Ч` 
        : `ЁЯЯж р╕гр╣Йр╕▓р╕Щр╕Др╕╖р╕Щр╕Кр╣Ир╕▓р╕З: ${Math.floor(Math.abs(settle)).toLocaleString()} р╕Ър╕▓р╕Ч`;

    // 4. р╕Ыр╕гр╕░р╕Бр╕нр╕Ър╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б (Template)
    let msg = `ЁЯТИ р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕гр╣Йр╕▓р╕Щ: ${shopName}\n`; // ЁЯЯв р╣Гр╕Кр╣Йр╕Кр╕╖р╣Ир╕нр╕гр╣Йр╕▓р╕Щр╕Ир╕▓р╕Бр╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╣Бр╕ер╣Йр╕з
    msg += `ЁЯУЕ р╕зр╕▒р╕Щр╕Чр╕╡р╣И: ${fDate}\n`;            // ЁЯЯв р╣Ар╕Ыр╣Зр╕Щр╣Бр╕Ър╕Ър╕вр╣Ир╕нр╣Бр╕ер╣Йр╕з
    msg += `-------------------------\n`;
    msg += `ЁЯУЭ р╕ер╕╣р╕Бр╕Др╣Йр╕▓ (${realCustomerCount} р╕Др╕Щ):\n${clientList}\n`;
    msg += `-------------------------\n`;
    msg += `ЁЯУК р╕кр╕гр╕╕р╕Ыр╕Зр╕▓р╕Щ:\n${statText || '(р╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕г)'}\n`;
    msg += `-------------------------\n`;
    msg += `ЁЯТ░ р╕вр╕нр╕Ф: ${tot.toLocaleString()} | ЁЯзз р╕Чр╕┤р╕Ы: ${tips}\n`;
    msg += `ЁЯУ▒ р╣Вр╕нр╕Щ: ${trans.toLocaleString()} | ЁЯТ╡ р╣Ар╕Зр╕┤р╕Щр╕кр╕Ф: ${cash.toLocaleString()}\n`;
    msg += `ЁЯд╡ р╕Кр╣Ир╕▓р╕З: ${Math.floor(bEarn).toLocaleString()}\n`;
    msg += `ЁЯПа р╕гр╣Йр╕▓р╕Щ: ${Math.floor(shopEarn).toLocaleString()}\n`;
    msg += `-------------------------\n`;
    msg += `${settleMsg}`;

    // 5. р╣Бр╕кр╕Фр╕З Preview (р╕кр╕│р╕Др╕▒р╕Нр╕бр╕▓р╕Б)
    const msgEdit = $("msgEdit"); // р╣Гр╕Кр╣Йр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ $ р╕Чр╕╡р╣Ир╕Др╕╕р╕Ур╕Ыр╕гр╕░р╕Бр╕▓р╕ир╣Др╕зр╣Й
    const previewArea = $("linePreview");
    
    if (msgEdit && previewArea) {
        msgEdit.value = msg;
        previewArea.style.display = "flex"; // р╣Бр╕кр╕Фр╕Зр╕лр╕Щр╣Йр╕▓р╕Хр╣Ир╕▓р╕З Preview
        console.log("тЬЕ Preview Generated");
    } else {
        console.error("тЭМ р╣Др╕бр╣Ир╕Юр╕Ъ Element р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕кр╕Фр╕З Preview");
        alert("р╕гр╕░р╕Ър╕Ър╕Юр╕гр╕╡р╕зр╕┤р╕зр╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓ р╣Вр╕Ыр╕гр╕Фр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ ID р╕Вр╕нр╕Зр╕лр╕Щр╣Йр╕▓р╕Хр╣Ир╕▓р╕Зр╕Юр╕гр╕╡р╕зр╕┤р╕зр╕Др╕гр╕▒р╕Ъ");
    }
}
function sendToLineFinal() {
    const msgEdit = document.getElementById("msgEdit");
    const previewArea = document.getElementById("linePreview");
    // 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
    if (!msgEdit || !msgEdit.value.trim()) {
        alert("р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Бр╣Ир╕нр╕Щр╕кр╣Ир╕Зр╕Др╕гр╕▒р╕Ъ");
        return;
    }
    const finalMsg = msgEdit.value;
    // 2. р╣Гр╕Кр╣Й LINE URL Scheme р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Ыр╕┤р╕Фр╣Бр╕нр╕Ы LINE р╣Бр╕ер╕░р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б
    // encodeURIComponent р╕Ир╕░р╕Кр╣Ир╕зр╕вр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕нр╕▒р╕Бр╕Вр╕гр╕░р╕Юр╕┤р╣Ар╕ир╕йр╣Бр╕ер╕░р╣Ар╕зр╣Йр╕Щр╕зр╕гр╕гр╕Др╣Гр╕лр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
    const lineUrl = `https://line.me/R/msg/text/?${encodeURIComponent(finalMsg)}`;
    // р╣Ар╕Ыр╕┤р╕Фр╕лр╕Щр╣Йр╕▓р╕Хр╣Ир╕▓р╕Зр╣Гр╕лр╕бр╣Ир╣Ар╕Юр╕╖р╣Ир╕нр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
    window.open(lineUrl, '_blank');
    // 3. р╕Ыр╕┤р╕Фр╕лр╕Щр╣Йр╕▓р╕Хр╣Ир╕▓р╕З Preview р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕кр╣Ир╕Зр╣Ар╕кр╕гр╣Зр╕И (р╕лр╕гр╕╖р╕нр╕Хр╕▒р╣Йр╕З Timeout р╣Ар╕ер╣Зр╕Бр╕Щр╣Йр╕нр╕вр╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕Фр╕╣р╣Ар╕Ыр╣Зр╕Щр╕Шр╕гр╕гр╕бр╕Кр╕▓р╕Хр╕┤)
    if (previewArea) {
        previewArea.style.display = "none";
    }
}
/* ==========================================================
   SECTION 8: SETTINGS & APPEARANCE
   (р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Бр╕нр╕Ыр╣Бр╕ер╕░р╕Шр╕╡р╕б)
   ========================================================== */
function openSettings() {
    // 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕е configuration р╕лр╕гр╕╖р╕нр╣Др╕бр╣И (р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡р╣Гр╕лр╣Йр╣Гр╕Кр╣Йр╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ)
    const config = conf || {};
    // 2. р╕гр╕▓р╕вр╕Бр╕▓р╕г mapping р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З ID р╕Вр╕нр╕З Element р╣Бр╕ер╕░р╕Др╣Ир╕▓р╣Гр╕Щ conf
    // р╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Йр╣Вр╕Др╣Йр╕Фр╕кр╕░р╕нр╕▓р╕Фр╕Вр╕╢р╣Йр╕Щ р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Ар╕Вр╕╡р╕вр╕Щ if р╕Лр╣Йр╕│р╣Ж р╕лр╕ер╕▓р╕вр╕Ър╕гр╕гр╕Чр╕▒р╕Ф
    const fields = {
        "setShop":  config.shop  || "",
        "setTheme": config.theme || "light",
        "setVoice": config.voice || "female",
        "setSound": config.sound || "on",
        "setPerc":  config.perc  || 50,
        "setGuar":  config.guar  || 0
    };
    // 3. р╕зр╕Щр╕ер╕╣р╕Ыр╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕кр╣Ир╕Др╣Ир╕▓р╕ер╕Зр╣Гр╕Щр╣Бр╕Хр╣Ир╕ер╕░ Input (р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╣Ир╕нр╕Щр╕зр╣Ир╕▓р╕бр╕╡ Element р╕Щр╕▒р╣Йр╕Щр╕Ир╕гр╕┤р╕З)
    Object.entries(fields).forEach(([id, value]) => {
        const el = $(id);
        if (el) el.value = value;
    });
    // 4. р╣Бр╕кр╕Фр╕Зр╕Ьр╕е Modal
    const modal = $("modalSet");
    if (modal) {
        modal.style.display = "flex";
    } else {
        console.error("р╣Др╕бр╣Ир╕Юр╕Ъ Element: modalSet");
    }
}
function saveSettings() {
    // 1. р╕Фр╕╢р╕Зр╕Др╣Ир╕▓р╕Ир╕▓р╕Бр╕Яр╕нр╕гр╣Мр╕б (р╣Ар╕Юр╕┤р╣Ир╕б sound р╣Ар╕Вр╣Йр╕▓р╣Др╕Ыр╕Др╕гр╕▒р╕Ъ)
    const settings = {
        shop:  $("setShop")?.value || "",
        perc:  parseFloat($("setPerc")?.value) || 0,
        guar:  parseFloat($("setGuar")?.value) || 0,
        theme: $("setTheme")?.value || "light",
        voice: $("setVoice")?.value || "default.mp3",
        sound: $("setSound")?.value || "on"  // ЁЯЯв р╣Ар╕Юр╕┤р╣Ир╕бр╕Ър╕гр╕гр╕Чр╕▒р╕Фр╕Щр╕╡р╣Йр╕Др╕гр╕▒р╕Ъ
    };

    // 2. р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕Бр╕ер╕▓р╕З (conf) р╕Чр╕▒р╕Щр╕Чр╕╡ 
    Object.assign(conf, settings);

    // 3. р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕ер╕З LocalStorage (р╕Бр╣Йр╕нр╕Щр╣Ар╕Фр╕╡р╕вр╕з JSON)
    localStorage.setItem('barber_conf', JSON.stringify(conf));

    // ЁЯЯв р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕вр╕Б Key (р╣Ар╕Юр╕┤р╣Ир╕б shopSound р╣Ар╕Вр╣Йр╕▓р╣Др╕Ыр╕Фр╣Йр╕зр╕вр╕Др╕гр╕▒р╕Ъ)
    localStorage.setItem('shopName',  settings.shop);
    localStorage.setItem('shopPerc',  settings.perc);
    localStorage.setItem('shopGuar',  settings.guar);
    localStorage.setItem('shopTheme', settings.theme);
    localStorage.setItem('shopVoice', settings.voice);
    localStorage.setItem('shopSound', settings.sound); // ЁЯЯв р╣Ар╕Юр╕┤р╣Ир╕бр╕Ър╕гр╕гр╕Чр╕▒р╕Фр╕Щр╕╡р╣Йр╕Др╕гр╕▒р╕Ъ

    // 4. р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Чр╕▒р╕Щр╕Чр╕╡
    if ($("shopNameDisp")) {
        $("shopNameDisp").innerText = settings.shop.toUpperCase();
    } 

    if (document.getElementById("shopNameDisplay")) {
        document.getElementById("shopNameDisplay").innerText = settings.shop;
    }

    // 5. р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕нр╕▒р╕Ыр╣Ар╕Фр╕Х UI р╣Бр╕ер╕░р╕Др╕│р╕Щр╕зр╕Ур╣Гр╕лр╕бр╣И
    if (typeof applyTheme === "function")        applyTheme(settings.theme);
    if (typeof calculateMoney === "function")    calculateMoney(); 
    if (typeof renderDay === "function")         renderDay(); 

    // ЁЯЯв р╕Цр╣Йр╕▓р╕Кр╣Ир╕▓р╕Зр╕бр╕╡р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Ар╕Ыр╕┤р╕Ф/р╕Ыр╕┤р╕Фр╣Ар╕кр╕╡р╕вр╕З р╣Гр╕лр╣Йр╣Ар╕гр╕╡р╕вр╕Бр╕Чр╕╡р╣Ир╕Щр╕╡р╣Ир╣Др╕Фр╣Йр╣Ар╕ер╕вр╕Др╕гр╕▒р╕Ъ
    // if (typeof updateSoundStatus === "function") updateSoundStatus(settings.sound);

    // 6. р╕Ыр╕┤р╕Ф Modal р╣Бр╕ер╕░р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ
    if ($("modalSet")) $("modalSet").style.display = 'none';
    
    alert("тЬЕ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з");
}
function handleSave(event) {
    // 1. р╕Фр╕╢р╕Зр╕Др╣Ир╕▓р╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щр╣Бр╕ер╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
    const price = parseInt($("priceInp")?.value) || 0;
    const tip = parseInt($("tipInp")?.value) || 0;
    const dateVal = $("dateInp")?.value;

    if (!price || !payMethod) {
        // ЁЯФК р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕кр╕╡р╕вр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╣Ар╕бр╕╖р╣Ир╕нр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╕Др╕гр╕Ъ
        speak("р╕Бр╕гр╕╕р╕Ур╕▓р╣Гр╕кр╣Ир╕гр╕▓р╕Др╕▓р╣Бр╕ер╕░р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕┤р╕Шр╕╡р╕Ир╣Ир╕▓р╕вр╣Ар╕Зр╕┤р╕Щ");
        return alert("р╕Бр╕гр╕╕р╕Ур╕▓р╣Гр╕кр╣Ир╕гр╕▓р╕Др╕▓р╣Бр╕ер╕░р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕┤р╕Шр╕╡р╕Ир╣Ир╕▓р╕вр╣Ар╕Зр╕┤р╕Щ!");
    }

    // 2. р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Ар╕гр╕╖р╣Ир╕нр╕Зр╣Ар╕зр╕ер╕▓ (р╕кр╕│р╕Др╕▒р╕Н: р╣Ар╕Бр╣Зр╕Ър╕Др╣Ир╕▓ End Time р╣Др╕зр╣Йр╕Бр╣Ир╕нр╕Щр╕гр╕╡р╣Ар╕Лр╣Зр╕Х)
    const startTime = $("tStart")?.value || new Date().toTimeString().slice(0, 5);
    const endTime = $("tEnd")?.value; 

    // 3. р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щ (р╕кр╕Ф / р╣Вр╕нр╕Щ / р╕Ьр╕кр╕б)
    let cashAmt = 0, transAmt = 0;
    if (payMethod === 'Mix') {
        cashAmt = parseInt($("mixCash")?.value) || 0;
        transAmt = parseInt($("mixTrans")?.value) || 0;
        if (cashAmt + transAmt !== price + tip) {
            const isConfirmed = confirm(`р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╣Др╕бр╣Ир╕Хр╕гр╕Зр╕Ър╕┤р╕е (р╕Ир╣Ир╕▓р╕вр╕Ир╕гр╕┤р╕З ${cashAmt + transAmt} / р╕Ър╕┤р╕е ${price + tip})\nр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Хр╣Ир╕нр╣Др╕Ыр╣Др╕лр╕б?`);
            if (!isConfirmed) return;
        }
    } else {
        payMethod === 'Cash' ? cashAmt = price + tip : transAmt = price + tip;
    }
    // 4. р╕кр╕гр╣Йр╕▓р╕Зр╕нр╣Зр╕нр╕Ър╣Ар╕Ир╕Бр╕Хр╣Мр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е (Record Object)
    const rec = {
        id: Date.now(), 
        date: dateVal, 
        time: startTime, 
        endTime: endTime || (typeof addMinutes === 'function' ? addMinutes(startTime, 30) : startTime),
        svcs: [$("hairStyle")?.value, $("extra1")?.value, $("extra2")?.value].filter(Boolean),
        price: price, 
        tip: tip, 
        pay: payMethod, 
        payCash: cashAmt, 
        payTrans: transAmt, 
        type: "SERVICE"
    };

    // 5. р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕гр╕░р╕Ър╕Ъ
    db.push(rec); 
    saveDB(); 

    // ЁЯФК --- р╣Ар╕Юр╕┤р╣Ир╕бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Ар╕кр╕╡р╕вр╕Зр╕Юр╕╣р╕Фр╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щ ---
    const total = price + tip;
    const payText = payMethod === 'Cash' ? "р╣Ар╕Зр╕┤р╕Щр╕кр╕Ф" : (payMethod === 'Trans' ? "р╣Ар╕Зр╕┤р╕Щр╣Вр╕нр╕Щ" : "р╕вр╕нр╕Фр╕Ьр╕кр╕б");
    speak(`р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б ${payText} р╕вр╕нр╕Фр╕гр╕зр╕б ${total} р╕Ър╕▓р╕Ч р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в`);
    // ---------------------------------------

    if (typeof renderDay === 'function') renderDay(); 
    if (typeof loadAccountStatus === 'function') loadAccountStatus();

    // 6. Animation р╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░р╕кр╕│р╣Ар╕гр╣Зр╕И (Feedback UI)
    const btnSave = event.currentTarget || document.querySelector(".btn-main");
    if (btnSave) {
        const originalContent = btnSave.innerHTML;
        const originalBg = btnSave.style.background;
        
        btnSave.style.setProperty("background", "linear-gradient(135deg, #10b981, #059669)", "important");
        btnSave.innerHTML = `<i class="fas fa-check-circle" style="font-size:38px;"></i> <span style="font-size:32px; font-weight:900;">р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕кр╕│р╣Ар╕гр╣Зр╕И</span>`;
        
        setTimeout(() => {
            btnSave.style.background = originalBg;
            btnSave.innerHTML = originalContent;
        }, 1200);
    }

    // 7. р╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕Яр╕нр╕гр╣Мр╕бр╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕гр╕▒р╕Ър╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕Др╕Щр╕Цр╕▒р╕Фр╣Др╕Ы
    if ($("tStart") && endTime) {
        $("tStart").value = endTime;
    }
    const inputsToClear = ["priceInp", "tipInp", "mixCash", "mixTrans", "tEnd"];
    inputsToClear.forEach(id => { if($(id)) $(id).value = ""; });

    const selectsToReset = ["hairStyle", "extra1", "extra2"];
    selectsToReset.forEach(id => { if($(id)) $(id).selectedIndex = 0; });

    payMethod = ""; 
    const payButtons = ["btnCash", "btnTrans", "btnMix"];
    payButtons.forEach(id => { if($(id)) $(id).className = "icon-card"; });
    
    if($("mixPanel")) $("mixPanel").style.display = 'none';

    if ($("tEnd")) {$("tEnd").focus();
    }
}
function applyTheme(t) {
    // 1. р╕Ир╕▒р╕Фр╕Бр╕▓р╕г Class р╣Бр╕ер╕░р╕ер╕Ъ Style р╕Юр╕┤р╣Ар╕ир╕йр╣Ар╕Фр╕┤р╕бр╕нр╕нр╕Бр╕Бр╣Ир╕нр╕Щ
    document.body.className = t;
    const oldStyle = document.getElementById("navyStyle");
    if (oldStyle) oldStyle.remove();

    const s = document.documentElement.style;
    // 2. р╕Бр╕│р╕лр╕Щр╕Фр╕Др╣Ир╕▓р╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ (Default: Light Theme)
    // р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Др╕зр╣Йр╕Хр╕гр╕Зр╕Щр╕╡р╣Йр╕Ир╕░р╕Кр╣Ир╕зр╕вр╕ер╕Фр╕Бр╕▓р╕гр╣Ар╕Вр╕╡р╕вр╕Щр╕Лр╣Йр╕│р╣Гр╕Щ else
    let bodyBg = '#f3f4f6';
    s.setProperty('--card', '#ffffff');
    s.setProperty('--text', '#1a237e');
    s.setProperty('--modal-bg', '#f3f4f6');
    // 3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕Вр╕Шр╕╡р╕бр╕Хр╣Ир╕▓р╕Зр╣Ж
    if (t === 'dark') {
        // --- ЁЯМС р╕Шр╕╡р╕бр╕бр╕╖р╕Ф-р╕Чр╕нр╕З ---
        bodyBg = '#171717';
        s.setProperty('--card', '#262626');
        s.setProperty('--text', '#fbbf24');
        s.setProperty('--modal-bg', '#171717');
    } 
    else if (t === 'navy') {
        // --- ЁЯММ р╕Шр╕╡р╕бр╕Щр╣Йр╕│р╣Ар╕Зр╕┤р╕Щ ---
        bodyBg = '#1a237e';
        s.setProperty('--card', '#ffffff');
        s.setProperty('--text', '#1a237e');
        s.setProperty('--modal-bg', '#1a237e');
        // р╕кр╕гр╣Йр╕▓р╕З Style р╕Юр╕┤р╣Ар╕ир╕йр╣Ар╕Йр╕Юр╕▓р╕░р╕Шр╕╡р╕б Navy
        const st = document.createElement("style");
        st.id = "navyStyle";
        st.innerHTML = `
            body.navy { background: #1a237e !important; color: #ffffff !important; }
            .navy .card b, .navy .card span { color: #1e293b !important; }
            .navy #dTotal, .navy #accNet { color: #1a237e !important; }
            .navy .nav-item { color: #ffffff !important; opacity: 0.7; }
            .navy .nav-item.active { color: #facc15 !important; opacity: 1; font-weight: bold; }
        `;
        document.head.appendChild(st);
    }
    // 4. р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Юр╕╖р╣Йр╕Щр╕лр╕ер╕▒р╕Зр╕Вр╕нр╕З Body
    document.body.style.background = bodyBg;
}
/* ==========================================================
   SECTION 9: SYSTEM STARTUP & EVENT LISTENERS
   (р╕кр╕зр╕┤р╕Хр╕Кр╣Мр╣Ар╕Ыр╕┤р╕Фр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕З: р╕Бр╕▓р╕гр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╣Бр╕ер╕░р╕Фр╕▒р╕Бр╕Ир╕▒р╕Ър╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╕Ур╣М)
   ========================================================== */
// 1. р╕Фр╕▒р╕Бр╕Ир╕▒р╕Ър╕Бр╕▓р╕гр╕Др╕ер╕┤р╕Бр╕Юр╕╖р╣Йр╕Щр╕лр╕ер╕▒р╕Зр╣Ар╕Юр╕╖р╣Ир╕нр╕Ыр╕┤р╕Ф Modal (р╕Др╕Зр╣Ар╕Фр╕┤р╕бр╣Бр╕Хр╣Ир╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕зр╕▓р╕бр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в)
window.onclick = function(e) {
    const modals = [
        { id: "reportModal", close: typeof closeReportModal === "function" ? closeReportModal : null },
        { id: "historyModal", close: typeof closeHistoryModal === "function" ? closeHistoryModal : null },
        { id: "modalSet", close: typeof closeAndGoHome === "function" ? closeAndGoHome : null },
        { id: "configModal", close: typeof closeConfigModal === "function" ? closeConfigModal : null } 
    ]; 
    modals.forEach(m => {
        const modalEl = document.getElementById(m.id);
        if (modalEl && e.target === modalEl && m.close) m.close();
    });
};

// 2. р╕гр╕░р╕Ър╕Ъ Pull-to-Refresh (р╣Бр╕Бр╣Йр╣Др╕В: р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕гр╕╡р╣Ар╕Яр╕гр╕Кр╕Вр╕Ур╕░р╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕Фр╕╣р╕гр╕▓р╕вр╕Зр╕▓р╕Щ)
let touchStart = 0;
window.addEventListener('touchstart', (e) => {
    touchStart = e.targetTouches[0].pageY;
}, {passive: true});

window.addEventListener('touchmove', (e) => {
    let touchMove = e.targetTouches[0].pageY;
    let swipeDistance = touchMove - touchStart;
    // ЁЯЯв р╣Бр╕Бр╣Йр╣Др╕Вр╕Ир╕╕р╕Фр╕Щр╕╡р╣Й: 
    // 1. р╕Хр╣Йр╕нр╕Зр╕нр╕вр╕╣р╣Ир╕Ър╕Щр╕кр╕╕р╕Фр╕Вр╕нр╕Зр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕Ир╕гр╕┤р╕Зр╣Ж (window.scrollY === 0)
    // 2. р╕гр╕░р╕вр╕░р╕ер╕▓р╕Бр╕Хр╣Йр╕нр╕Зр╕вр╕▓р╕зр╕Вр╕╢р╣Йр╕Щ (р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Ир╕▓р╕Б 180 р╣Ар╕Ыр╣Зр╕Щ 250px) р╣Ар╕Юр╕╖р╣Ир╕нр╣Др╕бр╣Ир╣Гр╕лр╣Йр╕ер╕▒р╣Ир╕Щр╕Зр╣Ир╕▓р╕в
    // 3. р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Бр╕▓р╕гр╕гр╕╡р╣Ар╕Яр╕гр╕Кр╕Цр╣Йр╕▓р╕Бр╕│р╕ер╕▒р╕Зр╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕Фр╕╣р╕Хр╕▓р╕гр╕▓р╕Зр╕Чр╕╡р╣Ир╕бр╕╡р╕Бр╕▓р╕г Scroll р╕нр╕вр╕╣р╣И
    if (window.scrollY === 0 && swipeDistance > 250) {
        // р╣Ар╕Кр╣Зр╕Др╕зр╣Ир╕▓р╕Щр╕┤р╣Йр╕зр╣Др╕бр╣Ир╣Др╕Фр╣Йр╕Бр╕│р╕ер╕▒р╕Зр╕ер╕▓р╕Бр╕нр╕вр╕╣р╣Ир╕Ър╕Щ Element р╕Чр╕╡р╣Ир╣Ар╕ер╕╖р╣Ир╕нр╕Щр╣Др╕Фр╣Й (р╣Ар╕Кр╣Ир╕Щ р╕Хр╕▓р╕гр╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щ)
        if (e.target.closest('.scrollable-table') || e.target.closest('#reportModal')) {
            return; // р╕Цр╣Йр╕▓р╕ер╕▓р╕Бр╕Ър╕Щр╕Хр╕▓р╕гр╕▓р╕З р╣Гр╕лр╣Йр╕вр╕Бр╣Ар╕ер╕┤р╕Бр╕Бр╕▓р╕гр╕гр╕╡р╣Ар╕Яр╕гр╕К
        }
        
        document.body.style.opacity = "0.5";
        location.reload(); 
    }
}, {passive: true});

// 3. р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Чр╕▒р╕Щр╕Чр╕╡р╕Чр╕╡р╣Ир╣Вр╕лр╕ер╕Фр╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ър╣Ар╕кр╕гр╣Зр╕И (р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Ир╕│р╕Кр╕╖р╣Ир╕нр╕гр╣Йр╕▓р╕Щр╣Бр╕Ър╕Ър╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М)
window.addEventListener('load', () => {
    console.log("ЁЯЪА Barber App System Started...");

    // --- ЁЯЯв р╕кр╣Ир╕зр╕Щр╕Чр╕╡р╣Ир╣Бр╕Бр╣Йр╣Др╕В: р╣Вр╕лр╕ер╕Фр╕Кр╕╖р╣Ир╕нр╕гр╣Йр╕▓р╕Щр╕Ир╕▓р╕Бр╕Чр╕▒р╣Йр╕Зр╕кр╕нр╕Зр╣Бр╕лр╕ер╣Ир╕Зр╣Гр╕лр╣Йр╣Бр╕бр╣Ир╕Щр╕вр╕│ ---
    const savedName = localStorage.getItem("shopName") || "BARBER SHOP";
    
    // р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Чр╕╕р╕Бр╕Ир╕╕р╕Фр╕Чр╕╡р╣Ир╣Бр╕кр╕Фр╕Зр╕Кр╕╖р╣Ир╕нр╕гр╣Йр╕▓р╕Щ
    const shopElements = [
        document.querySelector('h2'), 
        document.getElementById("shopNameDisplay"),
        document.getElementById("shopNameDisp")
    ];
    
    shopElements.forEach(el => {
        if (el) el.innerText = savedName;
    });

    // --- р╕кр╣Ир╕зр╕Щр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕лр╕Щр╣Йр╕▓р╕Ир╕н (Modal) ---
    if (document.getElementById("modalSet")) document.getElementById("modalSet").style.display = "none";
    if (document.getElementById("reportModal")) document.getElementById("reportModal").style.display = "none";

    // --- р╕кр╣Ир╕зр╕Щр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ ---
    const today = new Date().toISOString().split('T')[0]; 
    ["dateInp", "accDate", "histDate"].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = today;
    });

    // тЬи р╕Ър╕▒р╕Зр╕Др╕▒р╕Ър╣Др╕Ыр╕лр╕Щр╣Йр╕▓р╕лр╕ер╕▒р╕Б (p1) р╣Бр╕ер╕░р╕Др╕╖р╕Щр╕Др╣Ир╕▓р╕Др╕зр╕▓р╕бр╣Гр╕кр╕лр╕Щр╣Йр╕▓р╕Ир╕н
    if (typeof go === 'function') go(1); 
    
    document.body.style.opacity = "1"; 
    document.body.style.overflow = "auto";

    // р╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕гр╕▓р╕вр╕Зр╕▓р╕Щр╣Бр╕ер╕░р╕Ър╕▒р╕Нр╕Кр╕╡
    if (typeof updateDateDisplay === 'function') updateDateDisplay(today);
    if (typeof loadAccountStatus === 'function') loadAccountStatus();

    console.log("тЪб р╕гр╕░р╕Ър╕Ър╕Юр╕гр╣Йр╕нр╕бр╕Чр╕│р╕Зр╕▓р╕Щ: р╕Кр╕╖р╣Ир╕нр╕гр╣Йр╕▓р╕Щр╕Др╕╖р╕н " + savedName);
});
 /* ==========================================================
   SECTION 10: KNOWLEDGE BASE & HAIR STYLE GUIDE
   (р╕кр╣Ир╕зр╕Щр╕Др╕ер╕▒р╕Зр╕Др╕зр╕▓р╕бр╕гр╕╣р╣Й р╣Ар╕Чр╕гр╕Щр╕Фр╣Мр╕Чр╕гр╕Зр╕Ьр╕бр╕Ыр╕╡ 2026 р╣Бр╕ер╕░р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕ер╕┤р╕Зр╕Бр╣Мр╕ар╕▓р╕вр╕Щр╕нр╕Б)
   ========================================================== */
// р╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕│р╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╣Ар╕Ыр╕┤р╕Ф (р╕Ыр╕гр╕░р╕Бр╕▓р╕ир╣Др╕зр╣Йр╕Щр╕нр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ)
let lastOpenedType = null;
function showHairExpert(type) {
    const display = $("hair-info-display");
    if (!display) return;
    // --- р╕гр╕░р╕Ър╕Ър╕Бр╕Фр╕Лр╣Йр╕│р╣Ар╕Юр╕╖р╣Ир╕нр╕Ыр╕┤р╕Ф (Toggle) ---
    if (lastOpenedType === type) {
        display.innerHTML = "";
        display.style.display = "none"; // р╕Лр╣Ир╕нр╕Щр╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣Ир╣Бр╕кр╕Фр╕Зр╕Ьр╕е
        lastOpenedType = null; // р╕ер╣Йр╕▓р╕Зр╕Др╣Ир╕▓р╕кр╕Цр╕▓р╕Щр╕░
        return;
    }
    // р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕е
    display.style.display = "block";
    lastOpenedType = type;
    let content = '';

    // р╕лр╕▒р╕зр╕Вр╣Йр╕нр╕Чр╕╡р╣И 1: р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Ар╕кр╣Йр╕Щр╕Ьр╕б (Source: All Things Beauty)
    if (type === 1) { 
        content = `
            <div style="animation: fadeIn 0.4s ease;">
                <h4 style="color:#1e3a8a; margin-bottom:10px; display:flex; align-items:center; gap:8px;">
                    <i class="fas fa-microscope" style="color:#fbbf24;"></i> р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Ар╕кр╣Йр╕Щр╕Ьр╕б (Texture)
                </h4>
                <p style="font-size:14px; color:#475569; line-height:1.5;">р╣Ар╕Ир╕▓р╕░р╕ер╕╢р╕Бр╕Др╕зр╕▓р╕бр╣Бр╕Хр╕Бр╕Хр╣Ир╕▓р╕Зр╕Вр╕нр╕Зр╕Ьр╕бр╣Ар╕кр╣Йр╕Щр╣Ар╕ер╣Зр╕Б р╣Ар╕кр╣Йр╕Щр╣Гр╕лр╕Нр╣И р╣Бр╕ер╕░р╕Ьр╕бр╕лр╕вр╕▒р╕Бр╕ир╕Б р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕Чр╕Др╕Щр╕┤р╕Др╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╣Гр╕лр╣Йр╣Ар╕лр╕бр╕▓р╕░р╕кр╕бр╕Чр╕╡р╣Ир╕кр╕╕р╕Ф</p>
                <a href="https://www.allthingsbeauty.com/th/mens-corner/hairstyle-men/men-haircut-names.html" target="_blank" 
                   style="display:inline-flex; align-items:center; justify-content:center; gap:8px; width:100%; height:55px; background:linear-gradient(135deg, #6366f1, #4338ca); color:#fff; border-radius:15px; text-decoration:none; font-weight:700; margin-top:12px; box-shadow:0 4px 12px rgba(99,102,241,0.3);">
                   <i class="fas fa-external-link-alt"></i> р╣Ар╕Ыр╕┤р╕Фр╕нр╣Ир╕▓р╕Щр╣Ар╕Щр╕╖р╣Йр╕нр╕лр╕▓р╣Бр╕Ър╕Ър╣Ар╕Хр╣Зр╕б
                </a>
            </div>`;
    } 
   // р╕лр╕▒р╕зр╕Вр╣Йр╕нр╕Чр╕╡р╣И 2: р╣Вр╕Др╕гр╕Зр╕лр╕Щр╣Йр╕▓р╕Бр╕▒р╕Ър╕Чр╕гр╕Зр╕Ьр╕б 
   else if (type === 2) { 
        content = `
            <div style="animation: fadeIn 0.4s ease; line-height: 1.5; color: #1e293b;">
                <h4 style="color:#1e3a8a; border-bottom:3px solid #3b82f6; padding-bottom:8px; margin-bottom:15px; text-align:center;">
                    <i class="fas fa-user-tag"></i> р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕гр╕╣р╕Ыр╕лр╕Щр╣Йр╕▓р╣Бр╕ер╕░р╕Чр╕гр╕Зр╕Ьр╕б
                </h4>
                
                <div style="background:#fff; border-radius:15px; padding:12px; margin-bottom:12px; box-shadow:0 2px 8px rgba(0,0,0,0.05); border:1px solid #fee2e2;">
                    <b style="color:#e11d48; font-size:16px;">ЁЯФ┤ р╕лр╕Щр╣Йр╕▓р╕Бр╕ер╕б (Round)</b><br>
                    <small style="color:#64748b;">р╕ер╕▒р╕Бр╕йр╕Ур╕░: р╣Бр╕Бр╣Йр╕бр╣Ар╕вр╕нр╕░ р╕Др╕зр╕▓р╕бр╕Бр╕зр╣Йр╕▓р╕Зр╣Бр╕ер╕░р╕вр╕▓р╕зр╕лр╕Щр╣Йр╕▓р╣Гр╕Бр╕ер╣Йр╣Ар╕Др╕╡р╕вр╕Зр╕Бр╕▒р╕Щ</small>
                    <div style="margin-top:8px; font-size:14px;">
                        <span style="color:#059669;">тЬЕ <b>р╕Чр╕гр╕Зр╕Чр╕╡р╣Ир╕Др╕зр╕гр╕Хр╕▒р╕Ф:</b></span> Undercut, High Fade, Pompadour р╕лр╕гр╕╖р╕н Quiff (р╣Ар╕Щр╣Йр╕Щр╕Ыр╕▒р╕Фр╣Ар╕кр╕вр╕лр╕гр╕╖р╕нр╕Хр╕▒р╣Йр╕Зр╕Вр╕╢р╣Йр╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕лр╕Щр╣Йр╕▓р╕Фр╕╣р╕вр╕▓р╕зр╕бр╕╡р╕бр╕┤р╕Хр╕┤) <br>
                        <span style="color:#dc2626;">тЭМ <b>р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Др╕зр╕гр╣Ар╕ер╕╡р╣Ир╕вр╕З:</b></span> р╕Чр╕гр╕Зр╕лр╕Щр╣Йр╕▓р╕бр╣Йр╕▓р╕Ыр╕┤р╕Фр╕лр╕Щр╣Йр╕▓р╕Ьр╕▓р╕Б р╕лр╕гр╕╖р╕нр╕Чр╕гр╕Зр╕Чр╕╡р╣Ир╣Др╕зр╣Йр╕вр╕▓р╕зр╕Фр╣Йр╕▓р╕Щр╕Вр╣Йр╕▓р╕Зр╕Юр╕нр╕Зр╣Ж р╣Ар╕Юр╕гр╕▓р╕░р╕Ир╕░р╕Чр╕│р╣Гр╕лр╣Йр╕лр╕Щр╣Йр╕▓р╕Фр╕╣р╕Ър╕▓р╕Щр╕Бр╕зр╣Ир╕▓р╣Ар╕Фр╕┤р╕б
                    </div>
                </div>

                <div style="background:#fff; border-radius:15px; padding:12px; margin-bottom:12px; box-shadow:0 2px 8px rgba(0,0,0,0.05); border:1px solid #e0f2fe;">
                    <b style="color:#0284c7; font-size:16px;">ЁЯЯж р╕лр╕Щр╣Йр╕▓р╣Ар╕лр╕ер╕╡р╣Ир╕вр╕б (Square)</b><br>
                    <small style="color:#64748b;">р╕ер╕▒р╕Бр╕йр╕Ур╕░: р╕Бр╕гр╕▓р╕бр╕Кр╕▒р╕Ф р╕лр╕Щр╣Йр╕▓р╕Ьр╕▓р╕Бр╕Бр╕зр╣Йр╕▓р╕Зр╕Фр╕╣р╣Бр╕Вр╣Зр╕Зр╣Бр╕гр╕З</small>
                    <div style="margin-top:8px; font-size:14px;">
                        <span style="color:#059669;">тЬЕ <b>р╕Чр╕гр╕Зр╕Чр╕╡р╣Ир╕Др╕зр╕гр╕Хр╕▒р╕Ф:</b></span> Buzz Cut, Crew Cut р╕лр╕гр╕╖р╕н Side Part (р╕Бр╕▓р╕гр╣Бр╕кр╕Бр╕Вр╣Йр╕▓р╕Зр╕Ир╕░р╕Кр╣Ир╕зр╕вр╕ер╕Фр╕Др╕зр╕▓р╕бр╣Ар╕лр╕ер╕╡р╣Ир╕вр╕бр╕Вр╕нр╕Зр╕лр╕Щр╣Йр╕▓) <br>
                        <span style="color:#dc2626;">тЭМ <b>р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Др╕зр╕гр╣Ар╕ер╕╡р╣Ир╕вр╕З:</b></span> р╕Чр╕гр╕Зр╕Чр╕╡р╣Ир╕Хр╕▒р╕Фр╕кр╕▒р╣Йр╕Щр╣Ар╕Бр╕гр╕╡р╕вр╕Щр╣Бр╕Ър╕Ър╣Др╕гр╣Йр╕бр╕┤р╕Хр╕┤ р╕лр╕гр╕╖р╕нр╣Бр╕кр╕Бр╕Бр╕ер╕▓р╕З р╣Ар╕Юр╕гр╕▓р╕░р╕Ир╕░р╣Ар╕Щр╣Йр╕Щр╕Бр╕гр╕▓р╕бр╣Гр╕лр╣Йр╕Фр╕╣р╕Кр╕▒р╕Фр╣Бр╕ер╕░р╣Бр╕Вр╣Зр╕Зр╣Ар╕Бр╕┤р╕Щр╣Др╕Ы
                    </div>
                </div>

                <div style="background:#fff; border-radius:15px; padding:12px; margin-bottom:12px; box-shadow:0 2px 8px rgba(0,0,0,0.05); border:1px solid #fef3c7;">
                    <b style="color:#d97706; font-size:16px;">ЁЯУР р╕лр╕Щр╣Йр╕▓р╕вр╕▓р╕з (Oblong/Long)</b><br>
                    <small style="color:#64748b;">р╕ер╕▒р╕Бр╕йр╕Ур╕░: р╕лр╕Щр╣Йр╕▓р╣Бр╕Др╕Ър╣Бр╕Хр╣Ир╕Кр╣Ир╕зр╕Зр╕Др╕▓р╕Зр╕лр╕гр╕╖р╕нр╕лр╕Щр╣Йр╕▓р╕Ьр╕▓р╕Бр╕вр╕▓р╕з</small>
                    <div style="margin-top:8px; font-size:14px;">
                        <span style="color:#059669;">тЬЕ <b>р╕Чр╕гр╕Зр╕Чр╕╡р╣Ир╕Др╕зр╕гр╕Хр╕▒р╕Ф:</b></span> French Crop, Side Swept р╕лр╕гр╕╖р╕нр╕Чр╕гр╕Зр╕Чр╕╡р╣Ир╕бр╕╡р╕лр╕Щр╣Йр╕▓р╕бр╣Йр╕▓ (р╕Кр╣Ир╕зр╕вр╕Ыр╕┤р╕Фр╕лр╕Щр╣Йр╕▓р╕Ьр╕▓р╕Бр╕ер╕Фр╕Др╕зр╕▓р╕бр╕вр╕▓р╕зр╕лр╕Щр╣Йр╕▓) <br>
                        <span style="color:#dc2626;">тЭМ <b>р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Др╕зр╕гр╣Ар╕ер╕╡р╣Ир╕вр╕З:</b></span> р╕Чр╕гр╕Зр╕Чр╕╡р╣Ир╣Др╕Цр╕Вр╣Йр╕▓р╕Зр╕кр╕╣р╕Зр╕бр╕▓р╕Бр╣Бр╕ер╕░р╣Ар╕Лр╕Хр╕Фр╣Йр╕▓р╕Щр╕Ър╕Щр╕Хр╕▒р╣Йр╕Зр╕кр╕╣р╕З (High Top) р╣Ар╕Юр╕гр╕▓р╕░р╕Ир╕░р╕Чр╕│р╣Гр╕лр╣Йр╕лр╕Щр╣Йр╕▓р╕Фр╕╣р╕вр╕▓р╕зр╕Ьр╕┤р╕Фр╕Ыр╕Бр╕Хр╕┤
                    </div>
                </div>

                <div style="background:#fff; border-radius:15px; padding:12px; margin-bottom:12px; box-shadow:0 2px 8px rgba(0,0,0,0.05); border:1px solid #dcfce7;">
                    <b style="color:#16a34a; font-size:16px;">ЁЯТО р╕лр╕Щр╣Йр╕▓р╕гр╕╣р╕Ыр╣Др╕Вр╣И (Oval)</b><br>
                    <small style="color:#64748b;">р╕ер╕▒р╕Бр╕йр╕Ур╕░: р╕кр╕бр╕Фр╕╕р╕ер╕Чр╕╡р╣Ир╕кр╕╕р╕Ф р╕кр╕▒р╕Фр╕кр╣Ир╕зр╕Щр╕гр╕▒р╕Ър╕Бр╕▒р╕Щр╕Чр╕╕р╕Бр╕кр╣Ир╕зр╕Щ</small>
                    <div style="margin-top:8px; font-size:14px;">
                        <span style="color:#059669;">тЬЕ <b>р╕Чр╕гр╕Зр╕Чр╕╡р╣Ир╕Др╕зр╕гр╕Хр╕▒р╕Ф:</b></span> р╕Хр╕▒р╕Фр╣Др╕Фр╣Йр╕Чр╕╕р╕Бр╕Чр╕гр╕З! р╣Бр╕Щр╕░р╕Щр╕│ Ivy League р╕лр╕гр╕╖р╕н Two Block (р╣Ар╕Щр╣Йр╕Щр╣Вр╕Кр╕зр╣Мр╣Гр╕Ър╕лр╕Щр╣Йр╕▓р╕Чр╕╡р╣Ир╕кр╕бр╕Фр╕╕р╕е) <br>
                        <span style="color:#dc2626;">тЭМ <b>р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Др╕зр╕гр╣Ар╕ер╕╡р╣Ир╕вр╕З:</b></span> р╕гр╕░р╕зр╕▒р╕Зр╣Бр╕Др╣Ир╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕лр╕Щр╣Йр╕▓р╕бр╣Йр╕▓р╕Чр╕╡р╣Ир╕лр╕Щр╕▓р╣Ар╕Бр╕┤р╕Щр╣Др╕Ыр╕Ир╕Щр╕Ыр╕┤р╕Фр╕Ър╕▒р╕Зр╣Гр╕Ър╕лр╕Щр╣Йр╕▓р╕Чр╕╡р╣Ир╣Др╕Фр╣Йр╕гр╕╣р╕Ыр╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з
                    </div>
                </div>

                <div style="background:#f1f5f9; padding:10px; border-radius:12px; border:1px dashed #64748b; font-size:13px; text-align:center;">
                    <b>ЁЯТб Barber Tip:</b> р╕лр╕▓р╕Бр╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕бр╕╡ "р╣Вр╕лр╕Щр╕Бр╣Бр╕Бр╣Йр╕бр╕кр╕╣р╕З" р╣Гр╕лр╣Йр╕Кр╣Ир╕▓р╕Зр╣Ар╕ер╕╡р╣Ир╕вр╕Зр╕Бр╕▓р╕гр╣Др╕Цр╕кр╕▒р╣Йр╕Щр╣Ар╕Бр╕гр╕╡р╕вр╕Щр╣Ар╕лр╕Щр╕╖р╕нр╣Гр╕Ър╕лр╕╣ р╣Ар╕Юр╕╖р╣Ир╕нр╣Др╕бр╣Ир╣Гр╕лр╣Йр╣Ар╕Щр╣Йр╕Щр╣Вр╕лр╕Щр╕Бр╣Бр╕Бр╣Йр╕бр╕Кр╕▒р╕Фр╣Ар╕Бр╕┤р╕Щр╣Др╕Ыр╕Др╕гр╕▒р╕Ъ
                </div>
            </div>`;
    }
    // р╕лр╕▒р╕зр╕Вр╣Йр╕нр╕Чр╕╡р╣И 3: р╕Чр╕гр╕Зр╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щ/р╣Бр╕Яр╕Кр╕▒р╣Ир╕Щ (Source: Hairtran Clinic)
    else if (type === 3) { 
        content = `
            <div style="animation: fadeIn 0.4s ease;">
                <h4 style="color:#1e3a8a; margin-bottom:10px; display:flex; align-items:center; gap:8px;">
                    <i class="fas fa-cut" style="color:#a5b4fc;"></i> р╣Ар╕Чр╕гр╕Щр╕Фр╣Мр╕Чр╕гр╕Зр╕Ьр╕бр╕вр╕нр╕Фр╕ор╕┤р╕Х 2026
                </h4>
                <p style="font-size:14px; color:#475569; line-height:1.5;">р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Чр╕гр╕З Ivy League, Broccoli Cut р╣Бр╕ер╕░ Modern Mullet р╕Юр╕гр╣Йр╕нр╕бр╣Бр╕Др╕Хр╕Хр╕▓р╕ер╣Зр╕нр╕Бр╕ар╕▓р╕Юр╕Ыр╕гр╕░р╕Бр╕нр╕Ър╕Ир╕▓р╕Бр╕Ьр╕╣р╣Йр╣Ар╕Кр╕╡р╣Ир╕вр╕зр╕Кр╕▓р╕Н</p>
                <a href="https://hairtranclinic.com/knowledge/mens-popular-hairstyles-2026/" target="_blank" 
                   style="display:inline-flex; align-items:center; justify-content:center; gap:8px; width:100%; height:55px; background:linear-gradient(135deg, #f59e0b, #d97706); color:#fff; border-radius:15px; text-decoration:none; font-weight:700; margin-top:12px; box-shadow:0 4px 12px rgba(245,158,11,0.3);">
                   <i class="fas fa-images"></i> р╕Фр╕╣р╣Бр╕Др╕Хр╕Хр╕▓р╕ер╣Зр╕нр╕Бр╕Чр╕гр╕Зр╕Ьр╕б 2026
                </a>
            </div>`;
    }
    // р╕лр╕▒р╕зр╕Вр╣Йр╕нр╕Чр╕╡р╣И 4: р╕Бр╕▓р╕гр╣Ар╕Лр╕Х/р╕Ир╕▒р╕Фр╕Чр╕гр╕З (Source: All Things Beauty)
    else if (type === 4) { 
        content = `
            <div style="animation: fadeIn 0.4s ease;">
                <h4 style="color:#1e3a8a; margin-bottom:10px; display:flex; align-items:center; gap:8px;">
                    <i class="fas fa-pump-soap" style="color:#6ee7b7;"></i> р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╣Ар╕Лр╕Хр╣Бр╕ер╕░р╕Фр╕╣р╣Бр╕ер╕Ьр╕бр╕Кр╕▓р╕в
                </h4>
                <p style="font-size:14px; color:#475569; line-height:1.5;">р╕гр╕зр╕бр╕Кр╕╖р╣Ир╕нр╕Чр╕гр╕Зр╕Ьр╕бр╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щр╣Бр╕ер╕░р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╣Ар╕Лр╕Хр╕Ьр╕бр╣Гр╕лр╣Йр╣Ар╕Ыр╣Кр╕░р╣Ар╕лр╕бр╕╖р╕нр╕Щр╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕гр╣Йр╕▓р╕Щ р╕Юр╕гр╣Йр╕нр╕бр╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Бр╕Ьр╕ер╕┤р╕Хр╕ар╕▒р╕Ур╕Ср╣Мр╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З</p>
                <a href="https://www.allthingsbeauty.com/th/mens-corner/hairstyle-men/men-haircut-names.html" target="_blank" 
                   style="display:inline-flex; align-items:center; justify-content:center; gap:8px; width:100%; height:55px; background:linear-gradient(135deg, #1e293b, #334155); color:#fff; border-radius:15px; text-decoration:none; font-weight:700; margin-top:12px; box-shadow:0 4px 12px rgba(30,41,59,0.3);">
                   <i class="fas fa-magic"></i> р╣Ар╕гр╕╡р╕вр╕Щр╕гр╕╣р╣Йр╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╣Ар╕Лр╕Хр╕Ьр╕б
                </a>
            </div>`;
    }

    display.innerHTML = content;
}
 </script>
            </body>
            </html>
