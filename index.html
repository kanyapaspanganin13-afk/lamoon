 <!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro v.3</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
    :root { 
        --primary: #6366f1; --accent: #0ea5e9; --danger: #ef4444; --success: #22c55e; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #e2e8f0;
    }
    * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 90px; overflow-x: hidden; }
    .container { padding: 15px 15px 100px 15px !important; max-width: 500px; margin: auto; position: relative; z-index: 1; }
    .nav-bar {
        position: fixed !important; bottom: 0 !important; left: 0 !important; right: 0 !important;
        height: 75px !important; background: white !important; display: flex !important; 
        justify-content: space-around !important; align-items: center !important; 
        z-index: 99999 !important; 
        border-top: 1px solid #eee;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }
    .nav-item {
        flex: 1 !important; display: flex !important; flex-direction: column !important;
        align-items: center !important; justify-content: center !important; cursor: pointer !important;
        pointer-events: auto !important;
    }
nav {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: #1a237e !important; /* ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏õ‡πä‡∏∞‡πÜ */
    display: flex; justify-content: space-around; padding: 12px 0;
    box-shadow: 0 -10px 30px rgba(0,0,0,0.4); /* ‡πÉ‡∏™‡πà‡πÄ‡∏á‡∏≤‡πÉ‡∏´‡πâ‡∏ö‡∏≤‡∏£‡πå‡∏•‡∏≠‡∏¢‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
    z-index: 9999; border-top: 1px solid rgba(255,255,255,0.1);
}
.nav-item { text-align: center; color: rgba(255,255,255,0.5); flex: 1; transition: 0.2s; }
.nav-item.active { color: #ffffff !important; opacity: 1; } /* ‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∞‡∏Ç‡∏≤‡∏ß‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏à‡πâ‡∏≤ */
.nav-item i { font-size: 22px; display: block; margin-bottom: 2px; }
.nav-item span { font-size: 11px; font-weight: 700; }
    body.navy { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --accent: #38bdf8; }
     body.dark { --bg: #121212; --card: #1a1a1a; --text: #fbbf24; --accent: #fbbf24; }
     body { background-color: var(--bg); color: var(--text); transition: all 0.3s ease; }
    .icon-card, input, select { background: var(--card); color: var(--text); border: 1px solid rgba(255,255,255,0.1); }
    .grid-3 {display: grid !important; grid-template-columns: repeat(3, 1fr) !important; gap: 6px; margin-bottom: 8px;}
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 8px; }
    .icon-card { position: relative; border-radius: 15px; padding: 10px 2px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: none !important; background: #fff; height: 75px !important; font-size: 14px !important; }
    input, select { width: 100%; height: 75px !important; border-radius: 20px !important; font-size: 20px !important; font-weight: 700; text-align: center; border: none !important; outline: none !important; background: #f1f5f9; appearance: none; -webkit-appearance: none; box-shadow: 0 4px 10px rgba(0,0,0,0.03); color: #1e293b; }
    .btn { border: none; padding: 12px; border-radius: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: 700; transition: 0.2s; }
    .btn-pay { background: #e2e8f0; color: #64748b; border:2px solid transparent; height: 70px; font-size: 18px;}
    .btn-pay.active-cash { background: #dcfce7; color: #15803d; border-color: #22c55e; }
    .btn-pay.active-trans { background: #e0f2fe; color: #0369a1; border-color: #0ea5e9; }
   
    .page { display: none; } 
    .page.active { display: block; }
    .modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.85); display: none; z-index: 100000; align-items: center; justify-content: center; }
    .modal-content { background: #fff; width: 90%; max-width: 400px; border-radius: 25px; padding: 25px; max-height: 85vh; overflow-y: auto; }
    .status-bar { padding: 12px; border-radius: 12px; text-align: center; font-weight: 800; font-size: 14px; margin-bottom: 10px; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
    .acc-main-card { background: white; padding: 20px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid #fffbeb; }
    .btn-save { background: var(--success); color: white; border: none; width: 100%; padding: 15px; border-radius: 15px; font-weight: 700; font-size: 16px; cursor: pointer; }
    #accHistory { font-size: 12px; max-height: 150px; overflow-y: auto; }
</style>
</head>
<body>
<div class="container" style="max-width: 500px; margin: 0 auto; font-family: 'Kanit', sans-serif;">
    
    <div id="p1" class="page active" style="padding: 15px; background: #f8fafc;">
        <h2 id="shopNameDisp" style="text-align:center; color:#1e293b; font-weight:900; margin: 10px 0 20px 0; letter-spacing: 1px; text-transform: uppercase;">BARBER SHOP</h2>
        
        <div class="grid-3" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px;">
            <div id="btnInsurance" class="icon-card" style="background:#fff; border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center; box-shadow:0 8px 15px rgba(0,0,0,0.05); cursor:pointer;">
                <div style="background:linear-gradient(135deg, #fbbf24, #f59e0b); width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff; font-size:18px;">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <span style="color:#1e293b; font-weight:800; font-size:11px;">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</span>
            </div>
            
            <div id="btnHoliday" class="icon-card" style="background:#fff; border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center; box-shadow:0 8px 15px rgba(0,0,0,0.05); cursor:pointer;">
                <div style="background:linear-gradient(135deg, #f87171, #ef4444); width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff; font-size:18px;">
                    <i class="fas fa-umbrella-beach"></i>
                </div>
                <span style="color:#1e293b; font-weight:800; font-size:11px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span>
            </div>

            <div id="btnSettings" class="icon-card" style="background:#fff; border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center; box-shadow:0 8px 15px rgba(0,0,0,0.05); cursor:pointer;">
                <div style="background:linear-gradient(135deg, #94a3b8, #475569); width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff; font-size:18px;">
                    <i class="fas fa-cog"></i>
                </div>
                <span style="color:#1e293b; font-weight:800; font-size:11px;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</span>
            </div>
        </div>

        <div class="grid-3" style="display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap:10px; margin-bottom:15px;">
            <div style="background:#fff; border-radius:18px; height:60px; position:relative; display:flex; align-items:center; justify-content:center; box-shadow: 0 4px 10px rgba(0,0,0,0.03); overflow: hidden;">
                <span id="dateDisplay" style="font-weight:800; color:#475569; font-size:14px;">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
                <input type="date" id="dateInp" style="position:absolute; opacity:0; width:100%; height:100%; cursor:pointer; z-index:2;">
            </div>
            <input type="time" id="tStart" style="height:60px; border-radius:18px; border:none; text-align:center; font-weight:700; background:#fff; color:#1e293b; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
            <input type="time" id="tEnd" style="height:60px; border-radius:18px; border:none; text-align:center; font-weight:700; background:#fff; color:#1e293b; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
        </div>

        <div style="display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 8px; margin-bottom: 15px;">
            <select id="hairStyle" style="height: 70px; border-radius:18px; border:none; font-weight:800; padding:0 10px; background:#fff; color:#1e293b; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
                <option value="">‚úÇÔ∏è ‡∏ó‡∏£‡∏á‡∏ú‡∏°</option>
                <option value="‡πÄ‡∏î‡πá‡∏Å">‡∏ï‡∏±‡∏î‡∏ú‡∏°‡πÄ‡∏î‡πá‡∏Å</option>
                <option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option><option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option><option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option><option>‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á</option>
                <option>‡∏ï‡∏≥‡∏£‡∏ß‡∏à/‡∏ó‡∏´‡∏≤‡∏£</option><option>‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option><option>‡πÅ‡∏Å‡πâ‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option>
            </select>
            <select id="extra1" style="height: 70px; border-radius:14px; border:none; font-weight:700; background:#fff; color:#64748b; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
                <option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£1</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option>
            </select>
            <select id="extra2" style="height: 70px; border-radius:14px; border:none; font-weight:700; background:#fff; color:#64748b; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
                <option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£2</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option>
            </select>
        </div>

        <div style="display: grid; grid-template-columns: 1.4fr 1fr; gap: 8px; margin: 10px 0;">
            <div style="position: relative; background: #ffffff; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.05);">
                <span style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); font-size: 24px; color: #6366f1; font-weight: 900;">‡∏ø</span>
                <input type="number" id="priceInp" placeholder="0" inputmode="numeric" style="width: 100%; height: 85px; background: transparent; font-size: 45px; font-weight: 900; color: #1e293b; padding-left: 45px; border: none; outline: none;">
            </div>
            <input type="number" id="tipInp" placeholder="‡∏ó‡∏¥‡∏õ" inputmode="numeric" style="width: 100%; height: 85px; background: #ccfbf1; border-radius: 20px; font-size: 32px; font-weight: 900; color: #0f766e; border: none; outline: none; text-align: center;">
        </div>

        <div class="grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:20px;">
            <button id="btnCash" style="height:75px; border-radius:22px; border:none; background:linear-gradient(135deg, #10b981, #059669); color:#fff; font-weight:900; font-size:22px; box-shadow:0 8px 20px rgba(16,185,129,0.3); display:flex; align-items:center; justify-content:center; gap:10px; cursor:pointer;">
                <i class="fas fa-money-bill-wave"></i> ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
            </button>
            <button id="btnTrans" style="height:75px; border-radius:22px; border:none; background:linear-gradient(135deg, #6366f1, #4338ca); color:#fff; font-weight:900; font-size:22px; box-shadow:0 8px 20px rgba(99,102,241,0.3); display:flex; align-items:center; justify-content:center; gap:10px; cursor:pointer;">
                <i class="fas fa-qrcode"></i> ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢
            </button>
        </div>

        <button id="btnSave" style="width:100%; height:90px; border-radius:28px; background:linear-gradient(135deg, #4338ca, #3730a3); color:#fff; border:none; box-shadow:0 15px 35px rgba(67,56,202,0.4); display:flex; align-items:center; justify-content:center; gap:15px; cursor:pointer;">
            <i class="fas fa-save" style="font-size: 38px;"></i>
            <span style="font-size: 32px; font-weight: 900; letter-spacing:1px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
        </button>
    </div>

    <div id="p2" class="page" style="display:none; padding: 15px; padding-bottom: 100px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;">
            <div style="background: white; padding:18px 15px; border-radius:20px; text-align:center; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;">
                <small style="font-weight:800; color:#64748b; text-transform: uppercase;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</small>
                <div id="dTotal" style="font-size:36px; font-weight:900; color:#4338ca; margin: 5px 0;">0</div>
                <div id="dCounts" style="font-size:13px; font-weight:700; color:#1e293b; background:#e0e7ff; display:inline-block; padding:2px 10px; border-radius:10px;">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ 0 ‡∏Ñ‡∏ô</div>
            </div>
            <div style="background:white; padding:15px; border-radius:20px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; display:flex; flex-direction:column; justify-content:center; gap:8px;">
                <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:700;"><span style="color:#0ea5e9;">üì± ‡πÇ‡∏≠‡∏ô:</span> <b id="dTrans">0</b></div>
                <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:700;"><span style="color:#f59e0b;">üíµ ‡∏™‡∏î:</span> <b id="dCash">0</b></div>
                <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:700;"><span style="color:#6366f1;">ü§µ ‡∏ä‡πà‡∏≤‡∏á:</span> <b id="dBarber">0</b></div>
                <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:800;"><span style="color:#64748b;">üè† ‡∏£‡πâ‡∏≤‡∏ô:</span> <b id="dShop">0</b></div>
            </div>
        </div>
        <div id="dailyList"></div>
    </div>

    <div id="p3" class="page" style="display:none; padding: 12px; padding-bottom: 100px; background: #f8fafc;">
        <div class="card" style="background:#fff; border-radius:25px; padding:20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); margin-bottom: 15px;">
            <div style="text-align:center; margin-bottom:20px;">
                <div id="accStatus" style="font-size:12px; font-weight:700; color:#64748b; margin-bottom:5px;">‚úÖ ‡∏¢‡∏≠‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</div>
                <div style="font-size:48px; font-weight:900; color:#1a237e; letter-spacing:-1px;">‡∏ø<span id="accNet">0</span></div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button id="btnConfirmClear" style="background:linear-gradient(135deg, #10b981, #059669); color:#fff; border:none; border-radius:18px; padding:15px 5px; font-size:14px; font-weight:800; cursor:pointer;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô</button>
                <button id="btnHistoryClear" style="background:#fff; color:#3b82f6; border:2px solid #3b82f6; border-radius:18px; padding:15px 5px; font-size:14px; font-weight:800; cursor:pointer;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</button>
            </div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
            <div id="wrapHistDate" style="background:linear-gradient(135deg, #f59e0b, #d97706); border-radius:25px; padding:20px 10px; text-align:center; color:#fff; position:relative; cursor:pointer;">
                <i class="fas fa-search-dollar" style="font-size:24px; margin-bottom:5px; display:block;"></i>
                <b style="font-size:13px;">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</b>
                <input type="date" id="histDate" style="position:absolute; inset:0; opacity:0; cursor:pointer;">
            </div>
            <div id="wrapHistMonth" style="background:linear-gradient(135deg, #6366f1, #4338ca); border-radius:25px; padding:20px 10px; text-align:center; color:#fff; position:relative; cursor:pointer;">
                <i class="fas fa-calendar-check" style="font-size:24px; margin-bottom:5px; display:block;"></i>
                <b style="font-size:13px;">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</b>
                <input type="month" id="histMonth" style="position:absolute; inset:0; opacity:0; cursor:pointer;">
            </div>
        </div>
    </div>
</div>
<div id="modalSet" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); backdrop-filter:blur(10px); z-index:9999; align-items:flex-end; justify-content:center;">
    <div style="background:#ffffff; width:92%; max-width:400px; border-radius:35px 35px 0 0; padding:25px; box-shadow:0 -10px 40px rgba(0,0,0,0.2);">
        <h3 style="margin:0 0 20px; font-size:20px; color:#1a237e; font-weight:800; text-align:center;">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
        
        <label style="font-size:12px; font-weight:700; color:#64748b;">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label>
        <input type="text" id="setShop" style="width:100%; height:50px; border-radius:15px; border:1px solid #e2e8f0; margin-bottom:12px; text-align:center; font-weight:700;">

        <div style="margin-bottom:15px;">
            <label style="font-size:12px; font-weight:700; color:#64748b;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏µ‡∏°</label>
            <select id="setTheme" style="width:100%; height:50px; border-radius:15px; border:1px solid #e2e8f0; padding:0 10px;">
                <option value="light">üå§ ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á (‡∏õ‡∏Å‡∏ï‡∏¥)</option>
                <option value="dark">üåë ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô (‡∏ñ‡∏ô‡∏≠‡∏°‡∏™‡∏≤‡∏¢‡∏ï‡∏≤)</option>
                <option value="navy">üåå ‡πÇ‡∏´‡∏°‡∏î‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏°</option>
            </select>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px;">
            <div>
                <label style="font-size:12px; font-weight:700; color:#64748b;">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á</label>
                <select id="setSound" style="width:100%; height:50px; border-radius:15px; border:1px solid #e2e8f0;">
                    <option value="on">üîä ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</option>
                    <option value="off">üîá ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</option>
                </select>
            </div>
            <div>
                <label style="font-size:12px; font-weight:700; color:#64748b;">‡πÄ‡∏û‡∏®‡πÄ‡∏™‡∏µ‡∏¢‡∏á</label>
                <select id="setVoice" style="width:100%; height:50px; border-radius:15px; border:1px solid #e2e8f0;">
                    <option value="female">üë© ‡∏´‡∏ç‡∏¥‡∏á</option>
                    <option value="male">üë® ‡∏ä‡∏≤‡∏¢</option>
                </select>
            </div>
        </div>

      <div style="display: grid; grid-template-columns: 2.5fr 1fr; gap: 12px; margin-top: 25px;">
            <button id="btnSaveSet" style="height:65px; border-radius:22px; background:#1e3a8a; color:#fff; border:none; font-weight:800; font-size:18px; cursor:pointer; box-shadow: 0 4px 12px rgba(30,58,138,0.2);">
                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>
            <button id="btnCloseSet" style="height:65px; border-radius:22px; background:#fff5f5; color:#e11d48; border:none; font-size:28px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div style="margin-top: 25px; border-top: 1px dashed #fca5a5; padding-top: 15px; text-align: center;">
            <button id="btnClearAll" style="background:none; border:none; color:#fca5a5; font-size:14px; font-weight:700; text-decoration:underline; cursor:pointer; padding: 10px;">
                <i class="fas fa-exclamation-triangle"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
        </div>
    </div> </div>

<nav style="position:fixed; bottom:0; width:100%; max-width:500px; background:#fff; display:flex; justify-content:space-around; padding:12px 0; border-top:1px solid #eee; z-index:100;">
    <div id="nav1" class="nav-item active" style="text-align:center; cursor:pointer;"><i class="fas fa-edit"></i><br><span style="font-size:12px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span></div>
    <div id="nav2" class="nav-item" style="text-align:center; cursor:pointer;"><i class="fas fa-history"></i><br><span style="font-size:12px;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span></div>
    <div id="nav3" class="nav-item" style="text-align:center; cursor:pointer;"><i class="fas fa-wallet"></i><br><span style="font-size:12px;">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</span></div>
</nav>
 
 <script>
 // [1] ‡∏ß‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô $ ‡πÑ‡∏ß‡πâ‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
function $(id) {
    const el = document.getElementById(id);
    if (!el) console.warn("‡∏´‡∏≤‡πÑ‡∏≠‡∏î‡∏µ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏à‡πâ‡∏≤‡πÄ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πà: " + id);
    return el;
}
// [2] ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å $)
let db = JSON.parse(localStorage.getItem("barber_db")) || [];
let archives = JSON.parse(localStorage.getItem("barber_archives")) || [];
let conf = JSON.parse(localStorage.getItem("barber_conf")) || { perc: 50 };
let account = JSON.parse(localStorage.getItem("barber_account")) || { balance: 0, logs: [] };
let payMethod = ""; 
function saveAll() {
    localStorage.setItem("barber_db", JSON.stringify(db));
    localStorage.setItem("barber_archives", JSON.stringify(archives));
    localStorage.setItem("barber_conf", JSON.stringify(conf));
    localStorage.setItem("barber_account", JSON.stringify(account));
}
function closeDay() {
    if (db.length === 0) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡πÇ‡∏ß‡πâ‡∏¢!");
    if (!confirm("‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (Archives) ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")) return;
    archives.push({
        closedDate: $("dateInp").value,
        data: [...db],
        summary: db.reduce((sum, r) => sum + r.price, 0)
    });
    db = []; // ‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏ß‡πà‡∏≤‡∏á 0 ‡πÅ‡∏ñ‡∏ß
    saveAll(); // ‡πÄ‡∏ã‡∏ü‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
    renderDay(); // ‡∏ß‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏´‡∏°‡πà (‡∏à‡∏∞‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤)
    alert("‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏•‡∏∑‡πà‡∏ô‡∏õ‡∏£‡∏µ‡πä‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πà!");
}
window.onload = () => {
    const today = new Date().toISOString().split('T')[0];
    if($("dateInp")) $("dateInp").value = today;
    if($("accDate")) $("accDate").value = today;
    if($("histDate")) $("histDate").value = today;
    if($("shopNameDisp")) $("shopNameDisp").innerText = conf.shop;
    
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    if (typeof renderDay === "function") renderDay();
};
    function addMinutes(time, mins) {
    if (!time) return "";
    const [h, m] = time.split(":").map(Number);
    const d = new Date();
    d.setHours(h, m + mins, 0, 0);
    return d.toTimeString().slice(0, 5);
}
  function handleSave() {
    // 1. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ (parseInt ‡∏Å‡∏±‡∏ô‡∏û‡∏±‡∏á ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÄ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏õ‡∏ô)
    const p = parseInt($("priceInp")?.value || 0);
    const t = parseInt($("tipInp")?.value || 0);

    // 2. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏∏‡∏î‡∏ï‡∏≤‡∏¢ (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠ payMethod ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á)
    if (!p) return alert("‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏ß‡πâ‡∏¢!");
    if (!payMethod) return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î' ‡∏´‡∏£‡∏∑‡∏≠ '‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢' ‡∏Å‡πà‡∏≠‡∏ô!");
    const start = $("tStart")?.value || new Date().toTimeString().slice(0, 5);
    const rec = {
        id: Date.now(),
        date: $("dateInp")?.value,
        time: start,
        endTime: $("tEnd")?.value || addMinutes(start, 30),
        svcs: [$("hairStyle")?.value, $("extra1")?.value, $("extra2")?.value].filter(Boolean),
        hair: $("hairStyle")?.value,
        price: p,
        tip: t,
        pay: payMethod,
        type: "SERVICE"
    };
    db.push(rec);
    saveAll(); 
    if (typeof renderDay === "function") {
        renderDay();
    }
    ["priceInp", "tipInp", "tStart", "tEnd"].forEach(id => {
        if($(id)) $(id).value = "";
    });
    payMethod = "";
    if($("btnCash")) $("btnCash").style.border = "none";
    if($("btnTrans")) $("btnTrans").style.border = "none";
    
    alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
}
  function handleInsurance() {
    const d = $("dateInp").value || new Date().toISOString().split('T')[0], g = parseInt(conf.guar) || 0;
    const speak = (t) => { const m = new SpeechSynthesisUtterance(t); m.lang = 'th-TH'; window.speechSynthesis.speak(m); };
    if (g <= 0) return (speak("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô"), alert("‚ö†Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏≠‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÉ‡∏ô '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö' ‡∏Å‡πà‡∏≠‡∏ô"));
    if (db.find(r => r.date === d && r.type === "GUARANTEE_CLAIM")) return (speak("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞"), alert("üõ°Ô∏è ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß"));
    if (confirm(`üõ°Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö '‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ'?`)) {
        db.push({ id: Date.now(), date: d, time: "00:00", svcs: ["üõ°Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô"], price: 0, pay: "N/A", type: "GUARANTEE_CLAIM" });
        saveDB(); speak(`‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô ${g} ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`); alert("‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); renderDay();
    }
}

function handleHoliday(){const d=$("dateInp").value;if(!d)return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô");if(confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${d} ‡πÄ‡∏õ‡πá‡∏ô "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"?`)){db.push({id:Date.now(),date:d,time:"00:00",svcs:["üèñÔ∏è ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"],price:0,pay:"N/A",type:"HOLIDAY"});saveDB();const m=new SpeechSynthesisUtterance("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");m.lang='th-TH';if(conf.voice==='male'){const v=window.speechSynthesis.getVoices().find(x=>x.name.includes('Male')||x.name.includes('Google'));if(v)m.voice=v}window.speechSynthesis.speak(m);alert("üèñÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");renderDay()}}   
function applyTheme(t){document.body.className=t;const o=document.getElementById("navyStyle");if(o)o.remove();const s=document.documentElement.style;if(t==='dark'){s.setProperty('--card','#262626');s.setProperty('--text','#fbbf24');document.body.style.background='#171717'}else{s.setProperty('--card','#fff');s.setProperty('--text','#1a237e');document.body.style.background=(t==='navy')?'#1a237e':''}if(t==='navy'){const st=document.createElement("style");st.id="navyStyle";st.innerHTML=`body.navy{background:#1a237e!important;color:#fff!important}.navy .card b,.navy .card span,.navy div[style*="background:white"] b{color:#1e293b!important}.navy #dTotal,.navy #accNet{color:#1a237e!important}.nav-item{color:#fff!important;opacity:0.8}.nav-item.active{color:#8b5cf6!important;opacity:1}`;document.head.appendChild(st)}}
function openSettings(){const m=document.getElementById("modalSet");if(m)m.style.display='flex';document.getElementById("setShop").value=conf.shop||'';document.getElementById("setTheme").value=conf.theme||'light';document.getElementById("setVoice").value=conf.voice||'female';document.getElementById("setSound").value=conf.sound||'on';document.getElementById("setPerc").value=conf.perc||50;document.getElementById("setGuar").value=conf.guar||0}
function saveSettings(){try{conf={...conf,shop:document.getElementById("setShop").value,perc:parseInt(document.getElementById("setPerc").value)||0,guar:parseInt(document.getElementById("setGuar").value)||0,theme:document.getElementById("setTheme").value,voice:document.getElementById("setVoice").value,sound:document.getElementById("setSound").value};localStorage.setItem("barber_conf",JSON.stringify(conf));applyTheme(conf.theme);if(document.getElementById("shopNameDisp"))document.getElementById("shopNameDisp").innerText=conf.shop;alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");closeAndGoHome();if(typeof renderDay==='function')renderDay()}catch(e){alert("‚ùå ‡∏û‡∏±‡∏á‡πÄ‡∏û‡∏£‡∏≤‡∏∞:"+e.message)}}
function closeAndGoHome(){const m=document.getElementById("modalSet");if(m)m.style.display='none';if(typeof go==='function')go(1);else location.reload()}
function speak(t){if(conf.sound==='off')return;window.speechSynthesis.cancel();const m=new SpeechSynthesisUtterance(t);m.lang='th-TH';m.pitch=(conf.voice==='male')?0.8:1.1;window.speechSynthesis.speak(m)}
function clearAllData(){if(confirm("üí£ ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")){localStorage.clear();location.reload()}}
function updateDateDisplay(v){if(!v)return;const d=new Date(v);const el=$("dateDisplay");if(el)el.innerText=d.toLocaleDateString('th-TH',{day:'numeric',month:'short',year:'2-digit'});if(typeof renderDay==="function")renderDay()}
window.addEventListener('DOMContentLoaded',()=>{const i=$("dateInp"),t=new Date().toISOString().split('T')[0];if(i){i.value=t;updateDateDisplay(t)}});
  
  function selectPay(m) {
        payMethod = m;
        $("btnCash").className = `btn btn-pay ${m === 'Cash' ? 'active-cash' : ''}`;
        $("btnTrans").className = `btn btn-pay ${m === 'Trans' ? 'active-trans' : ''}`;
    }
function renderDay() {
    const dInp = $("dateInp").value, 
          allRec = db.filter(r => r.date === dInp),
          today = allRec.filter(r => r.type !== 'HOLIDAY'), // üëà ‡∏Å‡∏£‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
          isHoliday = allRec.some(r => r.type === 'HOLIDAY'), // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡πÑ‡∏´‡∏°
          stats = {};
    let tot = 0, trans = 0, cash = 0, tips = 0, listHtml = "";

    today.slice().sort((a,b) => a.time.localeCompare(b.time)).forEach((r, i) => {
        const p = Number(r.price)||0, t = Number(r.tip)||0; tot += p; tips += t;
        (r.pay === 'Trans') ? trans += (p + t) : cash += p;
        const c = new Set(["‡∏ï‡∏±‡∏î‡∏ú‡∏°"]); if (r.hair && r.hair.includes("‡πÄ‡∏î‡πá‡∏Å")) c.add("‡πÄ‡∏î‡πá‡∏Å");
        (r.svcs || []).forEach(s => { if (s && !["‡πÄ‡∏î‡πá‡∏Å","‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á","‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô","‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô","‡∏ï‡∏±‡∏î‡∏ú‡∏°"].some(x => s.includes(x))) c.add(s); });
        c.forEach(k => stats[k] = (stats[k] || 0) + 1);
        const timeShow = r.endTime ? `${r.time}-${r.endTime}` : r.time;
        listHtml += `<div class="history-row" style="padding:15px; border-bottom:1px solid #f1f5f9; background:#fff;"><div style="display:flex; justify-content:space-between; align-items:center;"><div style="display:flex; flex-direction:column;"><span style="font-weight:800; font-size:14px; color:#1e293b;">${i+1}. [${timeShow}] | ${(r.svcs||[]).join('+')}</span>${t?`<small style="color:#be185d; font-weight:700; font-size:11px;">üîπ ‡∏ó‡∏¥‡∏õ: ‡∏ø${t}</small>`:''}</div><div style="text-align:right;"><b style="font-size:16px; display:block;">‡∏ø${p}${t?` <span style="color:#be185d;">(+${t})</span>`:''}</b><span style="font-size:12px; font-weight:700;">${r.pay==='Trans'?'üì± ‡πÇ‡∏≠‡∏ô':'üíµ ‡∏™‡∏î'} <i class="fas fa-trash-alt" style="color:#ef4444; cursor:pointer; margin-left:8px;" onclick="delRec(${r.id})"></i></span></div></div></div>`;
    });
    const bEarn = isHoliday ? 0 : Math.max(tot * (conf.perc / 100), conf.guar) + tips;
    const sEarn = isHoliday ? 0 : tot - (bEarn - tips);
    const settle = isHoliday ? 0 : cash - bEarn;

    $("dTotal").innerText = tot.toLocaleString(); $("dTrans").innerText = trans.toLocaleString(); $("dCash").innerText = cash.toLocaleString();
    $("dBarber").innerText = Math.floor(bEarn).toLocaleString(); $("dShop").innerText = Math.floor(sEarn).toLocaleString(); 
    $("dCounts").innerText = isHoliday ? "üè™ ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î" : `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${today.length} ‡∏Ñ‡∏ô`;

    let sH = `<div style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center; margin-bottom:10px;">`;
    ["‡∏ï‡∏±‡∏î‡∏ú‡∏°", "‡πÄ‡∏î‡πá‡∏Å"].forEach(k => { if (stats[k]) sH += `<span style="background:#4338ca;color:#fff;padding:5px 12px;border-radius:8px;font-size:11px;font-weight:800;">${k}: ${stats[k]}</span>`; });
    for (let s in stats) { if (!["‡∏ï‡∏±‡∏î‡∏ú‡∏°", "‡πÄ‡∏î‡πá‡∏Å"].includes(s)) sH += `<span style="background:#64748b;color:#fff;padding:5px 12px;border-radius:8px;font-size:11px;font-weight:800;">${s}: ${stats[s]}</span>`; }
    $("dServiceStats").innerHTML = sH + `</div>`;

    // --- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î ---
    let txt = "", bg = ""; 
    if (isHoliday) { txt = "üèñÔ∏è ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"; bg = "#f1f5f9"; }
    else if (tot === 0) { txt = "üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô"; bg = "#e0f2fe"; } 
    else if (settle > 0) { txt = `üü• ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${Math.floor(Math.abs(settle)).toLocaleString()}`; bg = "#fee2e2"; } 
    else if (settle < 0) { txt = `üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.floor(Math.abs(settle)).toLocaleString()}`; bg = "#e0e7ff"; } 
    else { txt = "‚úÖ ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ"; bg = "#dcfce7"; }

    $("dailyList").innerHTML = `<div style="display:flex; justify-content:space-between; align-items:center; margin:10px 0; padding:0 5px;"><b style="font-size:16px;">üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</b><i class="fab fa-line" style="color:#22c55e;font-size:32px;cursor:pointer" onclick="shareLine()"></i></div>` + (isHoliday ? `<div style="text-align:center; padding:40px; color:#64748b; font-weight:800;">üèñÔ∏è ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡πâ‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£) <i class="fas fa-trash-alt" style="color:#ef4444; cursor:pointer; margin-left:8px;" onclick="delRec(${allRec.find(x=>x.type==='HOLIDAY')?.id})"></i></div>` : (listHtml || "<center style='padding:40px; opacity:0.3;'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>"));
    
    const container = $("settleBar").parentElement; container.style.cssText = "display:flex; gap:10px; margin-top:10px;";
    container.innerHTML = `<div id="settleBar" style="flex:8; height:55px; background:${bg}; display:flex; align-items:center; justify-content:center; border-radius:15px; font-weight:900; font-size:15px; color:#1e293b; border:1px solid rgba(0,0,0,0.05);">${txt}</div><button onclick="saveAndGo('${dInp}', ${tot}, ${sEarn}, ${bEarn})" style="flex:2; height:55px; background:#f97316; color:#fff; border-radius:15px; border:none; font-size:22px; cursor:pointer; display:flex; align-items:center; justify-content:center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"><i class="fas fa-paper-plane"></i></button>`;
}
function saveAndGo(date, total, shop, barber) {
    if (total === 0 && !confirm("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≠‡∏î ‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏¢‡∏°‡∏±‡πâ‡∏¢?")) return;
    let s = {}; db.filter(r => r.date === date).forEach(r => { 
        r.svcs.forEach(v => s[v] = (s[v]||0)+1); if(r.hair) s["‡∏ó‡∏£‡∏á:"+r.hair] = (s["‡∏ó‡∏£‡∏á:"+r.hair]||0)+1; 
    });
    const entry = { date, total, barber, shop: total-barber, count: db.filter(r => r.date === date).length, stats: s };
    const i = archives.findIndex(a => a.date === date); (i > -1) ? archives[i] = entry : archives.push(entry);
    save(); alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!"); go(3);
}
  function updateAccountFromOrange() {
            const barberShareStr = document.getElementById('dBarber').innerText || "0";
            const barberShare = parseInt(barberShareStr.replace(/,/g, '')) || 0;
            const oldBalance = parseInt(localStorage.getItem('barber_old_balance') || "0");

            if (document.getElementById('accTodayVal')) {
                document.getElementById('accTodayVal').innerText = "‡∏ø" + barberShare.toLocaleString();
            }
            if (document.getElementById('accOldVal')) {
                document.getElementById('accOldVal').innerText = "‡∏ø" + oldBalance.toLocaleString();
            }
            if (document.getElementById('accNet')) {
                document.getElementById('accNet').innerText = (barberShare + oldBalance).toLocaleString();
            }
        }  
  function toggleAccHistory() {
        const w = $("accHistoryWrapper");
        w.style.display = w.style.display === "none" ? "block" : "none";
        $("accHistory").innerHTML = account.logs.map(l => `<div style="padding:5px; border-bottom:1px solid #eee;">${l.date}: ‡∏ø${l.amount} (${l.note})</div>`).join('') || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥";
    }
 function loadAccountStatus() {
    // 1. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° ‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß)
    const settle = parseFloat(($('dSettle')?.innerText || "0").replace(/[^0-9.-]/g, '')) || 0;
    
    // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (‡∏¢‡∏≠‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á + ‡∏¢‡∏≠‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)
    const bal = account.balance || 0;
    const net = bal + settle;
    
    // 3. ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢ (‡∏ß/‡∏î/‡∏õ‡∏µ‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î)
    const dInp = $("dateInp")?.value;
    const d = dInp ? new Date(dInp) : new Date();
    const dThai = `${d.getDate()}/${d.getMonth()+1}/${(d.getFullYear()+543).toString().slice(-2)}`;

    // 4. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡πÉ‡∏™‡πà‡∏Ñ‡∏≠‡∏°‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°)
    if($("accOldVal")) $("accOldVal").innerText = `‡∏ø${bal.toLocaleString()}`;
    if($("accTodayVal")) $("accTodayVal").innerText = `‡∏ø${settle.toLocaleString()}`;
    if($("accNet")) $("accNet").innerText = `‡∏ø${Math.abs(net).toLocaleString()}`;

    // 5. ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏ä‡∏∞‡∏ï‡∏≤ (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏ü‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)
    let txt = "‚úÖ ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ‡πÄ‡∏õ‡πä‡∏∞", light = "#16a34a"; // ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
    
    if (net > 0) { 
        txt = `üö© ${dThai}: ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${Math.abs(net).toLocaleString()}`; 
        light = "#dc2626"; // ‡∏™‡∏µ‡πÅ‡∏î‡∏á
    } else if (net < 0) { 
        txt = `üö© ${dThai}: ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.abs(net).toLocaleString()}`; 
        light = "#1e3a8a"; // ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô/‡∏Å‡∏£‡∏°‡∏ó‡πà‡∏≤
    }

    // 6. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
    if($("accStatus")) $("accStatus").innerText = txt;
    if($("accLight")) {
        $("accLight").style.background = light;
        $("accLight").style.boxShadow = `0 0 10px ${light}`; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏á‡∏ü‡∏∏‡πâ‡∏á‡πÜ ‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏î‡∏π‡πÅ‡∏û‡∏á
    }
}

function clearAccount() {
    const d = $("accDate").value;
    // ‡∏î‡∏∂‡∏á‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡∏•‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏≠‡∏°‡∏°‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏≠‡∏≠‡∏Å)
    const settleValue = parseFloat(($('dSettle')?.innerText || "0").replace(/[^0-9.-]/g, '')) || 0;
    
    if (!d) return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πà!");
    if (settleValue === 0) return alert("‡∏¢‡∏≠‡∏î‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏à‡∏∞‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ó‡∏≥‡πÑ‡∏°‡πÇ‡∏ß‡πâ‡∏¢!");

    // 1. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Log (‡πÄ‡∏Å‡πá‡∏ö‡∏¢‡∏≠‡∏î‡∏™‡∏∞‡∏™‡∏°‡πÄ‡∏î‡∏¥‡∏° + ‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ)
    account.logs.unshift({ 
        date: d, 
        amount: settleValue, // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÑ‡∏õ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà
        note: $("accNote").value || "‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô" 
    });

    // 2. ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î‡∏•‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô 0)
    // ‡∏õ‡∏Å‡∏ï‡∏¥‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ balance ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏Å‡∏•‡∏ö‡∏Å‡∏±‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
    account.balance = 0; 

    // 3. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
    if (typeof saveAll === "function") {
        saveAll();
    } else {
        localStorage.setItem("barber_account", JSON.stringify(account));
    }

    // 4. ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î
    if (typeof speak === "function") speak("‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
    
    $("accNote").value = ""; 
    if (typeof loadAccountHistory === "function") loadAccountHistory(); 
    if (typeof loadAccountStatus === "function") loadAccountStatus();
    
    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô ‡∏ø" + settleValue.toLocaleString() + " ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
}
function renderHistoryList() {
    const db = JSON.parse(localStorage.getItem("barber_acc_logs") || "[]");
    $("accHistoryList").innerHTML = db.length ? db.map(h => `
        <div style="background:#f8fafc; padding:12px; border-radius:15px; margin-bottom:10px; border:1px solid #e2e8f0;">
            <div style="display:flex; justify-content:space-between; font-weight:700;">
                <span>üìÖ ${h.date}</span><span style="color:#10b981;">‡∏ø${h.amount.toLocaleString()}</span>
            </div>
            <div style="font-size:11px; color:#64748b; margin-top:5px;">üìù ${h.note}</div>
        </div>`).join('') : "<p style='text-align:center; color:#94a3b8;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</p>";
}
function loadHistDaily() {
    const d = $("histDate").value;
    const found = archives.find(a => a.date === d);
    const area = $("histDailyArea"); 
    if(!found) { area.innerHTML = "<center style='color:#ccc; padding:40px;'>‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</center>"; return; }

    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ñ‡∏ß‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏î‡∏∂‡∏á‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ 2)
    let rows = (found.data || found.details || []).map(r => `
        <div class="history-row" style="font-size:13px; padding:10px 0; border-bottom:1px solid #f1f5f9;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b style="color:#1e293b;">${r.time} | ${r.svcs.join('+')}</b> 
                <b style="color:var(--primary);">‡∏ø${r.price}</b>
            </div>
            <div style="font-size:11px; font-weight:600; color:#64748b; margin-top:4px;">
                ${r.hair || '-'} 
                <span style="float:right; opacity:0.8;">
                    ${r.tip > 0 ? `üéÅ ‡∏ó‡∏¥‡∏õ: ‡∏ø${r.tip} | ` : ''} ${r.pay==='Cash'?'üíµ ‡∏™‡∏î':'üì± ‡πÇ‡∏≠‡∏ô'}
                </span>
            </div>
        </div>`).join('');

    const settle = found.settle || 0;
    const settleText = settle > 0 ? `üî¥ ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô: ‡∏ø${Math.floor(settle)}` : settle < 0 ? `üîµ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á: ‡∏ø${Math.floor(Math.abs(settle))}` : "üü¢ ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ‡πÄ‡∏õ‡πä‡∏∞";
    const settleClass = settle > 0 ? "status-red" : settle < 0 ? "status-indigo" : "status-green";

    area.innerHTML = `
    <div style="background:#fff; padding:15px; border-radius:20px; border:1px solid #e2e8f0; margin-top:10px;">
        <div class="status-bar ${settleClass}" style="padding:10px; font-size:14px; border-radius:12px; font-weight:900; text-align:center; margin-bottom:10px;">
            ${settleText}
        </div>
        
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:15px; font-size:12px;">
            <div style="background:#f8fafc; padding:8px; border-radius:8px;">‡∏¢‡∏≠‡∏î‡∏ï‡∏±‡∏î: <b>${found.total.toLocaleString()}</b></div>
            <div style="background:#f8fafc; padding:8px; border-radius:8px;">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î: <b>${(found.cash || 0).toLocaleString()}</b></div>
            <div style="background:#f0fdf4; padding:8px; border-radius:8px; color:#166534;">‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ: <b>${Math.floor(found.barber).toLocaleString()}</b></div>
            <div style="background:#eff6ff; padding:8px; border-radius:8px; color:#1e40af;">‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ: <b>${Math.floor(found.total - found.barber).toLocaleString()}</b></div>
        </div>

        <div style="border-top:2px dashed #f1f5f9; padding-top:10px;">${rows}</div>
    </div>`;
}
  function loadHistMonth() {
    const m = $("histMonth").value; 
    const area = $("histMonthArea"); 
    if(!m) return;
    
    const filtered = archives.filter(a => a.date.startsWith(m));
    if(!filtered.length) { area.innerHTML = "<center style='color:#ccc; padding:40px;'>üåë ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>"; return; }

    let mTotal = 0, mBarber = 0, mCount = 0, mCash = 0, mTrans = 0, mTip = 0, mStats = {};

    filtered.forEach(a => { 
        mTotal += a.total; 
        mBarber += a.barber; 
        mCash += (a.cash || 0);
        mTrans += (a.total - (a.cash || 0));
        // ‡πÄ‡∏à‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏ó‡∏¥‡∏õ‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ö‡∏Ñ‡∏ô
        const dayData = a.data || a.details || [];
        mCount += dayData.length;
        dayData.forEach(r => {
            mTip += (r.tip || 0);
            if(r.svcs) r.svcs.forEach(s => mStats[s] = (mStats[s] || 0) + 1);
        });
    });

    let sB = "", hB = "";
    for(let s in mStats) { 
        let tag = `<span class="badge" style="background:${s.startsWith("‡∏ó‡∏£‡∏á:")?"#10b981":"#6366f1"}; color:white; padding:4px 8px; border-radius:6px; margin:2px; font-size:10px; display:inline-block;">${s.replace("‡∏ó‡∏£‡∏á:","")}: ${mStats[s]}</span>`;
        if(s.startsWith("‡∏ó‡∏£‡∏á:")) hB += tag; else sB += tag;
    }

    area.innerHTML = `
    <div style="padding:15px; background:#fff; border-radius:20px; border:1px solid #e2e8f0;">
        <div style="text-align:center; margin-bottom:15px; padding:15px; background:var(--input-bg); border-radius:15px;">
            <div style="font-size:11px; opacity:0.6;">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${m}</div>
            <div style="font-size:28px; font-weight:900;">‡∏ø${mTotal.toLocaleString()}</div>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px; font-size:12px;">
            <div style="background:#f0fdf4; padding:10px; border-radius:10px;">‡∏ä‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏°: <b>‡∏ø${Math.floor(mBarber).toLocaleString()}</b></div>
            <div style="background:#fffbeb; padding:10px; border-radius:10px;">‡∏ó‡∏¥‡∏õ‡∏£‡∏ß‡∏°: <b>‡∏ø${mTip.toLocaleString()}</b></div>
            <div style="background:#f8fafc; padding:10px; border-radius:10px;">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î: <b>‡∏ø${mCash.toLocaleString()}</b></div>
            <div style="background:#f8fafc; padding:10px; border-radius:10px;">‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô: <b>‡∏ø${mTrans.toLocaleString()}</b></div>
        </div>

        <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:15px; padding:10px; background:var(--input-bg); border-radius:10px;">
            <span>üë• ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: <b>${mCount} ‡∏Ñ‡∏ô</b></span>
            <span>üìÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: <b>${filtered.length} ‡∏ß‡∏±‡∏ô</b></span>
        </div>

        <div style="font-size:11px; border-top:1px dashed #ccc; padding-top:10px;">
            <b>üìä ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£:</b> ${sB || '-'}<br>
            <b style="display:block; margin-top:5px;">üíá ‡∏ó‡∏£‡∏á‡∏ú‡∏°:</b> ${hB || '-'}
        </div>
    </div>`;
}
  function shareLine() {
    const dInp = $("dateInp").value, today = db.filter(r => r.date === dInp); if (!today.length) return;
    const dp = dInp.split('-'), fDate = `${dp[2]}/${dp[1]}/${dp[0]}`;
    let tot=0, cash=0, trans=0, tips=0, stats={};
    let clientList = today.sort((a,b)=>a.time.localeCompare(b.time)).map((r,i)=>{
        const p = Number(r.price)||0, t = Number(r.tip)||0; tot+=p; tips+=t;
        r.pay==='Trans' ? trans+=p : cash+=p;
        if(r.hair&&r.hair.includes("‡πÄ‡∏î‡πá‡∏Å")) stats["‡πÄ‡∏î‡πá‡∏Å"]=(stats["‡πÄ‡∏î‡πá‡∏Å"]||0)+1;
        (r.svcs||[]).forEach(s=>{ if(s) stats[s]=(stats[s]||0)+1; });
        const tShow = r.endTime ? `${r.time}-${r.endTime}` : r.time;
        return `${i+1}. [${tShow}] ${(r.svcs||[]).join('+')} = ${p}${t?` (+‡∏ó‡∏¥‡∏õ ${t})`:''} ${r.pay==='Trans'?'üì±':'üíµ'}`;
    }).join('\n');
    const allowed = ["‡πÄ‡∏î‡πá‡∏Å","‡∏™‡∏£‡∏∞‡∏ú‡∏°","‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î","‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°","‡∏¢‡πâ‡∏≠‡∏°‡∏™‡∏µ"], icons = {"‡πÄ‡∏î‡πá‡∏Å":"üßí","‡∏™‡∏£‡∏∞":"üßº","‡πÇ‡∏Å‡∏ô":"ü™í","‡∏¢‡πâ‡∏≠‡∏°":"üé®"};
    let statText = Object.entries(stats).filter(([k])=>allowed.some(a=>k.includes(a))).map(([k,v])=>`${icons[Object.keys(icons).find(i=>k.includes(i))]||'üîπ'} ${k}: ${v}`).join('\n');
    let bEarn = Math.max(tot*(conf.perc/100), conf.guar) + tips; // ‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ = ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ö‡πà‡∏á + ‡∏ó‡∏¥‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    let settle = cash - bEarn, settleMsg = settle > 0 ? `‚ö†Ô∏è ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ${Math.floor(Math.abs(settle))}` : `üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ${Math.floor(Math.abs(settle))}`;
    let msg = `üíà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô: Barber Shop\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${fDate}\n-------------------------\nüìù ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (${today.length} ‡∏Ñ‡∏ô):\n${clientList}\n-------------------------\nüìä ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô:\n${statText}\n-------------------------\nüí∞ ‡∏¢‡∏≠‡∏î: ${tot} | üßß ‡∏ó‡∏¥‡∏õ: ${tips}\nüì± ‡πÇ‡∏≠‡∏ô: ${trans} | üíµ ‡∏™‡∏î: ${cash}\nü§µ ‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ: ${Math.floor(bEarn)}\nüè† ‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ: ${Math.floor(tot-(bEarn-tips))}\n-------------------------\n${settleMsg}`;
    window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
}
 function go(p) {
    document.querySelectorAll('.page').forEach(pg => {
        pg.classList.remove('active');
        pg.style.display = 'none'; 
    });
    const targetPage = document.getElementById('p' + p);
    if (targetPage) {
        targetPage.classList.add('active');
        targetPage.style.display = 'block';
    }
    document.querySelectorAll('.nav-item').forEach((btn, i) => {
        btn.classList.toggle('active', (i + 1) === p);
    });
}
    function delRec(id) { if (confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) { db = db.filter(r => r.id !== id); saveDB(); renderDay(); } }
    function editTime(id) {const rec = db.find(r => r.id === id);if (!rec) return;const newStart = prompt("‡πÅ‡∏Å‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° (HH:MM)", rec.time);if (!newStart) return;const newEnd = prompt("‡πÅ‡∏Å‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à (HH:MM)", rec.endTime || "");rec.time = newStart;rec.endTime = newEnd || addMinutes(newStart, 30);saveDB();renderDay();}
    function openHistoryModal() { $("historyModal").style.display = "block"; renderHistoryList(); }
    function closeHistoryModal() { $("historyModal").style.display = "none"; }
// --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏à‡∏¥‡πâ‡∏°‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏¥‡∏î‡πÄ‡∏≠‡∏á (‡∏£‡∏ß‡∏°‡∏°‡∏¥‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á 2 ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á) ---
window.onclick = function(e) {
   
    const historyModal = document.getElementById('historyModal');
    if (historyModal && e.target == historyModal) closeHistoryModal();
   
    const modalSet = document.getElementById('modalSet');
    if (modalSet && e.target == modalSet) modalSet.style.display = 'none';
};

// --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ ---
window.addEventListener('load', () => {
    // 1. ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    const n = new Date();
    const t = n.getHours().toString().padStart(2, '0') + ':' + n.getMinutes().toString().padStart(2, '0');
    if(document.getElementById('tStart')) document.getElementById('tStart').value = t;
    if(document.getElementById('tEnd')) document.getElementById('tEnd').value = t;

    // 2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î/‡∏™‡πÅ‡∏Å‡∏ô)
    if (document.getElementById('btnCash')) {
        document.getElementById('btnCash').addEventListener('click', () => selectPay('Cash'));
    }
    if (document.getElementById('btnTrans')) {
        document.getElementById('btnTrans').addEventListener('click', () => selectPay('Trans'));
    }

    // 3. ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
    if (document.getElementById('btnSave')) {
        document.getElementById('btnSave').addEventListener('click', (event) => {
            event.preventDefault();
            handleSave();
        });
    }

    // 4. ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (Close)
    if (document.getElementById('btnCloseSet')) {
        document.getElementById('btnCloseSet').onclick = () => {
            document.getElementById('modalSet').style.display = 'none';
        };
    }

    // 5. ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (Clear)
    if (document.getElementById('btnClearAll')) {
        document.getElementById('btnClearAll').onclick = () => {
            if (confirm("‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏•‡∏¢‡∏ô‡∏∞‡πÄ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πà? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢‡πÄ‡∏Å‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ô‡∏∞!")) {
                localStorage.clear();
                location.reload();
            }
        };
    }

    // 6. ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ò‡∏µ‡∏°/‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô (Save Settings)
    if (document.getElementById('btnSaveSet')) {
        document.getElementById('btnSaveSet').onclick = () => {
            const theme = document.getElementById('setTheme').value;
            document.body.className = theme; 
            document.getElementById('modalSet').style.display = 'none';
            if (typeof speak === 'function') speak("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡πà‡∏∞");
        };
    }
});
 </script>
</body>
</html>
