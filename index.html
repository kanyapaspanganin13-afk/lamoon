<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro v.12.13</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
        :root { --bg-color: #f8fafc; --card-bg: #ffffff; --primary: #1e1b4b; --accent: #4338ca; --cash: #10b981; --trans: #6366f1; }
        body { background-color: var(--bg-color); font-family: 'Kanit', sans-serif; margin: 0; padding-bottom: 120px; overflow-x: hidden; }
        .container { max-width: 480px; margin: 0 auto; padding: 0 15px; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* UI Styling */
        header { display: flex; justify-content: center; padding: 25px 0; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .icon-card { background: #fff; border-radius: 20px; height: 90px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 8px 15px rgba(0,0,0,0.05); cursor: pointer; }
        .icon-card i { font-size: 18px; color: #fff; width: 35px; height: 35px; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 5px; }
        .input-box { background:#fff; border-radius:18px; height:60px; border:none; text-align:center; font-weight:700; box-shadow:0 4px 10px rgba(0,0,0,0.03); width:100%; outline:none; }
        
        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #1e1b4b; height: 85px; display: grid; grid-template-columns: 1fr 1fr 1fr; align-items: center; border-radius: 25px 25px 0 0; z-index: 1000; }
        .nav-btn { color: #94a3b8; text-align: center; text-decoration: none; font-size: 12px; font-weight: 700; display: flex; flex-direction: column; align-items: center; }
        .nav-btn.active { color: white; }
        .nav-btn i { font-size: 22px; margin-bottom: 4px; }
    </style>
<body id="mainBody">
   <div class="container" style="max-width: 480px; margin: 0 auto; padding-bottom: 120px;"> 
    
    <header style="display: flex; justify-content: center; align-items: center; padding: 25px 15px;">
        <h1 id="shopNameDisp" style="margin:0; font-size:24px; font-weight:900; color:#1e1b4b; letter-spacing:1px; text-transform:uppercase;">
            BARBER SHOP
        </h1>
    </header>

    <div id="p1" class="page active" style="padding: 0 15px;">
        <div class="grid-3" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px;">
            <div class="icon-card" onclick="handleInsurance()" style="background:#fff; border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center; box-shadow:0 8px 15px rgba(0,0,0,0.05);">
                <div style="background:linear-gradient(135deg, #fbbf24, #f59e0b); width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff;"><i class="fas fa-shield-alt"></i></div>
                <span style="font-size:11px; font-weight:800; color:#1e293b;">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</span>
            </div>
            <div class="icon-card" onclick="handleHoliday()" style="background:#fff; border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center; box-shadow:0 8px 15px rgba(0,0,0,0.05);">
                <div style="background:linear-gradient(135deg, #f87171, #ef4444); width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff;"><i class="fas fa-umbrella-beach"></i></div>
                <span style="font-size:11px; font-weight:800; color:#1e293b;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span>
            </div>
            <div class="icon-card" onclick="openSettings()" style="background:#fff; border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center; box-shadow:0 8px 15px rgba(0,0,0,0.05);">
                <div style="background:linear-gradient(135deg, #94a3b8, #475569); width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff;"><i class="fas fa-tools"></i></div>
                <span style="font-size:11px; font-weight:800; color:#1e293b;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</span>
            </div>
        </div>

        <div class="grid-3" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px;"> 
            <div style="background:#fff; border-radius:18px; height:60px; position:relative; display:flex; align-items:center; justify-content:center; box-shadow:0 4px 10px rgba(0,0,0,0.03); overflow:hidden;">
                <span id="dateShow" style="font-weight:700; color:#475569; font-size:13px;">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
                <input type="date" id="dateInp" onchange="document.getElementById('dateShow').innerText = this.value" 
                       style="position:absolute; opacity:0; inset:0; cursor:pointer; width:100%; height:100%;">
            </div>
            <input type="tel" id="tStart" placeholder="üïí ‡πÄ‡∏£‡∏¥‡πà‡∏°" maxlength="4" 
                   style="height:60px; border-radius:18px; border:none; text-align:center; font-weight:700; background:#fff; box-shadow:0 4px 10px rgba(0,0,0,0.03); outline:none; font-family: 'Kanit', sans-serif; font-size:14px; color:#475569;">
            <input type="tel" id="tEnd" placeholder="üèÅ ‡πÄ‡∏™‡∏£‡πá‡∏à" maxlength="4" 
                   style="height:60px; border-radius:18px; border:none; text-align:center; font-weight:700; background:#fff; box-shadow:0 4px 10px rgba(0,0,0,0.03); outline:none; font-family: 'Kanit', sans-serif; font-size:14px; color:#475569;">
        </div>

        <div style="display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 8px; margin-bottom: 15px;">
            <select id="hairStyle" style="height: 70px; border-radius:18px; border:none; font-weight:800; padding:0 10px; background:#fff; color:#1e293b; box-shadow: 0 4px 10px rgba(0,0,0,0.03); outline:none;">
                <option value="">‚úÇÔ∏è ‡∏ó‡∏£‡∏á‡∏ú‡∏°</option>
                <option value="‡πÄ‡∏î‡πá‡∏Å">‡∏ï‡∏±‡∏î‡∏ú‡∏°‡πÄ‡∏î‡πá‡∏Å</option>
                <option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option><option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option><option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option><option>‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á</option><option>‡∏ï‡∏≥‡∏£‡∏ß‡∏à/‡∏ó‡∏´‡∏≤‡∏£</option><option>‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                <option>‡πÅ‡∏Å‡πâ‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option>
            </select>
            <select id="extra1" style="height: 70px; border-radius:14px; border:none; font-weight:700; background:#fff; color:#64748b; box-shadow: 0 4px 10px rgba(0,0,0,0.03); outline:none;">
                <option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£1</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option>
            </select>
            <select id="extra2" style="height: 70px; border-radius:14px; border:none; font-weight:700; background:#fff; color:#64748b; box-shadow: 0 4px 10px rgba(0,0,0,0.03); outline:none;">
                <option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£2</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option>
            </select>
        </div>

        <div style="display: grid; grid-template-columns: 1.4fr 1fr; gap: 8px; margin: 10px 0;">
            <div style="position: relative; background: #ffffff; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.05);">
                <span style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); font-size: 24px; color: #6366f1; font-weight: 900;">‡∏ø</span>
                <input type="number" id="priceInp" placeholder="0" inputmode="numeric" 
                    style="width: 100%; height: 85px; background: transparent; font-size: 45px; font-weight: 900; color: #1e293b; text-align: right; padding-right: 20px; border: none; outline: none; box-sizing: border-box;">
            </div>
            <input type="number" id="tipInp" placeholder="‡∏ó‡∏¥‡∏õ" inputmode="numeric" 
                style="width: 100%; height: 85px; background: #ccfbf1; border-radius: 20px; font-size: 32px; font-weight: 900; color: #0f766e; text-align: center; border: none; outline: none;">
        </div>

        <div class="grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:20px;">
            <button id="btnCash" onclick="selectPay('Cash')" style="height:75px; border-radius:22px; border:none; background:linear-gradient(135deg, #10b981, #059669); color:#fff; font-weight:900; font-size:22px; box-shadow:0 8px 20px rgba(16,185,129,0.3); cursor:pointer; display:flex; align-items:center; justify-content:center; gap:10px;">
                <i class="fas fa-money-bill-wave"></i> ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
            </button>
            <button id="btnTrans" onclick="selectPay('Trans')" style="height:75px; border-radius:22px; border:none; background:linear-gradient(135deg, #6366f1, #4338ca); color:#fff; font-weight:900; font-size:22px; box-shadow:0 8px 20px rgba(99,102,241,0.3); cursor:pointer; display:flex; align-items:center; justify-content:center; gap:10px;">
                <i class="fas fa-qrcode"></i> ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢
            </button>
        </div>

        <button class="btn-main" onclick="handleSave(event)" style="width:100%; height:90px; border-radius:28px; background:linear-gradient(135deg, #4338ca, #3730a3); color:#fff; border:none; cursor:pointer; box-shadow:0 15px 35px rgba(67,56,202,0.4); display:flex; align-items:center; justify-content:center; gap:15px;">
            <i class="fas fa-save" style="font-size: 38px;"></i>
            <span style="font-size: 32px; font-weight: 900; letter-spacing:1px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
        </button>
    </div> 
</div>
<div id="p2" class="page" style="max-width:480px; margin:0 auto; padding: 15px; padding-bottom: 100px;">
        <div style="background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); padding:25px 20px; border-radius:28px; color:white; box-shadow:0 15px 30px rgba(30,58,138,0.25); margin-bottom: 20px; position:relative; overflow:hidden;">
            <div style="position:absolute; right:-20px; top:-20px; width:100px; height:100px; background:rgba(255,255,255,0.1); border-radius:50%;"></div>
            
            <small style="font-weight:600; opacity:0.8; text-transform: uppercase; letter-spacing:1px;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</small>
            <div style="display:flex; align-items:baseline; gap:5px; margin: 8px 0;">
                <span style="font-size:24px; font-weight:700;">‡∏ø</span>
                <div id="dTotal" style="font-size:45px; font-weight:900; line-height:1;">0</div>
            </div>
            <div id="dCounts" style="font-size:14px; font-weight:600; background:rgba(255,255,255,0.2); display:inline-block; padding:4px 15px; border-radius:12px; backdrop-filter:blur(5px);">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ 0 ‡∏Ñ‡∏ô</div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
            <div style="background:white; padding:15px; border-radius:22px; box-shadow:0 8px 20px rgba(0,0,0,0.04); border: 1px solid #f1f5f9;">
                <div style="display:flex; justify-content:space-between; margin-bottom:8px; font-size:13px; font-weight:700; color:#64748b;"><span>üì± ‡πÇ‡∏≠‡∏ô</span><b id="dTrans" style="color:#6366f1;">0</b></div>
                <div style="display:flex; justify-content:space-between; font-size:13px; font-weight:700; color:#64748b;"><span>üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</span><b id="dCash" style="color:#10b981;">0</b></div>
            </div>
            <div style="background:white; padding:15px; border-radius:22px; box-shadow:0 8px 20px rgba(0,0,0,0.04); border: 1px solid #f1f5f9;">
                <div style="display:flex; justify-content:space-between; margin-bottom:8px; font-size:13px; font-weight:700; color:#64748b;"><span>ü§µ ‡∏ä‡πà‡∏≤‡∏á</span><b id="dBarber" style="color:#f59e0b;">0</b></div>
                <div style="display:flex; justify-content:space-between; font-size:13px; font-weight:800; color:#64748b;"><span>üè† ‡∏£‡πâ‡∏≤‡∏ô</span><b id="dShop" style="color:#1e293b;">0</b></div>
            </div>
        </div>

        <div id="settleBarContainer" style="margin-bottom:18px;"><div id="settleBar"></div> </div>
        
        <div style="background:white; border-radius:25px; padding:20px; box-shadow:0 10px 20px rgba(0,0,0,0.03);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <b style="font-size:16px; color:#1e293b;">üìå ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</b>
                <div onclick="shareLine()" style="background:#f0fdf4; color:#16a34a; padding:6px 12px; border-radius:10px; font-size:13px; font-weight:800; cursor:pointer;">
                    <i class="fab fa-line"></i> ‡∏™‡πà‡∏á‡πÑ‡∏•‡∏ô‡πå
                </div>
            </div>
            
            <div id="dServiceStats"></div>
            <div id="dailyList"></div>

            <button onclick="confirmCloseDay()" style="width:100%; height:60px; margin-top:15px; border-radius:15px; border:none; background:linear-gradient(135deg, #f59e0b, #d97706); color:white; font-size:18px; font-weight:900; display:flex; align-items:center; justify-content:center; gap:10px; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2); cursor:pointer;">
                <i class="fas fa-calendar-check"></i> ‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πâ‡∏≤ 3
            </button>
        </div>
    </div> <div id="p3" class="page" style="max-width:480px; margin:0 auto; padding: 12px; padding-bottom: 100px; background: #f8fafc;">
        <div class="card" style="background:#fff; border-radius:25px; padding:20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border:1px solid #fff; margin-bottom: 15px;">
            
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <b style="font-size:16px; color:#92400e;"><i class="fas fa-file-invoice-dollar"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</b>
                <div id="accLight" style="background:#22c55e; width:10px; height:10px; border-radius:50%; box-shadow:0 0 8px #22c55e;"></div>
            </div>

            <div style="display:flex; gap:12px; margin-bottom:20px;">
                <div style="flex:1; background:#fef2f2; border-radius:22px; padding:18px 10px; text-align:center; border: 1px solid #fee2e2;">
                    <small style="font-size:11px; color:#ef4444; font-weight:800; text-transform:uppercase;">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≤‡∏á</small>
                    <b style="font-size:22px; color:#b91c1c; font-weight:900; display:block;" id="debtToBarber">‡∏ø0</b>
                </div>
                <div style="flex:1; background:#f0fdf4; border-radius:22px; padding:18px 10px; text-align:center; border: 1px solid #dcfce7;">
                    <small style="font-size:11px; color:#22c55e; font-weight:800; text-transform:uppercase;">‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô</small>
                    <b style="font-size:22px; color:#15803d; font-weight:900; display:block;" id="debtToShop">‡∏ø0</b>
                </div>
            </div>

            <div style="text-align:center; margin-bottom:20px; padding:15px; background:#f8fafc; border-radius:20px;">
                <small id="netStatusLabel" style="font-weight:700; color:#64748b;">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏ô</small>
                <div style="font-size:48px; font-weight:900; color:#1a237e; letter-spacing:-1px;">‡∏ø<span id="accNet">0</span></div>
            </div>

            <div style="display:flex; gap:10px; margin-bottom:15px; opacity:0.7;">
                <div style="flex:1; font-size:12px; font-weight:700; color:#64748b; text-align:center;">‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°: <span id="accOldVal">‡∏ø0</span></div>
                <div style="flex:1; font-size:12px; font-weight:700; color:#64748b; text-align:center;">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: <span id="accTodayVal">‡∏ø0</span></div>
            </div>

            <div style="margin-bottom:15px;">
                <div style="display:flex; align-items:center; background:#f1f5f9; border-radius:15px; padding:0 15px; margin-bottom:8px; height:50px;">
                    <i class="fas fa-calendar-alt" style="color:#6366f1;"></i>
                    <input type="date" id="accDate" style="flex:1; border:none; background:none; font-size:16px; font-weight:600; padding-left:10px; outline:none;">
                </div>
                <div style="display:flex; align-items:center; background:#f1f5f9; border-radius:15px; padding:0 15px; height:50px;">
                    <i class="fas fa-pen-nib" style="color:#94a3b8;"></i>
                    <input type="text" id="accNote" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" style="flex:1; border:none; background:none; font-size:15px; padding-left:10px; outline:none;">
                </div>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button onclick="clearAccount()" style="background:linear-gradient(135deg, #10b981, #059669); color:#fff; border:none; border-radius:18px; padding:15px 5px; font-size:14px; font-weight:800; cursor:pointer;">
                    <i class="fas fa-check-double"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô
                </button>
                <button onclick="openHistoryModal()" style="background:#fff; color:#3b82f6; border:2px solid #3b82f6; border-radius:18px; padding:15px 5px; font-size:14px; font-weight:800; cursor:pointer;">
                    <i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå
                </button>
            </div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
            <div onclick="document.getElementById('histDate').showPicker()" style="background:#ffffff; border-radius:25px; padding:22px 15px; text-align:center; position:relative; box-shadow:0 8px 20px rgba(0,0,0,0.03); border:1.5px solid #f1f5f9;">
                <div style="background:#fff7ed; width:45px; height:45px; border-radius:15px; display:flex; align-items:center; justify-content:center; margin:0 auto 10px; color:#f59e0b;">
                    <i class="fas fa-search-dollar" style="font-size:22px;"></i>
                </div>
                <b style="font-size:14px; color:#1e293b;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</b>
                <input type="date" id="histDate" onchange="loadHistDaily()" style="position:absolute; inset:0; opacity:0; cursor:pointer;">
            </div>
            <div onclick="document.getElementById('histMonth').showPicker()" style="background:#ffffff; border-radius:25px; padding:22px 15px; text-align:center; position:relative; box-shadow:0 8px 20px rgba(0,0,0,0.03); border:1.5px solid #f1f5f9;">
                <div style="background:#eef2ff; width:45px; height:45px; border-radius:15px; display:flex; align-items:center; justify-content:center; margin:0 auto 10px; color:#6366f1;">
                    <i class="fas fa-chart-pie" style="font-size:22px;"></i>
                </div>
                <b style="font-size:14px; color:#1e293b;">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</b>
                <input type="month" id="histMonth" onchange="loadHistMonth()" style="position:absolute; inset:0; opacity:0; cursor:pointer;">
            </div>
        </div>
    </div>
<div id="modalSet" style="display:none; position:fixed; inset:0; background:rgba(15, 23, 42, 0.7); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px); z-index:99999; align-items:flex-end; justify-content:center;">
    
    <div style="background:#ffffff; width:100%; max-width:500px; border-radius:35px 35px 0 0; box-shadow:0 -10px 40px rgba(0,0,0,0.2); animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1); display:flex; flex-direction:column; overflow:hidden;">
        
        <div style="padding:15px 0 5px; text-align:center; cursor:pointer;" onclick="document.getElementById('modalSet').style.display='none'">
            <div style="width:50px; height:6px; background:#e2e8f0; border-radius:10px; margin:0 auto;"></div>
        </div>

        <div style="padding:15px 25px 40px;">
            <h3 style="margin:0 0 25px; font-size:22px; color:#1e1b4b; font-weight:900; text-align:center;">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>

            <div style="margin-bottom:20px;">
                <label style="display:flex; align-items:center; gap:6px; font-size:12px; font-weight:800; color:#64748b; margin-bottom:10px; text-transform:uppercase; letter-spacing:0.5px;">
                    <i class="fas fa-store"></i> ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                </label>
                <input type="text" id="setShop" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô" style="width:100%; height:60px; border-radius:20px; border:2px solid #f1f5f9; background:#f8fafc; text-align:center; font-size:18px; font-weight:700; color:#1e293b; outline:none; transition:0.2s;">
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:20px;">
                <div>
                    <label style="display:block; font-size:11px; font-weight:800; color:#64748b; margin-bottom:8px;">% ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏ä‡πà‡∏≤‡∏á</label>
                    <input type="number" id="setPerc" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50" style="width:100%; height:60px; border-radius:20px; border:2px solid #f1f5f9; background:#f8fafc; text-align:center; font-size:18px; font-weight:700; outline:none;">
                </div>
                <div>
                    <label style="display:block; font-size:11px; font-weight:800; color:#64748b; margin-bottom:8px;">‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</label>
                    <input type="number" id="setGuar" placeholder="0.00" style="width:100%; height:60px; border-radius:20px; border:2px solid #f1f5f9; background:#f8fafc; text-align:center; font-size:18px; font-weight:700; outline:none;">
                </div>
            </div>

            <div style="margin-bottom:20px;">
                <label style="display:block; font-size:11px; font-weight:800; color:#64748b; margin-bottom:8px;">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏µ‡πÅ‡∏≠‡∏õ (Theme)</label>
                <select id="setTheme" onchange="changeTheme(this.value)" style="width:100%; height:60px; border-radius:20px; border:2px solid #f1f5f9; background:#f8fafc; padding:0 20px; font-size:16px; font-weight:700; outline:none; appearance:none;">
                    <option value="light">üå§ Light Mode (‡∏™‡∏ß‡πà‡∏≤‡∏á)</option>
                    <option value="navy">üåå Navy Premium (‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏°)</option>
                    <option value="dark">üåë Midnight Gold (‡∏î‡∏≥-‡∏ó‡∏≠‡∏á)</option>
                </select>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:30px;">
                <select id="setSound" style="width:100%; height:60px; border-radius:20px; border:2px solid #f1f5f9; background:#f8fafc; padding:0 15px; font-weight:700; outline:none;">
                    <option value="on">üîä ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</option>
                    <option value="off">üîá ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</option>
                </select>
                <select id="setVoice" style="width:100%; height:60px; border-radius:20px; border:2px solid #f1f5f9; background:#f8fafc; padding:0 15px; font-weight:700; outline:none;">
                    <option value="female">üëß ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á </option>
                    <option value="male">üë® ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢ </option>
                </select>
            </div>
            <div style="display:grid; grid-template-columns: 2.5fr 1fr; gap:15px;">
                <button onclick="saveSettings()" style="background:linear-gradient(135deg, #4338ca, #1e1b4b); color:#fff; height:75px; border-radius:25px; border:none; font-weight:900; font-size:20px; box-shadow:0 10px 25px rgba(67,56,202,0.3); cursor:pointer;">
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
                <button onclick="document.getElementById('modalSet').style.display='none'" style="background:#fff1f2; color:#e11d48; height:75px; border-radius:25px; border:none; font-size:35px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                    <i class="fas fa-power-off"></i>
                </button>
            </div>

            <button id="dangerZone" onclick="clearAllData()" style="width:100%; margin-top:30px; background:none; border:none; color:#fca5a5; font-size:14px; font-weight:700; text-decoration:underline; cursor:pointer; opacity:0.6;">
                ‡∏•‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
        </div>
    </div>
</div>
<nav class="bottom-nav">
    <a href="javascript:go(1)" class="nav-btn active" id="n1"><i class="fas fa-edit"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</a>
    <a href="javascript:go(2)" class="nav-btn" id="n2"><i class="fas fa-history"></i>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a>
    <a href="javascript:go(3)" class="nav-btn" id="n3"><i class="fas fa-wallet"></i>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</a>
</nav>
<style>
/* Animation ‡∏ó‡∏µ‡πà‡∏°‡∏∂‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏≤ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Modal ‡∏´‡∏£‡∏∑‡∏≠ Page ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ */
@keyframes slideUp {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
}
/* ‡∏™‡πà‡∏ß‡∏ô Focus ‡∏Ç‡∏≠‡∏á Modal ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Input ‡∏î‡∏π‡πÅ‡∏û‡∏á‡∏Ç‡∏∂‡πâ‡∏ô */
#modalSet input:focus, #modalSet select:focus {
    border-color: #6366f1 !important;
    background: #ffffff !important;
    outline: none; /* ‡∏Å‡∏π‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏Ç‡∏≠‡∏ö‡∏î‡∏≥‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏≠‡∏Å */
}
/* ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ CSS ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏•‡∏≤‡∏™ active ‡∏ó‡∏µ‡πà‡∏Å‡∏î‡∏à‡∏≤‡∏Å‡∏à‡∏≤‡∏ß‡∏≤‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå */
.nav-btn.active {
    color: #ffffff !important;
    transform: translateY(-5px);
    transition: all 0.3s ease;
}
</style>
</body>
 <script>
    // --- 1. ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (State Management) ---
    let archives = JSON.parse(localStorage.getItem("barber_archives")) || [];
    let db = JSON.parse(localStorage.getItem("barber_db")) || [];
    let conf = JSON.parse(localStorage.getItem("barber_conf")) || { shop: "Barber Shop", perc: 50, guar: 0, theme: "light", voice: "female", sound: "on" };
    let account = JSON.parse(localStorage.getItem("barber_account")) || { balance: 0, logs: [] };
    let payMethod = "";

    const $ = (id) => document.getElementById(id);

    // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (System Core) ---
    window.onload = () => {
        const today = new Date().toISOString().split('T')[0];
        if ($("dateInp")) $("dateInp").value = today;
        if ($("accDate")) $("accDate").value = today;
        if ($("histDate")) $("histDate").value = today;
        
        applyTheme(conf.theme || 'light');
        if ($("shopNameDisp")) $("shopNameDisp").innerText = conf.shop;
        
        const now = new Date();
        const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
        if($("tStart")) $("tStart").value = timeStr;
        
        updateDateDisplay(today);
        go(1); 
    };

    function saveDB() { 
        localStorage.setItem("barber_db", JSON.stringify(db)); 
        localStorage.setItem("barber_conf", JSON.stringify(conf)); 
    }
    function saveArc() { localStorage.setItem("barber_archives", JSON.stringify(archives)); }
    function saveAcc() { localStorage.setItem("barber_account", JSON.stringify(account)); }

    function speak(t) {
        if (conf.sound === 'off') return;
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(t);
        m.lang = 'th-TH';
        m.pitch = (conf.voice === 'male') ? 0.8 : 1.1;
        window.speechSynthesis.speak(m);
    }

    // --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô (Transaction Management) ---
    function selectPay(m) {
        payMethod = m;
        if($("btnCash")) $("btnCash").className = `btn btn-pay ${m === 'Cash' ? 'active-cash' : ''}`;
        if($("btnTrans")) $("btnTrans").className = `btn btn-pay ${m === 'Trans' ? 'active-trans' : ''}`;
    }

    function addMinutes(time, mins) {
        if (!time) return "";
        const [h, m] = time.split(":").map(Number);
        const d = new Date();
        d.setHours(h, m + mins, 0, 0);
        return d.toTimeString().slice(0, 5);
    }

    function handleSave() {
        const p = parseInt($("priceInp").value), t = parseInt($("tipInp").value) || 0;
        if (!p || !payMethod) {
            speak("‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡πà‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞");
            return alert("‚ö†Ô∏è ‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡πà‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô!");
        }
        
        const start = $("tStart").value || new Date().toTimeString().slice(0, 5);
        const rec = {
            id: Date.now(), 
            date: $("dateInp").value, 
            time: start, 
            endTime: $("tEnd").value || addMinutes(start, 30),
            svcs: [$("hairStyle").value, $("extra1").value, $("extra2").value].filter(Boolean),
            hair: $("hairStyle").value, 
            price: p, 
            tip: t, 
            pay: payMethod, 
            type: "SERVICE"
        };

        db.push(rec); 
        saveDB(); 
        speak(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ${p} ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`);
        renderDay();

        ["priceInp", "tipInp", "tEnd"].forEach(id => $(id).value = "");
        $("tStart").value = rec.endTime; 
        selectPay("");
    }

    function handleInsurance() {
        const d = $("dateInp").value, g = parseInt(conf.guar) || 0;
        if (g <= 0) return (speak("‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞"), alert("‚ö†Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏¢‡∏≠‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô"));
        if (db.find(r => r.date === d && r.type === "GUARANTEE_CLAIM")) return (speak("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞"), alert("üõ°Ô∏è ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß"));
        
        if (confirm(`üõ°Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö '‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ' ‡∏ø${g}?`)) {
            db.push({ id: Date.now(), date: d, time: "00:00", svcs: ["üõ°Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô"], price: 0, pay: "N/A", type: "GUARANTEE_CLAIM" });
            saveDB(); 
            speak(`‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô ${g} ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`); 
            renderDay();
        }
    }

    function handleHoliday() {
        const d = $("dateInp").value;
        if (confirm(`üèñÔ∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${d} ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î?`)) {
            db.push({ id: Date.now(), date: d, time: "00:00", svcs: ["üèñÔ∏è ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"], price: 0, pay: "N/A", type: "HOLIDAY" });
            saveDB(); 
            speak("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); 
            renderDay();
        }
    }

    // --- 4. ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (Report Engine) ---
    function renderDay() {
        const dInp = $("dateInp").value;
        const allRec = db.filter(r => r.date === dInp);
        const today = allRec.filter(r => r.type === 'SERVICE');
        const isHoliday = allRec.some(r => r.type === 'HOLIDAY');
        const stats = {};
        let tot = 0, trans = 0, cash = 0, tips = 0, listHtml = "";

        today.sort((a,b) => a.time.localeCompare(b.time)).forEach((r, i) => {
            const p = Number(r.price)||0, t = Number(r.tip)||0; 
            tot += p; tips += t;
            (r.pay === 'Trans') ? trans += p : cash += p;
            
            r.svcs.forEach(s => stats[s] = (stats[s] || 0) + 1);
            
            const timeShow = r.endTime ? `${r.time}-${r.endTime}` : r.time;
            listHtml += `
                <div class="history-row" style="padding:15px; border-bottom:1px solid #f1f5f9; background:#fff;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <span style="font-weight:800; font-size:14px; color:#1e293b;">${i+1}. [${timeShow}] | ${r.svcs.join('+')}</span>
                            ${t ? `<br><small style="color:#be185d; font-weight:700;">‡∏ó‡∏¥‡∏õ: ‡∏ø${t}</small>` : ''}
                        </div>
                        <div style="text-align:right;">
                            <b style="font-size:16px;">‡∏ø${p}</b>
                            <span style="font-size:12px;">${r.pay==='Trans'?'üì±':'üíµ'} <i class="fas fa-trash-alt" style="color:#ef4444; margin-left:8px;" onclick="delRec(${r.id})"></i></span>
                        </div>
                    </div>
                </div>`;
        });

        const bEarn = isHoliday ? 0 : Math.max(tot * (conf.perc / 100), conf.guar) + tips;
        const sEarn = isHoliday ? 0 : tot - (bEarn - tips);
        const settle = isHoliday ? 0 : cash - bEarn;

        if($("dTotal")) $("dTotal").innerText = tot.toLocaleString();
        if($("dTrans")) $("dTrans").innerText = trans.toLocaleString();
        if($("dCash")) $("dCash").innerText = cash.toLocaleString();
        if($("dBarber")) $("dBarber").innerText = Math.floor(bEarn).toLocaleString();
        if($("dShop")) $("dShop").innerText = Math.floor(sEarn).toLocaleString();
        if($("dCounts")) $("dCounts").innerText = isHoliday ? "üè™ ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î" : `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${today.length} ‡∏Ñ‡∏ô`;

        let txt = "", bg = ""; 
        if (isHoliday) { txt = "üèñÔ∏è ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"; bg = "#f1f5f9"; }
        else if (tot === 0 && today.length === 0) { txt = "‚è≥ ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤"; bg = "#f1f5f9"; }
        else if (settle > 0) { txt = `üü• ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${Math.floor(settle).toLocaleString()}`; bg = "#fee2e2"; } 
        else if (settle < 0) { txt = `üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.floor(Math.abs(settle)).toLocaleString()}`; bg = "#e0e7ff"; } 
        else { txt = "‚úÖ ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ"; bg = "#dcfce7"; }

        $("dailyList").innerHTML = (isHoliday) ? `<div style="text-align:center; padding:40px;">üèñÔ∏è ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£) <i class="fas fa-trash-alt" style="color:#ef4444;" onclick="delRec(${allRec.find(x=>x.type==='HOLIDAY')?.id})"></i></div>` : listHtml;
        
        const container = $("settleBar").parentElement;
        container.innerHTML = `
            <div id="settleBar" style="flex:8; height:55px; background:${bg}; display:flex; align-items:center; justify-content:center; border-radius:15px; font-weight:900;">${txt}</div>
            <button onclick="saveAndGo('${dInp}', ${tot}, ${bEarn}, ${JSON.stringify(stats).replace(/"/g, '&quot;')})" style="flex:2; background:#f97316; color:#fff; border-radius:15px; border:none; font-size:22px;"><i class="fas fa-paper-plane"></i></button>`;
        
        updateAccountDisplay(bEarn);
    }

    function saveAndGo(date, total, barber, stats) {
        if (total === 0 && !confirm("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≠‡∏î ‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏¢‡∏°‡∏±‡πâ‡∏¢?")) return;
        const details = db.filter(r => r.date === date && r.type === 'SERVICE');
        const entry = { date, total, barber, shop: total - (barber - details.reduce((a,b)=>a+(b.tip||0),0)), count: details.length, stats, details, settle: (details.filter(r=>r.pay!=='Trans').reduce((a,b)=>a+b.price,0)) - barber };
        archives = archives.filter(a => a.date !== date);
        archives.push(entry);
        saveArc();
        speak("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        go(3);
    }
    // --- 5. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (Accounting & History) ---
function renderHistoryList() {
    const logs = account.logs || [];
    const target = $("accHistoryList");
    if (!target) return;
    target.innerHTML = logs.length ? logs.map(h => `
        <div style="background:#f8fafc; padding:12px; border-radius:15px; margin-bottom:10px; border:1px solid #e2e8f0;">
            <div style="display:flex; justify-content:space-between; font-weight:700;">
                <span>üìÖ ${h.date}</span><span style="color:#10b981;">‡∏ø${h.amount.toLocaleString()}</span>
            </div>
            <div style="font-size:11px; color:#64748b; margin-top:5px;">üìù ${h.note}</div>
        </div>`).join('') : "<p style='text-align:center; color:#94a3b8;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</p>";
}

function loadHistDaily() {
    const d = $("histDate").value; 
    const found = archives.find(a => a.date === d); 
    const area = $("histDailyArea"); 
    
    if(!found) { 
        area.innerHTML = "<center style='color:#ccc; padding:40px;'>‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</center>"; 
        return; 
    }

    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
    let rows = found.details.map(r => `
        <div class="history-row" style="font-size:13px; padding:10px 0; border-bottom:1px solid #f1f5f9;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b style="color:#1e293b;">${r.time} | ${r.svcs.join('+')}</b> 
                <b style="color:#1e293b;">‡∏ø${r.price}</b>
            </div>
            <div style="font-size:12px; font-weight:600; color:#64748b; margin-top:4px;">
                ${r.hair || '-'} 
                <span style="font-weight:400; opacity:0.6; float:right;">(${r.pay==='Cash'?'üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î':'üì± ‡πÇ‡∏≠‡∏ô'})</span>
            </div>
        </div>`).join('');

    // 2. ‡∏õ‡πâ‡∏≤‡∏¢‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (Badge)
    let statBadges = ""; 
    if (found.stats) { 
        for(let s in found.stats) { 
            let bg = s.startsWith("‡∏ó‡∏£‡∏á:") ? "#10b981" : "#6366f1"; 
            statBadges += `<span class="badge" style="background:${bg}; color:#fff; margin:2px; padding:4px 8px; border-radius:6px; font-size:11px;">${s.replace("‡∏ó‡∏£‡∏á:","")}: ${found.stats[s]}</span>`; 
        } 
    }

    const settle = found.settle || 0;
    const settleText = settle > 0 ? `üî¥ ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô: ‡∏ø${Math.floor(settle).toLocaleString()}` : settle < 0 ? `üîµ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á: ‡∏ø${Math.floor(Math.abs(settle)).toLocaleString()}` : "üü¢ ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ‡πÄ‡∏õ‡πä‡∏∞";
    const settleClass = settle > 0 ? "status-red" : settle < 0 ? "status-indigo" : "status-green";

    // 3. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
    area.innerHTML = `
    <div style="background:#fff; padding:15px; border-radius:20px; border:1px solid #e2e8f0; margin-top:10px; box-shadow:0 4px 6px -1px rgba(0,0,0,0.05);">
        <div class="status-bar ${settleClass}" style="padding:10px; font-size:14px; margin-bottom:15px; border-radius:12px; font-weight:900; text-align:center;">
            ${settleText}
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px; font-size:13px;">
            <div style="background:#f8fafc; padding:10px; border-radius:10px; border:1px solid #f1f5f9;">‡∏¢‡∏≠‡∏î‡∏ï‡∏±‡∏î: <b>${found.total.toLocaleString()}</b></div>
            <div style="background:#f8fafc; padding:10px; border-radius:10px; border:1px solid #f1f5f9;">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î: <b>${(found.cash || 0).toLocaleString()}</b></div>
            <div style="background:#f0fdf4; padding:10px; border-radius:10px; color:#166534;">‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ: <b>${Math.floor(found.barber).toLocaleString()}</b></div>
            <div style="background:#eff6ff; padding:10px; border-radius:10px; color:#1e40af;">‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ: <b>${Math.floor(found.shop).toLocaleString()}</b></div>
        </div>
        <div style="margin-bottom:15px; display:flex; flex-wrap:wrap; gap:4px;">${statBadges}</div>
        <div style="border-top:2px dashed #f1f5f9; padding-top:10px;">${rows}</div>
    </div>`;
}

function loadHistMonth() {
    const m = $("histMonth").value; 
    const area = $("histMonthArea"); 
    if(!m) return;
    
    const filtered = archives.filter(a => a.date.startsWith(m));
    if(!filtered.length) { 
        area.innerHTML = "<center style='color:#ccc; padding:40px;'>üåë ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</center>"; 
        return; 
    }

    let mTotal = 0, mBarber = 0, mShop = 0, mCount = 0, mStats = {};
    filtered.forEach(a => { 
        mTotal += a.total; 
        mBarber += a.barber; 
        mShop += (a.total - a.barber); 
        mCount += a.count; 
        if(a.stats) { for(let s in a.stats) mStats[s] = (mStats[s] || 0) + a.stats[s]; } 
    });

    let sB = "", hB = "";
    for(let s in mStats) { 
        if(s.startsWith("‡∏ó‡∏£‡∏á:")) hB += `<span class="badge" style="background:#10b981; color:white; padding:4px 8px; border-radius:6px; margin:2px; font-size:11px;">${s.replace("‡∏ó‡∏£‡∏á:","")}: ${mStats[s]}</span>`; 
        else sB += `<span class="badge" style="background:#6366f1; color:white; padding:4px 8px; border-radius:6px; margin:2px; font-size:11px;">${s}: ${mStats[s]}</span>`; 
    }

    area.innerHTML = `
    <div style="padding:15px; background:#fff; border-radius:20px; border:1px solid #e2e8f0; box-shadow:0 4px 6px -1px rgba(0,0,0,0.05);">
        <div style="text-align:center; margin-bottom:20px; padding:15px; background:linear-gradient(to bottom, #fff, #f8fafc); border-radius:15px; border:1px solid #f1f5f9;">
            <div style="font-size:12px; color:#64748b; font-weight:bold; margin-bottom:5px;">‚úÇÔ∏è ‡∏¢‡∏≠‡∏î‡∏ï‡∏±‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
            <div style="font-size:32px; font-weight:900; color:#1e293b;">‡∏ø${mTotal.toLocaleString()}</div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px;">
            <div style="background:#f0fdf4; padding:15px; border-radius:15px; text-align:center; border:1px solid #dcfce7;">
                <div style="font-size:11px; color:#166534; font-weight:bold;">ü§µ ‡∏ä‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏°</div>
                <div style="font-size:20px; font-weight:900; color:#15803d;">‡∏ø${Math.floor(mBarber).toLocaleString()}</div>
            </div>
            <div style="background:#eff6ff; padding:15px; border-radius:15px; text-align:center; border:1px solid #dbeafe;">
                <div style="font-size:11px; color:#1e40af; font-weight:bold;">üè† ‡∏£‡πâ‡∏≤‡∏ô‡∏£‡∏ß‡∏°</div>
                <div style="font-size:20px; font-weight:900; color:#1e40af;">‡∏ø${Math.floor(mShop).toLocaleString()}</div>
            </div>
        </div>
        <div style="display:flex; justify-content:space-around; font-size:13px; margin-bottom:20px; padding:10px; background:#f8fafc; border-radius:12px;">
            <div>üë• ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: <b>${mCount} ‡∏Ñ‡∏ô</b></div>
            <div style="color:#e2e8f0;">|</div>
            <div>üìÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: <b>${filtered.length} ‡∏ß‡∏±‡∏ô</b></div>
        </div>
        <div style="border-top:2px dashed #f1f5f9; padding-top:15px;">
            <label style="font-size:12px; color:#1e293b; font-weight:900;">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£:</label>
            <div style="margin:8px 0 15px 0; display:flex; flex-wrap:wrap; gap:2px;">${sB || '-'}</div>
            <label style="font-size:12px; color:#1e293b; font-weight:900;">üíá ‡∏ó‡∏£‡∏á‡∏ú‡∏°‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï:</label>
            <div style="margin-top:8px; display:flex; flex-wrap:wrap; gap:2px;">${hB || '-'}</div>
        </div>
    </div>`;
}

function updateAccountDisplay(todayBarber) {
    const oldBalance = account.balance || 0;
    if($("accOldVal")) $("accOldVal").innerText = `‡∏ø${oldBalance.toLocaleString()}`;
    if($("accTodayVal")) $("accTodayVal").innerText = `‡∏ø${todayBarber.toLocaleString()}`;
    if($("accNet")) $("accNet").innerText = (oldBalance + todayBarber).toLocaleString();
}

function clearAccount() {
    const amount = parseInt($("accNet").innerText.replace(/,/g,''));
    const date = $("accDate").value;
    if (confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô ‡∏ø${amount}?`)) {
        account.logs.unshift({ date, amount, note: $("accNote").value || "‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î" });
        account.balance = 0;
        saveAcc();
        speak("‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        go(1);
    }
}

    // --- 6. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏ò‡∏µ‡∏° (Settings & Theme) ---
    function applyTheme(t) {
        document.body.className = t;
        conf.theme = t;
        const s = document.documentElement.style;
        if (t === 'dark') {
            s.setProperty('--card', '#262626'); s.setProperty('--text', '#fbbf24'); document.body.style.background = '#171717';
        } else if (t === 'navy') {
            s.setProperty('--card', '#ffffff'); s.setProperty('--text', '#1a237e'); document.body.style.background = '#1a237e';
        } else {
            s.setProperty('--card', '#ffffff'); s.setProperty('--text', '#1a237e'); document.body.style.background = '#f1f5f9';
        }
    }

    function saveSettings() {
        conf.shop = $("setShop").value;
        conf.perc = parseInt($("setPerc").value) || 50;
        conf.guar = parseInt($("setGuar").value) || 0;
        conf.theme = $("setTheme").value;
        conf.voice = $("setVoice").value;
        conf.sound = $("setSound").value;
        saveDB();
        applyTheme(conf.theme);
        if($("shopNameDisp")) $("shopNameDisp").innerText = conf.shop;
        $("modalSet").style.display = 'none';
        alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß");
        renderDay();
    }

    // --- 7. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏° (UI Helpers & Line) ---
    function go(p) {
        document.querySelectorAll('.page').forEach(pg => pg.style.display = 'none');
        const target = $("p" + p);
        if (target) target.style.display = 'block';
        document.querySelectorAll('.nav-item').forEach((btn, i) => btn.classList.toggle('active', (i + 1) === p));
        if (p === 2) renderDay();
        if (p === 3) renderHistoryList();
    }

    function delRec(id) {
        if (confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) {
            db = db.filter(r => r.id !== id);
            saveDB();
            renderDay();
        }
    }

    function updateDateDisplay(v) {
        const d = new Date(v);
        if($("dateDisplay")) $("dateDisplay").innerText = d.toLocaleDateString('th-TH', {day:'numeric', month:'short', year:'2-digit'});
        renderDay();
    }

    function openSettings() { $("modalSet").style.display = 'flex'; }
    function closeSettings() { $("modalSet").style.display = 'none'; }

    function shareLine() {
        const dInp = $("dateInp").value, today = db.filter(r => r.date === dInp); 
        if (!today.length) return;
        const dp = dInp.split('-'), fDate = `${dp[2]}/${dp[1]}/${dp[0]}`;
        let tot = 0, cash = 0, trans = 0, tips = 0, stats = {};

        let clientList = today.sort((a,b) => a.time.localeCompare(b.time)).map((r, i) => {
            const p = Number(r.price) || 0, t = Number(r.tip) || 0;
            tot += p; tips += t;
            r.pay === 'Trans' ? trans += p : cash += p;
            if (r.hair && r.hair.includes("‡πÄ‡∏î‡πá‡∏Å")) stats["‡πÄ‡∏î‡πá‡∏Å"] = (stats["‡πÄ‡∏î‡πá‡∏Å"] || 0) + 1;
            (r.svcs || []).forEach(s => { if (s) stats[s] = (stats[s] || 0) + 1; });
            const tShow = r.endTime ? `${r.time}-${r.endTime}` : r.time;
            return `${i + 1}. [${tShow}] ${(r.svcs || []).join('+')} = ${p}${t ? ` (+‡∏ó‡∏¥‡∏õ ${t})` : ''} ${r.pay === 'Trans' ? 'üì±' : 'üíµ'}`;
        }).join('\n');

        const allowed = ["‡πÄ‡∏î‡πá‡∏Å", "‡∏™‡∏£‡∏∞‡∏ú‡∏°", "‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î", "‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°", "‡∏¢‡πâ‡∏≠‡∏°‡∏™‡∏µ"], icons = {"‡πÄ‡∏î‡πá‡∏Å": "üßí", "‡∏™‡∏£‡∏∞": "üßº", "‡πÇ‡∏Å‡∏ô": "ü™í", "‡∏¢‡πâ‡∏≠‡∏°": "üé®"};
        let statText = Object.entries(stats).filter(([k]) => allowed.some(a => k.includes(a))).map(([k, v]) => {
            const icon = icons[Object.keys(icons).find(i => k.includes(i))] || 'üîπ';
            return `${icon} ${k}: ${v}`;
        }).join('\n');

        let bEarn = Math.max(tot * (conf.perc / 100), conf.guar) + tips;
        let settle = cash - bEarn;
        let settleMsg = settle > 0 ? `‚ö†Ô∏è ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ${Math.floor(Math.abs(settle)).toLocaleString()} ‡∏ö‡∏≤‡∏ó` : settle < 0 ? `üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ${Math.floor(Math.abs(settle)).toLocaleString()} ‡∏ö‡∏≤‡∏ó` : `‚úÖ ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ‡πÄ‡∏õ‡πä‡∏∞`;

        let msg = `üíà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô: ${conf.shop}\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${fDate}\n-------------------------\nüìù ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (${today.length} ‡∏Ñ‡∏ô):\n${clientList}\n-------------------------\nüìä ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô:\n${statText || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©'}\n-------------------------\nüí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${tot.toLocaleString()} | üßß ‡∏ó‡∏¥‡∏õ: ${tips.toLocaleString()}\nüì± ‡πÇ‡∏≠‡∏ô: ${trans.toLocaleString()} | üíµ ‡∏™‡∏î: ${cash.toLocaleString()}\nü§µ ‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ: ${Math.floor(bEarn).toLocaleString()}\nüè† ‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ: ${Math.floor(tot - (bEarn - tips)).toLocaleString()}\n-------------------------\n${settleMsg}`;
        window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
    }
  </script></body></html>


