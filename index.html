<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LA-MOON CUT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap');
        * { font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: #f8fafc; color: #334155; }
        header { background: #1e293b; color: white; padding: 22px 0; text-align: center; border-bottom: 4px solid #fbbf24; }
        .shop-name { font-size: 1.8rem; text-transform: uppercase; font-weight: 500; letter-spacing: 3px; }
        .report-active header { display: none; }
        main { padding: 15px 15px 110px 15px; }
        .hidden-page { display: none !important; }
        .card { background: white; border-radius: 18px; border: 1px solid #e2e8f0; padding: 18px; margin-bottom: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        label { font-size: 16px; color: #94a3b8; margin-bottom: 6px; display: block; }
        select { background: #f8fafc; width: 100%; font-size: 1.4rem; color: #1e293b; border: 1px solid #e2e8f0; padding: 12px; border-radius: 12px; outline: none; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; background-size: 1.5rem; }
        .price-input { background: transparent; border: none; outline: none; width: 100%; font-size: 3rem; color: #2563eb; text-align: right; font-weight: 500; }
        input[type="time"], input[type="date"] { font-size: 1.4rem; color: #1e293b; border: none; outline: none; width: 100%; text-align: center; font-weight: bold; }
        #save-btn { width: 100%; background: #1e293b; color: white; padding: 22px; border-radius: 18px; font-size: 1.8rem; font-weight: 500; border: none; transition: 0.3s; }
        #save-btn.success { background: #10b981 !important; }
        .report-summary-card { background: #1e293b; color: white; border-radius: 24px; padding: 25px; margin-bottom: 20px; }
        .total-amount { font-size: 4.5rem; line-height: 1; font-weight: 500; margin-top: 10px; }
        .order-circle { width: 38px; height: 38px; background: #f1f5f9; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; color: #1e293b; font-weight: bold; margin-right: 15px; flex-shrink: 0; }
        nav { position: fixed; bottom: 0; left: 0; right: 0; height: 90px; background: white; border-top: 1px solid #e2e8f0; display: flex; z-index: 100; padding-bottom: env(safe-area-inset-bottom); }
        .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #94a3b8; }
        .active-nav { color: #1e293b; border-top: 5px solid #fbbf24; }
        .nav-btn i { font-size: 32px; margin-bottom: 4px; }
    </style>
</head>
<body id="body-container">
    <header><div class="shop-name">La-Moon Cut</div></header>
    <main>
        <div id="page-record">
            <div class="card"><label>วันที่ทำงาน</label><input type="date" id="work-date"></div>
            <div class="flex gap-3 mb-3">
                <div class="card flex-1 text-center"><label>เริ่ม</label><input type="time" id="time-start"></div>
                <div class="card flex-1 text-center"><label>เสร็จ</label><input type="time" id="time-end"></div>
            </div>
            <div id="services-container">
                <div class="card border-l-[8px] border-l-blue-500">
                    <label>ประเภทบริการ</label>
                    <select class="service-select mb-4">
                        <option value="ตัดผม">ตัดผม</option>
                        <option value="โกนหนวด">โกนหนวด</option>
                        <option value="กันหน้า">กันหน้า</option>
                        <option value="แก้ผม">แก้ผม</option>
                        <option value="สระผม">สระผม</option>
                        <option value="ย้อมผม">ย้อมผม</option>
                        <option value="ดัดผม">ดัดผม</option>
                        <option value="ยืดผม">ยืดผม</option>
                        <option value="อื่นๆ">อื่นๆ</option>
                    </select>
                    <div class="text-right border-t pt-3"><label>ราคา</label>
                        <input type="number" placeholder="0" class="service-price price-input" inputmode="decimal">
                    </div>
                </div>
            </div>
            <div class="card mb-4">
                <label>ประเภททรงผม</label>
                <select id="hair-style">
                    <option value="รองทรง">รองทรง</option>
                    <option value="แฟชั่น / ทูบล็อค">แฟชั่น / ทูบล็อค</option>
                    <option value="สกินเฟด">สกินเฟด</option>
                    <option value="นักเรียน">นักเรียน</option>
                    <option value="ตำรวจ / ทหาร">ตำรวจ / ทหาร</option>
                    <option value="ทรงอเมริกัน">ทรงอเมริกัน</option>
                    <option value="เปิดข้าง / วินเทจ">เปิดข้าง / วินเทจ</option>
                </select>
            </div>
            <div class="grid grid-cols-2 gap-3 mb-5">
                <button onclick="setPayment('cash')" id="pay-cash" class="card bg-slate-800 text-white py-6 flex flex-col items-center border-none shadow-lg">
                    <i class="fa-solid fa-money-bill-wave text-3xl mb-2"></i><span class="text-xl">เงินสด</span>
                </button>
                <button onclick="setPayment('transfer')" id="pay-transfer" class="card text-slate-400 py-6 flex flex-col items-center border-none">
                    <i class="fa-solid fa-qrcode text-3xl mb-2"></i><span class="text-xl">โอนเงิน</span>
                </button>
            </div>
            <button id="save-btn" onclick="saveRecord()">SAVE RECORD</button>
        </div>
        <div id="page-report" class="hidden-page pt-2">
            <div id="report-date-display" class="text-slate-800 font-bold mb-4 text-3xl"></div>
            <div class="report-summary-card shadow-xl">
                <div class="border-b border-white/10 pb-5 mb-5 text-center">
                    <p class="text-yellow-500 text-sm font-bold uppercase tracking-widest">ยอดรวมทั้งหมด</p>
                    <div class="total-amount">฿<span id="rep-total">0</span></div>
                    <p class="text-lg opacity-60 mt-2"><span id="rep-count">0</span> รายการ</p>
                </div>
                <div class="grid grid-cols-2 gap-4 text-center">
                    <div class="border-r border-white/10"><span class="text-white/40 block text-xs uppercase mb-1">เงินสด</span><span class="text-green-400 text-2xl font-bold">฿<span id="rep-cash">0</span></span></div>
                    <div><span class="text-white/40 block text-xs uppercase mb-1">โอนเงิน</span><span class="text-blue-400 text-2xl font-bold">฿<span id="rep-transfer">0</span></span></div>
                </div>
            </div>
            <div id="settle-box" class="card text-center py-6 mb-6 text-2xl font-bold"></div>
            <div id="history-items" class="space-y-3 mb-8"></div>
            <a href="https://docs.google.com/spreadsheets/d/159I70YQh-XwUv_IunvU4_S16fL835y_56Rly7oXhP_M/edit" target="_blank" class="w-full bg-green-700 text-white flex items-center justify-center p-5 rounded-2xl text-xl font-bold mb-4 shadow-lg">
                <i class="fa-solid fa-file-excel mr-3"></i> เปิด GOOGLE SHEET
            </a>
            <button onclick="clearAllData()" class="w-full text-red-400 underline py-4 text-sm opacity-50">ล้างข้อมูลทั้งหมด</button>
        </div>
    </main>
    <nav>
        <button onclick="nav('record')" id="nav-record" class="nav-btn active-nav"><i class="fa-solid fa-edit"></i><span>บันทึก</span></button>
        <button onclick="nav('report')" id="nav-report" class="nav-btn"><i class="fa-solid fa-chart-pie"></i><span>รายงาน</span></button>
    </nav>
    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby4-X1fFa9FD_UNYz8HbOqqDurX7KRrl-v4VyjELMTObe9yo8GN1uVgcsHNcoqgVfGh/exec"; 
        let db = JSON.parse(localStorage.getItem('lamoon_db_v17')) || [];
        let pType = 'cash';
        function init() {
            const now = new Date();
            document.getElementById('work-date').value = now.toISOString().split('T')[0];
            updateTime();
        }
        function updateTime() {
            const now = new Date();
            const hh = String(now.getHours()).padStart(2, '0');
            const mm = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('time-start').value = `${hh}:${mm}`;
            document.getElementById('time-end').value = `${hh}:${mm}`;
        }
        function setPayment(t) {
            pType = t;
            document.getElementById('pay-cash').className = t === 'cash' ? "card bg-slate-800 text-white py-6 flex flex-col items-center border-none shadow-lg" : "card text-slate-400 py-6 flex flex-col items-center border-none";
            document.getElementById('pay-transfer').className = t === 'transfer' ? "card bg-slate-800 text-white py-6 flex flex-col items-center border-none shadow-lg" : "card text-slate-400 py-6 flex flex-col items-center border-none";
        }
        async function saveRecord() {
            const btn = document.getElementById('save-btn');
            const price = parseFloat(document.querySelector('.service-price').value);
            const service = document.querySelector('.service-select').value;
            const style = document.getElementById('hair-style').value;
            if(!price) return alert('กรุณาใส่ราคา');
            btn.innerText = "บันทึกสำเร็จ!"; btn.classList.add('success'); btn.disabled = true;
            const entry = { id: Date.now(), date: document.getElementById('work-date').value, total: price, pType, timeStart: document.getElementById('time-start').value, timeEnd: document.getElementById('time-end').value, style, services: service };
            db.push(entry); localStorage.setItem('lamoon_db_v17', JSON.stringify(db));
            fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(entry) });
            setTimeout(() => {
                document.querySelector('.service-price').value = '';
                btn.innerText = "SAVE RECORD"; btn.classList.remove('success'); btn.disabled = false;
                updateTime();
            }, 1200);
        }
        function updateReport() {
            let total = 0, cash = 0, totalShare = 0;
            const list = document.getElementById('history-items');
            const targetDate = document.getElementById('work-date').value;
            document.getElementById('report-date-display').innerText = new Date(targetDate).toLocaleDateString('th-TH', { day: 'numeric', month: 'long', year: 'numeric' });
            list.innerHTML = '';
            const filtered = db.filter(it => it.date === targetDate);
            filtered.slice().reverse().forEach((item, index) => {
                total += item.total;
                if (item.pType === 'cash') cash += item.total;
                totalShare += (item.total < 400) ? 200 : (item.total * 0.5);
                list.innerHTML += `<div class="card flex justify-between items-center border-l-[6px] ${item.pType==='cash'?'border-l-green-500':'border-l-blue-500'}">
                    <div class="flex items-center"><div class="order-circle">${filtered.length - index}</div>
                    <div><p class="text-xl font-bold text-slate-700">${item.services}</p><p class="text-xs text-slate-400">${item.timeStart}-${item.timeEnd} | ${item.style}</p></div></div>
                    <div class="text-right flex items-center gap-4">
                        <div><p class="text-2xl font-bold">฿${item.total}</p><p class="text-[10px] font-bold ${item.pType==='cash'?'text-green-600':'text-blue-600'}">${item.pType==='cash'?'เงินสด':'โอนเงิน'}</p></div>
                        <button onclick="deleteItem(${item.id})" class="text-slate-300"><i class="fa-solid fa-trash-can"></i></button>
                    </div></div>`;
            });
            document.getElementById('rep-total').innerText = total.toLocaleString();
            document.getElementById('rep-cash').innerText = cash.toLocaleString();
            document.getElementById('rep-transfer').innerText = (total - cash).toLocaleString();
            document.getElementById('rep-count').innerText = filtered.length;
            let balance = cash - totalShare;
            const sBox = document.getElementById('settle-box');
            if(total > 0) {
                if(balance > 0) { sBox.innerText = "ช่างคืนร้าน: ฿" + balance.toLocaleString(); sBox.className = "card text-center py-6 mb-6 text-2xl font-bold bg-orange-50 text-orange-600 border-orange-200"; }
                else if(balance < 0) { sBox.innerText = "ร้านคืนช่าง: ฿" + Math.abs(balance).toLocaleString(); sBox.className = "card text-center py-6 mb-6 text-2xl font-bold bg-blue-50 text-blue-600 border-blue-200"; }
                else { sBox.innerText = "ยอดเงินลงตัวพอดี"; sBox.className = "card text-center py-6 mb-6 text-2xl font-bold bg-green-50 text-green-600 border-green-200"; }
            } else { sBox.innerText = "ไม่มีข้อมูลวันนี้"; sBox.className = "card text-center py-6 mb-6 text-xl font-bold text-slate-300"; }
        }
        function deleteItem(id) { if(confirm('ลบรายการนี้?')) { db = db.filter(it => it.id !== id); localStorage.setItem('lamoon_db_v17', JSON.stringify(db)); updateReport(); } }
        function clearAllData() { if(confirm('ลบข้อมูลทั้งหมด?')) { localStorage.removeItem('lamoon_db_v17'); db = []; updateReport(); } }
        function nav(p) {
            document.getElementById('page-record').classList.toggle('hidden-page', p !== 'record');
            document.getElementById('page-report').classList.toggle('hidden-page', p !== 'report');
            document.getElementById('nav-record').classList.toggle('active-nav', p === 'record');
            document.getElementById('nav-report').classList.toggle('active-nav', p === 'report');
            document.body.classList.toggle('report-active', p === 'report');
            if(p === 'report') updateReport();
        }
        window.onload = init;
    </script>
</body>
</html>
