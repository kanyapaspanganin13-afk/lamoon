<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LA-MOON CUT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap');
        * { font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: #f1f5f9; margin: 0; }
        .card { background: white; border-radius: 10px; padding: 10px; margin-bottom: 6px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .label-custom { color: #94a3b8; font-size: 11px; margin-bottom: 2px; display: block; }
        select, input { width: 100%; border: none; outline: none; background: transparent; font-size: 16px; font-weight: 500; color: #1e293b; height: 30px; }
        .price-text { font-size: 24px; text-align: right; color: #475569; font-weight: 700; }
        .pay-btn { background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; text-align: center; color: #94a3b8; cursor: pointer; font-size: 14px; }
        .pay-btn.active { background: #1e293b; color: white; border-color: #1e293b; font-weight: 600; }
        .btn-save-main { width: 100%; background: #1e293b; color: white; padding: 16px; border-radius: 12px; font-size: 16px; font-weight: 600; transition: 0.2s; }
        .btn-success { background: #10b981 !important; }
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 65px; background: white; border-top: 1px solid #e2e8f0; display: flex; z-index: 100; }
        .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #94a3b8; font-size: 11px; border: none; background: none; }
        .nav-btn.active { color: #1e293b; font-weight: 600; border-top: 3px solid #fbbf24; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<main class="p-3 pb-24">
    <div id="record-page">
        <h1 class="text-center font-bold text-slate-700 mb-3 text-lg tracking-widest uppercase">La-Moon Cut</h1>
        <div class="card"><span class="label-custom">วันที่</span><div id="cur-date-rec" class="text-slate-500 font-medium text-center text-sm"></div></div>
        <div class="flex gap-2">
            <div class="card flex-1"><span class="label-custom">เวลาเริ่ม</span><input type="time" id="start-t"></div>
            <div class="card flex-1"><span class="label-custom">เวลาเสร็จ</span><input type="time" id="end-t"></div>
        </div>
        <div id="service-area">
            <div class="card border-l-4 border-l-blue-500 flex items-center svc-row">
                <div class="flex-1"><span class="label-custom">เลือกบริการ</span>
                    <select class="svc-sel">
                        <option>ตัดผม</option><option>โกนหนวด</option><option>กันหน้า</option><option>แก้ผม</option><option>สระผม</option><option>ย้อมผม</option><option>ดัดผม</option><option>ยืดผม</option><option>อื่นๆ</option>
                    </select>
                </div>
                <div class="w-28 border-l pl-2"><span class="label-custom text-right">ราคา (บาท)</span><input type="number" class="price-text svc-pri" placeholder="0" inputmode="decimal"></div>
            </div>
        </div>
        <button onclick="addMoreSvc()" class="w-full py-2 border border-dashed border-slate-300 rounded-lg text-slate-400 mb-3 text-[10px] uppercase font-bold">+ เพิ่มบริการ</button>
        <div class="card"><span class="label-custom">ทรงผม</span>
            <select id="style-sel">
                <option>รองทรง</option><option>แฟชั่น / ทูบล็อค</option><option>สกินเฟด</option><option>นักเรียน</option><option>ตำรวจ / ทหาร</option><option>ทรงอเมริกัน</option><option>เปิดข้าง / วินเทจ</option>
            </select>
        </div>
        <div class="grid grid-cols-2 gap-2 mb-4">
            <div id="btn-cash" onclick="setPay('cash')" class="pay-btn active">เงินสด</div>
            <div id="btn-trans" onclick="setPay('transfer')" class="pay-btn">โอนเงิน</div>
        </div>
        <button id="main-save" onclick="doSave()" class="btn-save-main shadow-md">บันทึกข้อมูล (Save)</button>
    </div>

    <div id="report-page" class="hidden">
        <div class="mb-3 text-center">
            <p id="report-date-display" class="text-slate-500 text-sm font-bold tracking-wide"></p>
        </div>
        <div class="bg-[#1e293b] rounded-2xl p-5 text-white shadow-lg mb-4">
            <div class="flex justify-between items-end mb-4">
                <div><p class="text-yellow-400 text-[10px] font-bold uppercase">ยอดรวมวันนี้</p><p class="text-[10px] opacity-50"><span id="r-count">0</span> รายการ</p></div>
                <h2 class="text-4xl font-bold">฿<span id="r-total">0</span></h2>
            </div>
            <div class="grid grid-cols-3 gap-1 border-t border-white/10 pt-3 text-center">
                <div><p class="text-[9px] opacity-40 uppercase">สด</p><p class="text-green-400 text-sm font-bold">฿<span id="r-cash">0</span></p></div>
                <div><p class="text-[9px] opacity-40 uppercase">โอน</p><p class="text-blue-400 text-sm font-bold">฿<span id="r-trans">0</span></p></div>
                <div><p class="text-[9px] opacity-40 uppercase">เคลียร์</p><p class="text-white text-sm font-bold">฿<span id="r-set">0</span></p></div>
            </div>
        </div>
        <div id="settle-note" class="text-center p-3 mb-4 rounded-xl font-bold text-xs border"></div>
        <div id="hist-container" class="space-y-2 mb-6"></div>
        <a href="https://docs.google.com/spreadsheets/d/1X_t-3QY6YI0u_j8-xT0yN6uMh8Yx1Z0H/" target="_blank" class="w-full bg-[#107c41] text-white p-3 rounded-xl flex items-center justify-center gap-2 text-sm font-medium mb-4 shadow-sm">
            <i class="fa-solid fa-file-excel"></i> เปิดดู Google Sheet
        </a>
        <button onclick="clearAllData()" class="w-full text-red-500 text-[10px] py-4 opacity-50 uppercase font-bold">ล้างข้อมูลทั้งหมด</button>
    </div>
</main>

<nav class="nav-bar">
    <button onclick="showPage('record')" id="nav-rec" class="nav-btn active"><i class="fa-solid fa-edit text-xl mb-1"></i>บันทึก</button>
    <button onclick="showPage('report')" id="nav-rep" class="nav-btn"><i class="fa-solid fa-chart-pie text-xl mb-1"></i>รายงาน</button>
</nav>

<script>
    let logs = JSON.parse(localStorage.getItem('lamoon_final_v13')) || [];
    let pMode = 'cash';

    function initApp() {
        const d = new Date();
        const dateStr = d.toLocaleDateString('th-TH', {day:'numeric', month:'long', year:'numeric'});
        document.getElementById('cur-date-rec').innerText = dateStr;
        const time = d.getHours().toString().padStart(2,'0') + ":" + d.getMinutes().toString().padStart(2,'0');
        document.getElementById('start-t').value = time; document.getElementById('end-t').value = time;
    }

    function addMoreSvc() {
        const row = document.createElement('div');
        row.className = "card border-l-4 border-l-slate-300 flex items-center svc-row mt-1 relative";
        row.innerHTML = `<button onclick="this.parentElement.remove()" class="absolute -right-1 -top-1 bg-red-500 text-white rounded-full w-4 h-4 text-[8px]">✕</button>
            <div class="flex-1"><span class="label-custom">เลือกบริการ</span><select class="svc-sel">
                <option>ตัดผม</option><option>โกนหนวด</option><option>กันหน้า</option><option>แก้ผม</option><option>สระผม</option><option>ย้อมผม</option><option>ดัดผม</option><option>ยืดผม</option><option>อื่นๆ</option>
            </select></div>
            <div class="w-28 border-l pl-2"><span class="label-custom text-right">ราคา</span><input type="number" class="price-text svc-pri" placeholder="0" inputmode="decimal"></div>`;
        document.getElementById('service-area').appendChild(row);
    }

    function setPay(m) { pMode = m; document.getElementById('btn-cash').classList.toggle('active', m === 'cash'); document.getElementById('btn-trans').classList.toggle('active', m === 'transfer'); }

    function doSave() {
        const pris = document.querySelectorAll('.svc-pri'); const sels = document.querySelectorAll('.svc-sel');
        let sum = 0, items = [];
        pris.forEach((p, i) => { if(p.value > 0) { sum += parseFloat(p.value); items.push(sels[i].value); } });
        if(sum === 0) return alert('ใส่ราคาด้วยครับ');
        const btn = document.getElementById('main-save');
        btn.innerText = "บันทึกสำเร็จ!"; btn.classList.add('btn-success');
        logs.push({ id: Date.now(), svcs: items.join(','), style: document.getElementById('style-sel').value, price: sum, type: pMode, time: document.getElementById('start-t').value });
        localStorage.setItem('lamoon_final_v13', JSON.stringify(logs));
        setTimeout(() => {
            btn.innerText = "บันทึกข้อมูล (Save)"; btn.classList.remove('btn-success');
            pris.forEach(p => p.value = '');
            document.querySelectorAll('.svc-row').forEach((r, i) => { if(i > 0) r.remove(); });
            initApp();
        }, 1000);
    }

    function updateReport() {
        const d = new Date();
        document.getElementById('report-date-display').innerText = d.toLocaleDateString('th-TH', {day:'numeric', month:'long', year:'numeric'});
        const container = document.getElementById('hist-container'); container.innerHTML = '';
        let total = 0, cash = 0, trans = 0;
        logs.slice().reverse().forEach((log, i) => {
            total += log.price; if(log.type === 'cash') cash += log.price; else trans += log.price;
            container.innerHTML += `<div class="card border-l-4 ${log.type === 'cash' ? 'border-l-green-500' : 'border-l-blue-500'} flex justify-between items-center py-2">
                <div class="flex items-center gap-2"><div class="text-[10px] text-slate-300 font-bold">${logs.length-i}</div>
                <div><p class="text-sm font-bold text-slate-700">${log.svcs}</p><p class="text-[10px] text-slate-400 font-medium">${log.time}น. | ${log.style}</p></div></div>
                <div class="text-right flex items-center gap-3"><div class="text-lg font-bold text-slate-800">฿${log.price.toLocaleString()}</div>
                <button onclick="delLog(${log.id})" class="text-red-500 opacity-60 px-1"><i class="fa-solid fa-trash-can"></i></button></div></div>`;
        });
        let share = total > 0 ? (total < 400 ? 200 : total * 0.5) : 0;
        let set = cash - share;
        document.getElementById('r-total').innerText = total.toLocaleString();
        document.getElementById('r-cash').innerText = cash.toLocaleString();
        document.getElementById('r-trans').innerText = trans.toLocaleString();
        document.getElementById('r-set').innerText = Math.abs(set).toLocaleString();
        document.getElementById('r-count').innerText = logs.length;
        const note = document.getElementById('settle-note');
        if(total > 0) {
            if(set > 0) {
                note.className = "text-center p-3 mb-4 rounded-xl font-bold text-xs bg-green-50 text-green-600 border-green-200";
                note.innerText = `ช่างคืนร้าน ฿${set.toLocaleString()}`;
            } else if(set < 0) {
                note.className = "text-center p-3 mb-4 rounded-xl font-bold text-xs bg-blue-50 text-blue-600 border-blue-200";
                note.innerText = `ร้านคืนช่าง ฿${Math.abs(set).toLocaleString()}`;
            } else {
                note.className = "text-center p-3 mb-4 rounded-xl font-bold text-xs bg-slate-100 text-slate-500 border-slate-200";
                note.innerText = `ยอดลงตัวพอดี`;
            }
        } else note.innerText = "ยังไม่มีประวัติลูกค้า";
    }

    function delLog(id) { if(confirm('ลบ?')) { logs = logs.filter(l => l.id !== id); localStorage.setItem('lamoon_final_v13', JSON.stringify(logs)); updateReport(); } }
    function clearAllData() { if(confirm('ล้างข้อมูลทั้งหมด?')) { logs = []; localStorage.setItem('lamoon_final_v13', JSON.stringify(logs)); updateReport(); } }
    function showPage(p) {
        document.getElementById('record-page').classList.toggle('hidden', p !== 'record');
        document.getElementById('report-page').classList.toggle('hidden', p !== 'report');
        document.getElementById('nav-rec').classList.toggle('active', p === 'record');
        document.getElementById('nav-rep').classList.toggle('active', p === 'report');
        if(p === 'report') updateReport();
    }
    window.onload = initApp;
</script>
</body>
</html>
