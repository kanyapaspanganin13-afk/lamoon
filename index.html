<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon" href="https://i.ibb.co/27GqTXFn/Barber-Note.png">
    <title>Barber Note Pro v.9.1</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1e3a8a; --accent: #16a34a; --danger: #dc2626; --warning: #f59e0b; --main-bg: #f1f5f9; --card: #ffffff; --text: #1e293b; --input-bg: #f8fafc; --indigo: #818cf8; --border: #e2e8f0; }
        body.theme-dark { --main-bg: #0f172a; --card: #1e293b; --text: #f8fafc; --input-bg: #334155; --border: #475569; }
        body.theme-pastel { --main-bg: #faf5ff; --card: #ffffff; --text: #4c1d95; --input-bg: #f5f3ff; --border: #e9d5ff; }
        body { margin: 0; font-family: 'Kanit'; background: var(--main-bg); color: var(--text); padding-bottom: 90px; transition: 0.3s; font-weight: 300; }
        header { padding: 15px; background: var(--card); display: flex; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); position: sticky; top:0; z-index:100; }
        header h1 { flex: 1; text-align: center; font-size: 18px; margin: 0; font-weight: 500; }
        .page { display: none; padding: 15px; animation: fadeIn 0.2s; } .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background: var(--card); border-radius: 20px; padding: 16px; margin-bottom: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input, select { width: 100%; height: 45px; padding: 8px 12px; border-radius: 12px; border: 1px solid transparent; font-size: 18px; box-sizing: border-box; background: var(--input-bg); color: var(--text); outline: none; font-family: 'Kanit'; }
        #dateInp { background: #e0f2fe !important; border: 1px solid #bae6fd !important; }
        .time-input { background: #f0f9ff !important; border: 1px solid #bae6fd !important; text-align: center; font-weight: 600; }
        .btn-pay { border: 2px solid transparent; background: var(--input-bg); color: var(--text); padding: 8px 5px; border-radius: 12px; font-weight: 500; cursor: pointer; transition: 0.2s; font-size: 18px; display: flex; align-items: center; justify-content: center; gap: 4px; }
        .active-cash { border: 3px solid #16a34a !important; color: #14532d !important; background: #dcfce7 !important; }
        .active-transfer { border: 3px solid #0284c7 !important; color: #0c4a6e !important; background: #e0f2fe !important; }
        .status-bar { width: 100%; padding: 15px; border-radius: 15px; text-align: center; font-weight: 600; font-size: 16px; margin: 10px 0; box-sizing: border-box; }
        .status-red { background: #fee2e2; color: #dc2626; } .status-green { background: #dcfce7; color: #16a34a; }
        .status-blue { background: #e0f2fe; color: #0284c7; } .status-indigo { background: #e0e7ff; color: #4338ca; }
        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); display: flex; border-top: 1px solid rgba(0,0,0,0.1); height: 75px; align-items: center; justify-content: space-around; z-index: 9999; }
        .nav-item { flex: 1; text-align: center; color: #94a3b8; font-size: 13px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; }
        .nav-item.active { color: var(--primary); font-weight: 500; }
        .btn-save { background: var(--primary); color: white; width: 100%; padding: 16px; border-radius: 16px; font-size: 18px; font-weight: 600; border: none; margin-top: 10px; cursor: pointer; }
        .btn-close-day { position: fixed; bottom: 85px; right: 20px; width: 60px; height: 60px; border-radius: 30px; background: #818cf8; color: white; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 99; font-size: 24px; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-content { background: var(--card); width: 100%; border-radius: 25px; padding: 22px; max-height: 85vh; overflow-y: auto; }
        .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid #ddd; display: inline-block; margin: 5px; }
        .history-row { padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.03); font-size: 14px; }
        .badge { background: rgba(0,0,0,0.05); padding: 4px 10px; border-radius: 8px; font-size: 12px; margin: 2px; display: inline-block; color: var(--primary); }
    </style>
</head>
<body id="mainBody">
<header><div style="width:40px"></div><h1 id="shopNameDisp">Barber Note</h1><div onclick="openSettings()" style="cursor:pointer"><i class="fas fa-cog"></i></div></header>

<div id="p1" class="page active">
    <div class="card" style="border-left: 5px solid #0ea5e9;"><input type="date" id="dateInp" style="margin-bottom:15px"><div class="grid-2"><div><label>‡πÄ‡∏£‡∏¥‡πà‡∏°</label><input type="tel" id="tStart" placeholder="0900" class="time-input" maxlength="4"></div><div><label>‡πÄ‡∏™‡∏£‡πá‡∏à</label><input type="tel" id="tEnd" placeholder="0930" class="time-input" maxlength="4"></div></div></div>
    <div class="card" style="border-left: 5px solid #10b981;"><div class="grid-2" style="margin-bottom:10px"><select id="mainSvc"><option value="">‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option><option value="‡πÄ‡∏î‡πá‡∏Å">‡πÄ‡∏î‡πá‡∏Å</option></select><select id="hairStyle"><option value="">‡∏ó‡∏£‡∏á‡∏ú‡∏°</option><option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option><option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option><option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option><option>‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á</option><option>‡∏ß‡∏¥‡∏ô‡πÄ‡∏ó‡∏à</option><option>‡∏ï‡∏≥‡∏£‡∏ß‡∏à/‡∏ó‡∏´‡∏≤‡∏£</option><option>‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option><option>‡πÅ‡∏Å‡πâ‡∏ó‡∏£‡∏á‡∏ú‡∏°</option></select></div>
    <div class="grid-2"><select id="extra1"><option value="">‡πÄ‡∏™‡∏£‡∏¥‡∏° 1</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option><option>‡∏î‡∏±‡∏î‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option></select><select id="extra2"><option value="">‡πÄ‡∏™‡∏£‡∏¥‡∏° 2</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option><option>‡∏î‡∏±‡∏î‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option></select></div></div>
    <div class="card" style="border-left: 5px solid #f59e0b;"><input type="number" id="priceInp" placeholder="0" inputmode="numeric" style="font-size:40px; font-weight:600; color:#b45309; text-align:center; height:80px;"><div class="grid-2" style="margin-top:15px"><button id="btnCash" class="btn-pay" onclick="selectPay('Cash')"><i class="fas fa-money-bill-wave"></i> ‡∏™‡∏î</button><button id="btnTrans" class="btn-pay" onclick="selectPay('Trans')"><i class="fas fa-mobile-alt"></i> ‡πÇ‡∏≠‡∏ô</button></div></div>
    <button class="btn-save" id="mainSaveBtn" onclick="handleSave()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

<div id="p2" class="page">
    <div class="grid-2"><div class="card" style="text-align: center;"><label>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</label><div id="dTotal" style="font-size:28px; font-weight:600">0</div><div id="dCounts" style="color:var(--primary)">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: 0 ‡∏Ñ‡∏ô</div></div><div class="card"><div>üì± ‡πÇ‡∏≠‡∏ô: <b id="dTrans">0</b></div><div>ü§µ ‡∏ä‡πà‡∏≤‡∏á: <b id="dBarber">0</b></div><div>üè† ‡∏£‡πâ‡∏≤‡∏ô: <b id="dShop">0</b></div></div></div>
    <div id="settleBar" class="status-bar status-blue">‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ</div>
    <div class="card"><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;"><label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label><i class="fab fa-line" style="color:#06C755; font-size:24px; cursor:pointer" onclick="shareLine()"></i></div><div id="dServiceStats"></div><div id="dailyList"></div></div>
    <button class="btn-close-day" onclick="closeDay()"><i class="fas fa-check-circle"></i></button>
</div>

<div id="p3" class="page"><div class="card"><label>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</label><input type="date" id="histDate" onchange="loadHistDaily()"><div id="histDailyArea"></div></div></div>

<div id="modalSet" class="modal"><div class="modal-content"><h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3><label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label><input id="setShop">
<div class="grid-2" style="margin-top:10px"><div><label>% ‡πÅ‡∏ö‡πà‡∏á</label><input type="number" id="setPerc"></div><div><label>‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</label><input type="number" id="setGuar"></div></div>
<div class="grid-2" style="margin-top:15px"><div><label>üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á</label><select id="setSound"><option value="on">‡πÄ‡∏õ‡∏¥‡∏î</option><option value="off">‡∏õ‡∏¥‡∏î</option></select></div><div><label>üéöÔ∏è ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î</label><select id="setVoice"><option value="female">üë© ‡∏´‡∏ç‡∏¥‡∏á</option><option value="male">üë® ‡∏ä‡∏≤‡∏¢</option></select></div></div>
<label style="margin-top:15px">‡∏ò‡∏µ‡∏°</label><select id="setTheme" onchange="changeTheme(this.value)"><option value="light">Light</option><option value="dark">Dark</option><option value="pastel">Pastel</option></select>
<div style="margin-top:10px"><label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (7 ‡∏™‡∏µ)</label><br>
    <div class="color-dot" style="background:#fdf2f8" onclick="setBg('#fdf2f8')"></div><div class="color-dot" style="background:#f0fdf4" onclick="setBg('#f0fdf4')"></div><div class="color-dot" style="background:#f0f9ff" onclick="setBg('#f0f9ff')"></div><div class="color-dot" style="background:#fffbeb" onclick="setBg('#fffbeb')"></div><div class="color-dot" style="background:#faf5ff" onclick="setBg('#faf5ff')"></div><div class="color-dot" style="background:#f1f5f9" onclick="setBg('#f1f5f9')"></div><div class="color-dot" style="background:#ffffff; border:1px solid #ccc" onclick="setBg('#ffffff')"></div>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;"><button class="btn-save" onclick="saveSettings()" style="margin:0">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button><button onclick="closeSettings()" style="border-radius:10px; border: 1px solid var(--border)">‡∏õ‡∏¥‡∏î</button></div>
<button onclick="clearAllData()" style="width:100%; background:none; border:none; color:red; margin-top:20px; font-size:12px; opacity:0.5">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button></div></div>

<nav class="nav"><div class="nav-item active" id="n1" onclick="go(1)"><i class="fas fa-edit"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div><div class="nav-item" id="n2" onclick="go(2)"><i class="fas fa-calendar-check"></i>‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</div><div class="nav-item" id="n3" onclick="go(3)"><i class="fas fa-history"></i>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</div></nav>
<script>
    let payMethod="", conf=JSON.parse(localStorage.getItem("barber_conf"))||{shop:"Barber Shop",perc:50,guar:0,theme:"light",bg:"#f1f5f9",sound:"on",voice:"female"}, db=JSON.parse(localStorage.getItem("barber_db"))||[], archives=JSON.parse(localStorage.getItem("barber_arc"))||[];
    const $=(id)=>document.getElementById(id);
    window.onload=()=>{ $("dateInp").valueAsDate=new Date(); applySettings(); };
    function speak(t){ if(conf.sound==="off")return; window.speechSynthesis.cancel(); const m=new SpeechSynthesisUtterance(t); m.lang='th-TH'; m.pitch=conf.voice==="male"?0.6:1.1; window.speechSynthesis.speak(m); }
    document.querySelectorAll('.time-input').forEach(i=>i.addEventListener('input',e=>{ let v=e.target.value.replace(/\D/g,''); if(v.length>=4) e.target.value=v.substring(0,2)+":"+v.substring(2,4); }));
    function go(n){ document.querySelectorAll('.page, .nav-item').forEach(el=>el.classList.remove('active')); $("p"+n).classList.add('active'); $("n"+n).classList.add('active'); if(n===2) renderDay(); }
    function selectPay(m){ payMethod=m; $("btnCash").className=m==='Cash'?'btn-pay active-cash':'btn-pay'; $("btnTrans").className=m==='Trans'?'btn-pay active-transfer':'btn-pay'; }
    function handleSave(){
        const p=$("priceInp").value; if(!p||!payMethod){ speak("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô"); return; }
        let svcs=[($("mainSvc").value||"‡∏ï‡∏±‡∏î‡∏ú‡∏°"),$("extra1").value,$("extra2").value].filter(s=>s);
        db.push({id:Date.now(),date:$("dateInp").value,time:`${$("tStart").value}-${$("tEnd").value}`,mainSvc:$("mainSvc").value||"‡∏ï‡∏±‡∏î‡∏ú‡∏°",svcs,hair:$("hairStyle").value,price:Number(p),pay:payMethod});
        localStorage.setItem("barber_db",JSON.stringify(db)); speak("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å "+p+" ‡∏ö‡∏≤‡∏ó ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        $("mainSaveBtn").innerText="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úì"; $("mainSaveBtn").style.background="var(--accent)";
        setTimeout(()=>{ $("mainSaveBtn").innerText="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"; $("mainSaveBtn").style.background="var(--primary)"; $("priceInp").value=""; if($("tEnd").value){ $("tStart").value=$("tEnd").value; $("tEnd").value=""; } $("extra1").value=$("extra2").value=""; selectPay(""); },600);
    }
    function renderDay(){
        const d=$("dateInp").value, today=db.filter(r=>r.date===d); let tot=0,trans=0,cash=0,stats={},listHtml="";
        today.sort((a,b)=>a.time.localeCompare(b.time)).forEach(r=>{
            tot+=r.price; r.pay==='Trans'?trans+=r.price:cash+=r.price; r.svcs.forEach(s=>stats[s]=(stats[s]||0)+1);
            listHtml+=`<div class="history-row"><div style="display:flex; justify-content:space-between"><span>${r.time} | ${r.svcs.join('+')}</span><b>‡∏ø${r.price}</b></div><div style="display:flex; justify-content:space-between; opacity:0.7"><span>${r.hair||''}</span><span>${r.pay==='Cash'?'üíµ ‡∏™‡∏î':'üì± ‡πÇ‡∏≠‡∏ô'} <i class="fas fa-trash" style="margin-left:10px; color:var(--danger)" onclick="delRec(${r.id})"></i></span></div></div>`;
        });
        const bEarn=Math.max(tot*(conf.perc/100),conf.guar), sEarn=tot-bEarn, settle=cash-bEarn;
        $("dTotal").innerText=tot.toLocaleString(); $("dTrans").innerText=trans.toLocaleString(); $("dBarber").innerHTML=`${Math.floor(bEarn).toLocaleString()} <small>(‡∏™‡∏î: ${cash})</small>`; $("dShop").innerText=Math.floor(sEarn).toLocaleString(); $("dCounts").innerText=`‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${today.length} ‡∏Ñ‡∏ô`; $("dailyList").innerHTML=listHtml||"<center style='opacity:0.3; padding:20px'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>";
        let sH=""; for(let s in stats) sH+=`<span class="badge">${s}: ${stats[s]}</span>`; $("dServiceStats").innerHTML=sH;
        const b=$("settleBar"); if(tot===0){ b.innerText="üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô"; b.className="status-bar status-blue"; } else if(settle>0){ b.innerText=`üü• ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${Math.floor(settle).toLocaleString()}`; b.className="status-bar status-red"; } else if(settle<0){ b.innerText=`üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.floor(Math.abs(settle)).toLocaleString()}`; b.className="status-bar status-indigo"; } else { b.innerText="‚úÖ ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ"; b.className="status-bar status-green"; }
    }
    function delRec(id){ if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")){ db=db.filter(r=>r.id!==id); localStorage.setItem("barber_db",JSON.stringify(db)); renderDay(); } }
    function closeDay(){
        const d=$("dateInp").value, today=db.filter(r=>r.date===d); if(!today.length)return;
        if(confirm("‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ?")){
            const tot=today.reduce((a,b)=>a+b.price,0), cash=today.filter(r=>r.pay==='Cash').reduce((a,b)=>a+b.price,0), bEarn=Math.max(tot*(conf.perc/100),conf.guar);
            let s={}; today.forEach(r=>r.svcs.forEach(v=>s[v]=(s[v]||0)+1));
            archives=archives.filter(a=>a.date!==d); archives.push({date:d,total:tot,cash,barber:bEarn,shop:tot-bEarn,settle:cash-bEarn,count:today.length,details:today,stats:s});
            localStorage.setItem("barber_arc",JSON.stringify(archives)); db=db.filter(r=>r.date!==d); localStorage.setItem("barber_db",JSON.stringify(db)); speak("‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); go(3);
        }
    }
    function loadHistDaily(){
        const d=$("histDate").value, f=archives.find(a=>a.date===d); if(!f){ $("histDailyArea").innerHTML="<center>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>"; return; }
        let rs=f.details.map(r=>`<div class="history-row"><div style="display:flex; justify-content:space-between"><b>${r.time} | ${r.svcs.join('+')}</b><b>‡∏ø${r.price}</b></div><div>${r.hair||''} (${r.pay==='Cash'?'‡∏™‡∏î':'‡πÇ‡∏≠‡∏ô'})</div></div>`).join('');
        $("histDailyArea").innerHTML=`<div style="background:var(--input-bg); padding:10px; border-radius:10px; margin-top:10px"><div style="display:grid; grid-template-columns:1fr 1fr; gap:5px; font-size:12px"><div>‡∏¢‡∏≠‡∏î: ${f.total}</div><div>‡∏ä‡πà‡∏≤‡∏á: ${Math.floor(f.barber)}</div></div><div style="border-top:1px dashed #ccc; margin-top:5px">${rs}</div></div>`;
    }
    function loadHistMonth(){
        const m=$("histMonth").value, f=archives.filter(a=>a.date.startsWith(m)); if(!f.length)return;
        let t=f.reduce((a,b)=>a+b.total,0), bT=f.reduce((a,b)=>a+b.barber,0);
        $("histMonthArea").innerHTML=`<div style="background:var(--input-bg); padding:15px; border-radius:10px; margin-top:10px"><b>‡∏£‡∏ß‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: ‡∏ø${t.toLocaleString()}</b><br><small>‡∏ä‡πà‡∏≤‡∏á: ${Math.floor(bT).toLocaleString()} | ‡∏£‡πâ‡∏≤‡∏ô: ${Math.floor(t-bT).toLocaleString()}</small></div>`;
    }
    function shareLine(){
        const d=$("dateInp").value, today=db.filter(r=>r.date===d); if(!today.length)return;
        let tot=0, trans=0, cash=0, msg=`üíà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô: ${conf.shop}\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${d}\n-------------------------\nüìù ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏£‡∏ß‡∏° ${today.length} ‡∏Ñ‡∏ô):\n`;
        let kids = 0;
        today.forEach((r,i)=>{ 
            tot+=r.price; if(r.pay==='Trans') trans+=r.price; else cash+=r.price;
            let name=r.hair||r.svcs[0]; if(r.mainSvc==="‡πÄ‡∏î‡πá‡∏Å") { name+="(‡πÄ‡∏î‡πá‡∏Å)"; kids++; }
            msg+=`${i+1}. [${r.time}] ${name} = ${r.price} ${r.pay==='Cash'?'üíµ':'üì±'}\n`;
        });
        const bE=Math.max(tot*(conf.perc/100),conf.guar), settle=cash-bE;
        msg+=`-------------------------\nüìä ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô:\nüßí ‡πÄ‡∏î‡πá‡∏Å: ${kids} ‡∏Ñ‡∏ô\n-------------------------\nüí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${tot} ‡∏ö‡∏≤‡∏ó\nüì± ‡∏¢‡∏≠‡∏î‡πÇ‡∏≠‡∏ô: ${trans} ‡∏ö‡∏≤‡∏ó\nü§µ ‡∏ä‡πà‡∏≤‡∏á: ${Math.floor(bE)} ‡∏ö‡∏≤‡∏ó\nüè† ‡∏£‡πâ‡∏≤‡∏ô: ${Math.floor(tot-bE)} ‡∏ö‡∏≤‡∏ó\n-------------------------\n‚ö†Ô∏è ${settle>0?'‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏£‡πâ‡∏≤‡∏ô ':'‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≤‡∏á '}${Math.floor(Math.abs(settle))} ‡∏ö‡∏≤‡∏ó`;
        window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
    }
    function openSettings(){ $("modalSet").style.display="flex"; $("setShop").value=conf.shop; $("setPerc").value=conf.perc; $("setGuar").value=conf.guar; $("setTheme").value=conf.theme; $("setSound").value=conf.sound; $("setVoice").value=conf.voice; }
    function closeSettings(){ $("modalSet").style.display="none"; }
    function setBg(c){ conf.bg=c; applySettings(); }
    function changeTheme(v){ conf.theme=v; applySettings(); }
    function saveSettings(){ conf.shop=$("setShop").value; conf.perc=Number($("setPerc").value); conf.guar=Number($("setGuar").value); conf.theme=$("setTheme").value; conf.sound=$("setSound").value; conf.voice=$("setVoice").value; localStorage.setItem("barber_conf",JSON.stringify(conf)); applySettings(); closeSettings(); speak("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß"); }
    function applySettings(){ $("shopNameDisp").innerText=conf.shop; $("mainBody").className="theme-"+conf.theme; $("mainBody").style.backgroundColor=conf.bg; }
    function clearAllData(){ if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")){ localStorage.clear(); location.reload(); } }
</script></body></html>
